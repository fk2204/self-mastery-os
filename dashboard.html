<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <meta name="theme-color" content="#0a0a0b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <title>MASTERMIND ALLIANCE</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=JetBrains+Mono:wght@400;500;600&family=Crimson+Pro:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-void: #0a0a0b;
            --bg-deep: #111113;
            --bg-surface: #18181b;
            --bg-elevated: #1f1f23;
            --bg-hover: #27272a;
            --border-subtle: #2a2a2f;
            --border-accent: #3a3a42;
            --text-primary: #fafafa;
            --text-secondary: #a1a1aa;
            --text-muted: #71717a;
            --gold-primary: #d4a847;
            --gold-light: #f0d078;
            --gold-dim: #8b7355;
            --success: #22c55e;
            --success-dim: #166534;
            --warning: #f59e0b;
            --danger: #ef4444;
            --accent-blue: #3b82f6;
            --accent-purple: #8b5cf6;
            --accent-pink: #ec4899;
            --accent-cyan: #06b6d4;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { font-size: 16px; }

        body {
            font-family: 'JetBrains Mono', monospace;
            background: var(--bg-void);
            color: var(--text-primary);
            min-height: 100vh;
            min-height: 100dvh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        /* Lightweight ambient glow - GPU composited */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background:
                radial-gradient(ellipse 80% 50% at 20% -10%, rgba(212, 168, 71, 0.06) 0%, transparent 50%),
                radial-gradient(ellipse 60% 40% at 80% 100%, rgba(59, 130, 246, 0.04) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            will-change: transform;
        }

        /* Grid pattern - hidden on mobile for perf, shown on desktop */
        .grid-pattern {
            display: none;
        }
        @media (min-width: 769px) {
            .grid-pattern {
                display: block;
                position: fixed;
                inset: 0;
                background-image:
                    linear-gradient(var(--border-subtle) 1px, transparent 1px),
                    linear-gradient(90deg, var(--border-subtle) 1px, transparent 1px);
                background-size: 60px 60px;
                opacity: 0.08;
                pointer-events: none;
                z-index: -1;
            }
        }

        /* Utility Classes */
        .text-muted {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        /* Layout */
        .app-container {
            display: flex;
            min-height: 100vh;
            min-height: 100dvh;
        }

        /* Mobile hamburger */
        .mobile-header {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 56px;
            background: var(--bg-surface);
            border-bottom: 1px solid var(--border-subtle);
            z-index: 200;
            align-items: center;
            padding: 0 1rem;
            gap: 0.75rem;
        }
        .hamburger {
            width: 44px; height: 44px;
            display: flex; align-items: center; justify-content: center;
            background: none; border: none; color: var(--text-primary);
            cursor: pointer; -webkit-tap-highlight-color: transparent;
        }
        .hamburger svg { width: 24px; height: 24px; }
        .mobile-logo {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.25rem; letter-spacing: 0.1em;
            color: var(--gold-primary);
        }
        .sidebar-overlay {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,0.6); z-index: 99;
            opacity: 0; transition: opacity 0.3s ease;
        }
        .sidebar-overlay.active { opacity: 1; }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-surface);
            border-right: 1px solid var(--border-subtle);
            display: flex;
            flex-direction: column;
            position: fixed;
            top: 0;
            left: 0;
            bottom: 0;
            z-index: 100;
            will-change: transform;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-subtle);
        }

        .logo {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.75rem;
            letter-spacing: 0.1em;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .logo-icon {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-dim) 100%);
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
        }

        .nav-section {
            padding: 1rem 0;
            flex-grow: 1;
            overflow-y: auto;
        }

        .nav-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            letter-spacing: 0.2em;
            padding: 0.5rem 1.5rem;
            text-transform: uppercase;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.875rem 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: background 0.15s ease, color 0.15s ease, border-color 0.15s ease;
            border-left: 3px solid transparent;
            min-height: 44px;
            -webkit-tap-highlight-color: transparent;
        }

        .nav-item:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .nav-item.active {
            background: var(--bg-elevated);
            color: var(--gold-primary);
            border-left-color: var(--gold-primary);
        }

        .nav-item svg {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
        }

        .nav-item-text {
            font-size: 0.875rem;
        }

        .nav-badge {
            margin-left: auto;
            font-size: 0.65rem;
            padding: 0.2rem 0.5rem;
            background: var(--gold-primary);
            color: var(--bg-void);
            border-radius: 10px;
            font-weight: 600;
        }

        /* Main Content */
        .main-content {
            flex-grow: 1;
            margin-left: 280px;
            padding: 2rem;
            min-height: 100vh;
        }

        /* Page Header */
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-subtle);
        }

        .page-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            letter-spacing: 0.1em;
            color: var(--text-primary);
        }

        .page-subtitle {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-top: 0.25rem;
        }

        .header-actions {
            display: flex;
            gap: 0.75rem;
        }

        .date-display {
            text-align: right;
        }

        .current-date {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .current-time {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--gold-primary);
        }

        /* Page Sections */
        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translate3d(0, 10px, 0); }
            to { opacity: 1; transform: translate3d(0, 0, 0); }
        }

        /* Reduce motion for users who prefer it */
        @media (prefers-reduced-motion: reduce) {
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Cards */
        .card {
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            transition: border-color 0.15s ease;
        }

        .card:hover {
            border-color: var(--border-accent);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.25rem;
        }

        .card-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 0.1em;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-title svg {
            color: var(--gold-primary);
        }

        .card-badge {
            font-size: 0.65rem;
            padding: 0.25rem 0.5rem;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 4px;
            color: var(--text-muted);
        }

        /* Grid Layouts */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        /* Dashboard Main Grid (40/60 split) */
        .dashboard-main-grid {
            display: grid;
            grid-template-columns: 40% 60%;
            gap: 1.5rem;
        }

        .dashboard-left, .dashboard-right {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        /* Full Habits Tracker Card */
        .habits-tracker-card {
            flex-grow: 1;
        }

        .habits-progress-section {
            display: flex;
            justify-content: center;
            margin-bottom: 1rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-subtle);
        }

        .full-habits-list {
            max-height: 400px;
            overflow-y: auto;
        }

        /* Today's Plan Styles */
        .todays-priorities {
            margin-bottom: 1rem;
        }

        .priority-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-subtle);
        }

        .priority-item:last-child {
            border-bottom: none;
        }

        .priority-number {
            width: 24px;
            height: 24px;
            background: var(--gold-primary);
            color: var(--bg-void);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .priority-text {
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .todays-win {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-top: 0.75rem;
        }

        .win-label {
            font-size: 0.65rem;
            color: var(--success);
            letter-spacing: 0.1em;
            margin-bottom: 0.25rem;
        }

        .win-text {
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        /* Quick Journal */
        .quick-journal-input {
            min-height: 100px;
            resize: vertical;
        }

        .quick-journal-status {
            transition: all 0.3s ease;
        }

        .quick-journal-status.saving {
            background: var(--warning);
        }

        .quick-journal-status.saved {
            background: var(--success);
        }

        /* Collapsible Sections */
        .collapsible-section {
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            overflow: hidden;
        }

        .collapsible-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .collapsible-header:hover {
            background: var(--bg-elevated);
        }

        .collapsible-arrow {
            transition: transform 0.3s ease;
            color: var(--text-muted);
        }

        .collapsible-arrow.rotated {
            transform: rotate(180deg);
        }

        .collapsible-content {
            padding: 0 1.25rem 1.25rem;
        }

        .mini-section-label {
            font-size: 0.65rem;
            color: var(--text-muted);
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
        }

        /* Power Words Accordion */
        .power-words-accordion {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .power-word-item {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            overflow: hidden;
        }

        .power-word-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .power-word-header:hover {
            background: var(--bg-hover);
        }

        .power-word-term {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            color: var(--gold-primary);
            letter-spacing: 0.05em;
        }

        .power-word-module {
            font-size: 0.6rem;
            padding: 0.2rem 0.5rem;
            background: rgba(139, 92, 246, 0.15);
            border-radius: 4px;
            color: var(--accent-purple);
        }

        .power-word-content {
            padding: 0 1rem 1rem;
            display: none;
        }

        .power-word-content.expanded {
            display: block;
        }

        .power-word-definition {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.5rem;
        }

        .power-word-example {
            font-size: 0.8rem;
            color: var(--text-muted);
            font-style: italic;
            padding-top: 0.5rem;
            border-top: 1px solid var(--border-subtle);
        }

        /* Plans Cards */
        .plan-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .plan-card:hover {
            border-color: var(--gold-dim);
        }

        .plan-title {
            font-size: 0.95rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .plan-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
        }

        .plan-progress-bar {
            height: 6px;
            background: var(--bg-deep);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 0.25rem;
        }

        .plan-progress-fill {
            height: 100%;
            background: var(--gold-primary);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        .plan-progress-text {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        /* Systems Cards */
        .system-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .system-card:hover {
            border-color: var(--accent-blue);
        }

        .system-name {
            font-size: 0.95rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .system-meta {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .system-success-rate {
            font-size: 0.8rem;
            color: var(--success);
            margin-top: 0.5rem;
        }

        .system-stat {
            display: inline-block;
            text-align: center;
            padding: 1rem;
            margin-right: 1rem;
        }

        .system-stat-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--gold-primary);
        }

        .system-stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            letter-spacing: 0.1em;
        }

        @media (max-width: 1200px) {
            .dashboard-main-grid {
                grid-template-columns: 1fr;
            }
        }

        /* === MOBILE-FIRST RESPONSIVE === */
        @media (max-width: 768px) {
            .mobile-header { display: flex; }
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .sidebar.open { transform: translateX(0); }
            .sidebar-overlay.active { display: block; }
            .main-content {
                margin-left: 0 !important;
                padding: 1rem;
                padding-top: calc(56px + 1rem);
            }
            .page-header {
                flex-direction: column;
                gap: 0.75rem;
                margin-bottom: 1rem;
                padding-bottom: 1rem;
            }
            .page-title { font-size: 1.75rem; }
            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            .dashboard-main-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            .card { padding: 1rem; margin-bottom: 1rem; border-radius: 10px; }
            .wisdom-hero { padding: 1.25rem; border-radius: 12px; }
            .wisdom-quote { font-size: 1.25rem; }
            .daily-insights-strip { grid-template-columns: 1fr; }
            .wisdom-expansion { grid-template-columns: 1fr; }
            .mindset-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }
            .mindset-arrow {
                transform: rotate(90deg);
                text-align: center;
            }
            .modal { width: 95%; max-width: none; border-radius: 12px; }
            .btn { min-height: 44px; }
            .habit-item { min-height: 48px; padding: 0.75rem 1rem; }
            .stat-value { font-size: 2rem; }
            .current-time { font-size: 1.5rem; }
            .master-tabs { overflow-x: auto; -webkit-overflow-scrolling: touch; }
            .master-tab { white-space: nowrap; }
        }

        @media (max-width: 480px) {
            html { font-size: 14px; }
            .page-title { font-size: 1.5rem; }
            .main-content { padding: 0.75rem; padding-top: calc(56px + 0.75rem); }
            .card { padding: 0.875rem; }
            .wisdom-hero { padding: 1rem; }
            .wisdom-quote { font-size: 1.1rem; padding-left: 1rem; }
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
        }

        .grid-4 {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1rem;
        }

        /* Buttons */
        .btn {
            padding: 0.75rem 1.5rem;
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            background: var(--bg-elevated);
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            cursor: pointer;
            transition: background 0.15s ease, border-color 0.15s ease, transform 0.15s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .btn:hover {
            background: var(--bg-hover);
            border-color: var(--border-accent);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-dim) 100%);
            border-color: var(--gold-primary);
            color: var(--bg-void);
            font-weight: 600;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(212, 168, 71, 0.3);
        }

        .btn-success {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1rem;
        }

        .btn-block {
            width: 100%;
            justify-content: center;
        }

        /* Inputs */
        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-label {
            display: block;
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.875rem 1rem;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            transition: all 0.2s ease;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--gold-primary);
            box-shadow: 0 0 0 3px rgba(212, 168, 71, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-range {
            width: 100%;
            margin: 0.5rem 0;
        }

        .range-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .range-value {
            text-align: center;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2rem;
            color: var(--gold-primary);
            margin: 0.5rem 0;
        }

        /* Wisdom Section */
        .wisdom-hero {
            background: linear-gradient(135deg, var(--bg-surface) 0%, var(--bg-deep) 100%);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        .wisdom-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--gold-dim), var(--gold-primary), var(--gold-dim));
        }

        .master-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(212, 168, 71, 0.1);
            border: 1px solid rgba(212, 168, 71, 0.2);
            border-radius: 20px;
            margin-bottom: 1rem;
        }

        .master-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            color: var(--gold-primary);
            letter-spacing: 0.05em;
        }

        .master-expertise {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .wisdom-quote {
            font-family: 'Crimson Pro', serif;
            font-size: 1.75rem;
            line-height: 1.5;
            color: var(--text-primary);
            font-style: italic;
            margin: 1.5rem 0;
            padding-left: 1.5rem;
            border-left: 3px solid var(--gold-primary);
        }

        .wisdom-practice {
            background: var(--bg-elevated);
            border-radius: 8px;
            padding: 1rem 1.25rem;
            margin-top: 1.5rem;
        }

        .practice-label {
            font-size: 0.65rem;
            color: var(--gold-primary);
            letter-spacing: 0.15em;
            margin-bottom: 0.5rem;
        }

        .practice-text {
            font-size: 0.95rem;
            color: var(--text-primary);
        }

        /* Daily Insights Strip */
        .daily-insights-strip {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .insight-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
        }

        .insight-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .insight-vocabulary::before {
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue));
        }

        .insight-mantra::before {
            background: linear-gradient(90deg, var(--gold-primary), var(--gold-light));
        }

        .insight-quote::before {
            background: linear-gradient(90deg, var(--accent-cyan), var(--success));
        }

        .insight-label {
            font-size: 0.6rem;
            letter-spacing: 0.15em;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .insight-vocabulary .insight-label { color: var(--accent-purple); }
        .insight-mantra .insight-label { color: var(--gold-primary); }
        .insight-quote .insight-label { color: var(--accent-cyan); }

        .insight-term {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.25rem;
            color: var(--text-primary);
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .insight-definition {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .insight-example {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-style: italic;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-subtle);
        }

        .insight-module-tag {
            display: inline-block;
            font-size: 0.6rem;
            padding: 0.2rem 0.5rem;
            background: rgba(139, 92, 246, 0.15);
            border-radius: 4px;
            color: var(--accent-purple);
            margin-top: 0.5rem;
        }

        .insight-mantra-text {
            font-family: 'Crimson Pro', serif;
            font-size: 1.1rem;
            color: var(--text-primary);
            font-style: italic;
            line-height: 1.6;
        }

        .insight-quote-text {
            font-family: 'Crimson Pro', serif;
            font-size: 1rem;
            color: var(--text-primary);
            font-style: italic;
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .insight-quote-author {
            font-size: 0.75rem;
            color: var(--accent-cyan);
            text-align: right;
        }

        /* Wisdom Expansion Section */
        .wisdom-expansion {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }

        .book-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
        }

        .book-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--warning), var(--gold-primary));
        }

        .book-label {
            font-size: 0.6rem;
            letter-spacing: 0.15em;
            color: var(--warning);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .book-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            color: var(--text-primary);
            letter-spacing: 0.05em;
        }

        .book-author {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
        }

        .book-insight {
            font-family: 'Crimson Pro', serif;
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-style: italic;
            line-height: 1.5;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-subtle);
        }

        .book-category {
            display: inline-block;
            font-size: 0.6rem;
            padding: 0.2rem 0.5rem;
            background: rgba(245, 158, 11, 0.15);
            border-radius: 4px;
            color: var(--warning);
            margin-top: 0.75rem;
        }

        .trait-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            padding: 1.25rem;
            position: relative;
            overflow: hidden;
        }

        .trait-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-pink), var(--danger));
        }

        .trait-label {
            font-size: 0.6rem;
            letter-spacing: 0.15em;
            color: var(--accent-pink);
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .trait-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            color: var(--text-primary);
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
        }

        .trait-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 0.75rem;
        }

        .trait-examples {
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-subtle);
        }

        .trait-example-item {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.8rem;
        }

        .trait-example-item:last-child {
            margin-bottom: 0;
        }

        .trait-example-name {
            color: var(--accent-pink);
            font-weight: 500;
            white-space: nowrap;
        }

        .trait-example-text {
            color: var(--text-muted);
        }

        /* Responsive adjustments */
        @media (max-width: 900px) {
            .daily-insights-strip {
                grid-template-columns: 1fr;
            }
            .wisdom-expansion {
                grid-template-columns: 1fr;
            }
        }

        /* Challenge Card */
        .challenge-card {
            background: var(--bg-surface);
            border: 2px solid var(--gold-dim);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .challenge-module {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.7rem;
            color: var(--gold-primary);
            padding: 0.3rem 0.75rem;
            background: rgba(212, 168, 71, 0.1);
            border-radius: 4px;
            margin-bottom: 1rem;
        }

        .challenge-text {
            font-size: 1.1rem;
            color: var(--text-primary);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .challenge-complete-btn {
            width: 100%;
        }

        /* Power Question */
        .power-question-card {
            text-align: center;
            padding: 2rem;
        }

        .power-question-text {
            font-family: 'Crimson Pro', serif;
            font-size: 1.5rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        /* Mindset Shift */
        .mindset-grid {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 1.5rem;
            align-items: center;
        }

        .mindset-box {
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
        }

        .mindset-from {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .mindset-to {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
        }

        .mindset-label {
            font-size: 0.65rem;
            letter-spacing: 0.15em;
            margin-bottom: 0.75rem;
        }

        .mindset-from .mindset-label { color: var(--danger); }
        .mindset-to .mindset-label { color: var(--success); }

        .mindset-text {
            font-family: 'Crimson Pro', serif;
            font-size: 1.2rem;
            color: var(--text-primary);
            font-style: italic;
        }

        .mindset-arrow {
            font-size: 2rem;
            color: var(--gold-primary);
        }

        .mindset-why {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-subtle);
            font-size: 0.85rem;
            color: var(--text-muted);
            text-align: center;
        }

        /* Habit List */
        .habit-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.25rem;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            margin-bottom: 0.75rem;
            cursor: pointer;
            transition: border-color 0.15s ease, transform 0.15s ease, opacity 0.15s ease;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        .habit-item:hover {
            border-color: var(--border-accent);
            transform: translateX(4px);
        }

        .habit-item.completed {
            opacity: 0.6;
        }

        .habit-item.completed .habit-name {
            text-decoration: line-through;
            color: var(--text-muted);
        }

        .habit-checkbox {
            width: 26px;
            height: 26px;
            border: 2px solid var(--border-accent);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.2s ease;
        }

        .habit-item.completed .habit-checkbox {
            background: var(--success);
            border-color: var(--success);
        }

        .habit-checkbox svg {
            width: 16px;
            height: 16px;
            color: white;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.2s ease;
        }

        .habit-item.completed .habit-checkbox svg {
            opacity: 1;
            transform: scale(1);
        }

        .habit-info {
            flex-grow: 1;
        }

        .habit-name {
            font-size: 0.95rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .habit-meta {
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .habit-streak {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            font-size: 0.85rem;
            color: var(--warning);
            font-weight: 500;
        }

        /* Module Cards */
        .module-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.25rem;
            transition: border-color 0.15s ease, transform 0.15s ease;
            cursor: pointer;
            -webkit-tap-highlight-color: transparent;
        }

        .module-card:hover {
            border-color: var(--border-accent);
            transform: translateY(-2px);
        }

        .module-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .module-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.25rem;
        }

        .module-title {
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .module-level {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .module-bar {
            height: 8px;
            background: var(--bg-deep);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.75rem;
        }

        .module-bar-fill {
            height: 100%;
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        .module-score {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
        }

        .module-score-current {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
        }

        .module-score-target {
            color: var(--text-muted);
        }

        /* Stats Grid */
        .stat-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.25rem;
            text-align: center;
        }

        .stat-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 2.5rem;
            color: var(--gold-primary);
            line-height: 1;
        }

        .stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            letter-spacing: 0.1em;
            margin-top: 0.5rem;
        }

        .stat-change {
            font-size: 0.75rem;
            margin-top: 0.5rem;
        }

        .stat-change.positive { color: var(--success); }
        .stat-change.negative { color: var(--danger); }

        /* Masters Library */
        .master-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: border-color 0.15s ease, transform 0.15s ease;
            -webkit-tap-highlight-color: transparent;
        }

        .master-card:hover {
            border-color: var(--gold-dim);
            transform: translateY(-4px);
        }

        .master-card-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.25rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .master-card-expertise {
            font-size: 0.75rem;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
        }

        .master-card-badges {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .master-card-badge {
            font-size: 0.6rem;
            padding: 0.2rem 0.5rem;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 4px;
            color: var(--text-muted);
        }

        .master-card-badge.examples { border-color: var(--accent-blue); color: var(--accent-blue); }
        .master-card-badge.scripts { border-color: var(--accent-purple); color: var(--accent-purple); }
        .master-card-badge.resources { border-color: var(--accent-cyan); color: var(--accent-cyan); }

        .master-card-principle {
            font-family: 'Crimson Pro', serif;
            font-size: 0.95rem;
            color: var(--text-secondary);
            font-style: italic;
            line-height: 1.5;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9) translateY(20px);
            transition: all 0.3s ease;
        }

        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-subtle);
        }

        .modal-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            letter-spacing: 0.1em;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            border: none;
            background: var(--bg-elevated);
            border-radius: 8px;
            color: var(--text-secondary);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .modal-close:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        /* Master Modal Tabs */
        .master-tabs {
            display: flex;
            gap: 0;
            border-bottom: 1px solid var(--border-subtle);
            margin: -1.5rem -1.5rem 1.5rem -1.5rem;
            padding: 0 1.5rem;
        }

        .master-tab {
            padding: 1rem 1.25rem;
            font-size: 0.75rem;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.2s ease;
            text-transform: uppercase;
            font-weight: 500;
        }

        .master-tab:hover {
            color: var(--text-secondary);
        }

        .master-tab.active {
            color: var(--gold-primary);
            border-bottom-color: var(--gold-primary);
        }

        .master-tab-content {
            display: none;
        }

        .master-tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Template Viewer */
        .template-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .template-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .template-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            color: var(--text-primary);
            letter-spacing: 0.05em;
        }

        .template-context {
            font-size: 0.8rem;
            color: var(--text-muted);
            margin-bottom: 1rem;
        }

        .template-content {
            background: var(--bg-deep);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 1rem;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: var(--text-secondary);
            white-space: pre-wrap;
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .template-content .blank {
            background: rgba(212, 168, 71, 0.2);
            color: var(--gold-primary);
            padding: 0.15rem 0.5rem;
            border-radius: 4px;
            border-bottom: 2px dashed var(--gold-dim);
        }

        .template-example {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 0.75rem;
        }

        .template-example-label {
            font-size: 0.65rem;
            color: var(--success);
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .template-example-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .copy-btn {
            padding: 0.4rem 0.75rem;
            font-size: 0.7rem;
            background: var(--bg-surface);
            border: 1px solid var(--border-accent);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 0.35rem;
        }

        .copy-btn:hover {
            background: var(--gold-primary);
            border-color: var(--gold-primary);
            color: var(--bg-void);
        }

        .copy-btn.copied {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        /* Worked Example Card */
        .example-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .example-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .example-scenario {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: var(--bg-deep);
            border-radius: 8px;
            border-left: 3px solid var(--accent-blue);
        }

        .example-framework {
            font-size: 0.7rem;
            color: var(--accent-purple);
            letter-spacing: 0.1em;
            margin-bottom: 0.75rem;
            text-transform: uppercase;
        }

        .example-steps {
            list-style: none;
            margin-bottom: 1rem;
        }

        .example-steps li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            font-size: 0.85rem;
            color: var(--text-secondary);
            border-bottom: 1px solid var(--border-subtle);
        }

        .example-steps li:last-child {
            border-bottom: none;
        }

        .example-steps li::before {
            content: counter(step);
            counter-increment: step;
            position: absolute;
            left: 0;
            width: 18px;
            height: 18px;
            background: var(--gold-dim);
            color: var(--bg-void);
            border-radius: 50%;
            font-size: 0.65rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        .example-steps {
            counter-reset: step;
        }

        .example-outcome {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.2);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 0.85rem;
            color: var(--success);
        }

        .example-outcome-label {
            font-size: 0.65rem;
            letter-spacing: 0.1em;
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            opacity: 0.8;
        }

        /* Resource Card */
        .resource-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            margin-bottom: 0.75rem;
        }

        .resource-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background: var(--bg-deep);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            flex-shrink: 0;
        }

        .resource-info {
            flex-grow: 1;
        }

        .resource-title {
            font-size: 0.9rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .resource-author {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .resource-takeaway {
            font-size: 0.8rem;
            color: var(--text-secondary);
            font-style: italic;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid var(--border-subtle);
        }

        /* Level Indicator */
        .level-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.25rem;
        }

        .level-name {
            font-size: 0.7rem;
            color: var(--gold-primary);
            font-weight: 500;
        }

        /* Progressive Exercise Selector */
        .difficulty-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .difficulty-btn {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
            border: 1px solid var(--border-subtle);
            border-radius: 6px;
            background: var(--bg-elevated);
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .difficulty-btn:hover {
            border-color: var(--border-accent);
            color: var(--text-secondary);
        }

        .difficulty-btn.active {
            background: var(--gold-primary);
            border-color: var(--gold-primary);
            color: var(--bg-void);
        }

        .difficulty-btn.beginner.active { background: var(--success); border-color: var(--success); }
        .difficulty-btn.intermediate.active { background: var(--warning); border-color: var(--warning); }
        .difficulty-btn.advanced.active { background: var(--danger); border-color: var(--danger); }

        /* Exercise Card */
        .exercise-card {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .exercise-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.75rem;
        }

        .exercise-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            color: var(--text-primary);
        }

        .exercise-meta {
            display: flex;
            gap: 0.75rem;
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        .exercise-difficulty {
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-weight: 500;
        }

        .exercise-difficulty.d1 { background: rgba(34, 197, 94, 0.2); color: var(--success); }
        .exercise-difficulty.d2 { background: rgba(245, 158, 11, 0.2); color: var(--warning); }
        .exercise-difficulty.d3 { background: rgba(239, 68, 68, 0.2); color: var(--danger); }

        .exercise-instructions {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .exercise-success {
            background: var(--bg-deep);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 0.8rem;
        }

        .exercise-success-label {
            font-size: 0.65rem;
            color: var(--success);
            letter-spacing: 0.1em;
            margin-bottom: 0.25rem;
            text-transform: uppercase;
        }

        .exercise-success-text {
            color: var(--text-muted);
        }

        /* Cross Module Connection Card */
        .connection-card {
            background: linear-gradient(135deg, var(--bg-elevated) 0%, var(--bg-surface) 100%);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
        }

        .connection-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .connection-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .connection-module {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            letter-spacing: 0.05em;
        }

        .connection-insight {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            line-height: 1.5;
        }

        .connection-exercise {
            background: var(--bg-deep);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 0.85rem;
            color: var(--text-muted);
            border-left: 3px solid var(--gold-dim);
        }

        /* Interactive Challenge */
        .challenge-response {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-subtle);
        }

        .challenge-response-label {
            font-size: 0.7rem;
            color: var(--gold-primary);
            letter-spacing: 0.1em;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }

        .challenge-input {
            width: 100%;
            min-height: 80px;
            padding: 0.875rem 1rem;
            background: var(--bg-deep);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            resize: vertical;
            transition: all 0.2s ease;
            margin-bottom: 0.75rem;
        }

        .challenge-input:focus {
            outline: none;
            border-color: var(--gold-primary);
            box-shadow: 0 0 0 3px rgba(212, 168, 71, 0.1);
        }

        .challenge-input::placeholder {
            color: var(--text-muted);
        }

        .challenge-actions {
            display: flex;
            gap: 0.5rem;
        }

        .challenge-actions .btn {
            flex: 1;
        }

        .challenge-saved {
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-top: 0.75rem;
        }

        .challenge-saved-label {
            font-size: 0.65rem;
            color: var(--success);
            letter-spacing: 0.1em;
            margin-bottom: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .challenge-saved-text {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .challenge-history {
            margin-top: 1rem;
        }

        .challenge-history-item {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
        }

        .challenge-history-date {
            font-size: 0.7rem;
            color: var(--text-muted);
            margin-bottom: 0.25rem;
        }

        .challenge-history-challenge {
            font-size: 0.8rem;
            color: var(--gold-primary);
            margin-bottom: 0.5rem;
        }

        .challenge-history-response {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        /* Gratitude Journal */
        .gratitude-card {
            background: linear-gradient(135deg, var(--bg-surface) 0%, rgba(212, 168, 71, 0.05) 100%);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.5rem;
        }

        .gratitude-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--gold-dim), var(--gold-primary), var(--gold-dim));
            border-radius: 12px 12px 0 0;
        }

        .gratitude-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .gratitude-item {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
        }

        .gratitude-number {
            width: 28px;
            height: 28px;
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-dim) 100%);
            color: var(--bg-void);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            flex-shrink: 0;
            margin-top: 0.5rem;
        }

        .gratitude-input {
            flex-grow: 1;
            padding: 0.75rem 1rem;
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            transition: all 0.2s ease;
            resize: none;
            min-height: 44px;
        }

        .gratitude-input:focus {
            outline: none;
            border-color: var(--gold-primary);
            box-shadow: 0 0 0 3px rgba(212, 168, 71, 0.1);
        }

        .gratitude-input::placeholder {
            color: var(--text-muted);
        }

        .gratitude-saved {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1rem;
            background: rgba(34, 197, 94, 0.1);
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 8px;
            font-size: 0.85rem;
            color: var(--success);
            margin-top: 0.75rem;
        }

        .gratitude-streak {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.8rem;
            color: var(--gold-primary);
            margin-top: 0.5rem;
        }

        .gratitude-history-item {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 0.75rem;
        }

        .gratitude-history-date {
            font-size: 0.75rem;
            color: var(--gold-primary);
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .gratitude-history-list {
            list-style: none;
        }

        .gratitude-history-list li {
            padding: 0.35rem 0;
            padding-left: 1.25rem;
            position: relative;
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .gratitude-history-list li::before {
            content: '';
            position: absolute;
            left: 0;
            color: var(--gold-dim);
            font-size: 0.7rem;
        }

        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border-subtle);
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
        }

        /* Check-in Steps */
        .checkin-step {
            display: none;
        }

        .checkin-step.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .step-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--bg-elevated);
            border: 2px solid var(--border-subtle);
        }

        .step-dot.active {
            background: var(--gold-primary);
            border-color: var(--gold-primary);
        }

        .step-dot.completed {
            background: var(--success);
            border-color: var(--success);
        }

        /* Priority Input */
        .priority-input {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .priority-number {
            width: 32px;
            height: 32px;
            background: var(--gold-primary);
            color: var(--bg-void);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .priority-input input {
            flex-grow: 1;
        }

        /* Wins/Lessons List */
        .reflection-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .reflection-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .reflection-item input {
            flex-grow: 1;
        }

        .add-item-btn {
            background: none;
            border: 1px dashed var(--border-accent);
            color: var(--text-muted);
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }

        .add-item-btn:hover {
            border-color: var(--gold-primary);
            color: var(--gold-primary);
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-deep);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border-accent);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-muted);
        }

        /* Weekly Review */
        .review-section {
            margin-bottom: 2rem;
        }

        .review-section-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            color: var(--text-secondary);
            letter-spacing: 0.1em;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            z-index: 2000;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .toast {
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideIn 0.3s ease;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast.success { border-left: 3px solid var(--success); }
        .toast.error { border-left: 3px solid var(--danger); }
        .toast.warning { border-left: 3px solid var(--warning); }

        .toast-icon {
            width: 24px;
            height: 24px;
        }

        .toast.success .toast-icon { color: var(--success); }
        .toast.error .toast-icon { color: var(--danger); }
        .toast.warning .toast-icon { color: var(--warning); }

        /* Progress Ring */
        .progress-ring-container {
            display: flex;
            justify-content: center;
            padding: 1rem;
        }

        .progress-ring {
            position: relative;
            width: 160px;
            height: 160px;
        }

        .progress-ring svg {
            transform: rotate(-90deg);
        }

        .progress-ring-bg {
            fill: none;
            stroke: var(--bg-deep);
            stroke-width: 10;
        }

        .progress-ring-fill {
            fill: none;
            stroke: var(--gold-primary);
            stroke-width: 10;
            stroke-linecap: round;
            stroke-dasharray: 440;
            stroke-dashoffset: 440;
            transition: stroke-dashoffset 1s ease;
        }

        .progress-ring-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
        }

        .progress-ring-value {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 3rem;
            color: var(--text-primary);
            line-height: 1;
        }

        .progress-ring-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            letter-spacing: 0.1em;
        }

        /* ============================================
           PROACTIVE JOURNAL STYLES
           ============================================ */

        /* Proactive Context Banner */
        .proactive-banner {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            background: linear-gradient(135deg, rgba(212, 168, 71, 0.15) 0%, rgba(212, 168, 71, 0.05) 100%);
            border: 1px solid rgba(212, 168, 71, 0.3);
            border-radius: 12px;
            margin-bottom: 1.5rem;
            animation: bannerPulse 3s ease-in-out infinite;
        }

        @keyframes bannerPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(212, 168, 71, 0.2); }
            50% { box-shadow: 0 0 20px 5px rgba(212, 168, 71, 0.1); }
        }

        .proactive-banner-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--gold-primary) 0%, var(--gold-dim) 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .proactive-banner-icon svg {
            width: 20px;
            height: 20px;
            color: var(--bg-void);
        }

        .proactive-banner-content {
            flex-grow: 1;
        }

        .proactive-banner-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1rem;
            letter-spacing: 0.1em;
            color: var(--gold-primary);
        }

        .proactive-banner-message {
            font-size: 0.85rem;
            color: var(--text-secondary);
        }

        .proactive-banner-action {
            flex-shrink: 0;
        }

        .proactive-banner-dismiss {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            padding: 0.5rem;
            transition: color 0.2s ease;
        }

        .proactive-banner-dismiss:hover {
            color: var(--text-primary);
        }

        .proactive-banner-dismiss svg {
            width: 16px;
            height: 16px;
        }

        /* Mode Selector */
        .journal-mode-selector {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            padding: 0.25rem;
            background: var(--bg-surface);
            border-radius: 12px;
            border: 1px solid var(--border-subtle);
        }

        .journal-mode-tab {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.875rem 1rem;
            background: transparent;
            border: none;
            border-radius: 10px;
            color: var(--text-secondary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .journal-mode-tab:hover {
            background: var(--bg-elevated);
            color: var(--text-primary);
        }

        .journal-mode-tab.active {
            background: var(--bg-elevated);
            color: var(--gold-primary);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .journal-mode-tab svg {
            width: 18px;
            height: 18px;
        }

        /* Journal Panels */
        .journal-panel {
            display: none;
        }

        .journal-panel.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Daily Ops Grid */
        .journal-daily-grid {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Framework Card */
        .framework-card {
            position: relative;
            background: linear-gradient(135deg, var(--bg-surface) 0%, rgba(212, 168, 71, 0.08) 100%);
            border-top: 3px solid transparent;
            border-image: linear-gradient(90deg, var(--gold-dim), var(--gold-primary), var(--gold-dim)) 1;
        }

        .framework-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .framework-source {
            font-size: 0.7rem;
            color: var(--gold-dim);
            letter-spacing: 0.1em;
            text-transform: uppercase;
        }

        .framework-shuffle-btn {
            background: var(--bg-elevated);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 0.5rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .framework-shuffle-btn:hover {
            border-color: var(--gold-primary);
            color: var(--gold-primary);
        }

        .framework-shuffle-btn svg {
            width: 16px;
            height: 16px;
        }

        .framework-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.5rem;
            letter-spacing: 0.05em;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .framework-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .framework-power {
            font-family: 'Crimson Pro', serif;
            font-style: italic;
            font-size: 1rem;
            color: var(--gold-primary);
            padding: 0.75rem 1rem;
            background: rgba(212, 168, 71, 0.1);
            border-radius: 8px;
            border-left: 3px solid var(--gold-primary);
        }

        /* Journal Section Cards */
        .journal-section-card {
            background: var(--bg-surface);
        }

        .journal-textarea {
            min-height: 80px;
            resize: vertical;
        }

        .execution-notes {
            min-height: 120px;
        }

        /* Framework Prompts */
        .framework-prompts-card {
            background: linear-gradient(135deg, var(--bg-surface) 0%, rgba(139, 92, 246, 0.05) 100%);
        }

        .framework-prompt-item {
            padding: 1rem;
            background: var(--bg-elevated);
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .framework-prompt-item:last-child {
            margin-bottom: 0;
        }

        .framework-prompt-number {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 0.9rem;
            color: var(--accent-purple);
            margin-bottom: 0.5rem;
        }

        .framework-prompt-text {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            line-height: 1.4;
        }

        .framework-prompt-input {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: 6px;
            color: var(--text-primary);
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            resize: vertical;
            min-height: 60px;
        }

        .framework-prompt-input:focus {
            outline: none;
            border-color: var(--accent-purple);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        /* AAR Card */
        .aar-card {
            background: linear-gradient(135deg, var(--bg-surface) 0%, rgba(34, 197, 94, 0.05) 100%);
        }

        .aar-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        /* Journal Actions */
        .journal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.75rem;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-subtle);
        }

        /* Deep Dive Selector */
        .deep-dive-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
        }

        .deep-dive-type-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .deep-dive-type-card:hover {
            border-color: var(--gold-primary);
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
        }

        .deep-dive-type-icon {
            width: 48px;
            height: 48px;
            background: var(--bg-elevated);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
        }

        .deep-dive-type-icon svg {
            width: 24px;
            height: 24px;
            color: var(--gold-primary);
        }

        .deep-dive-type-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 0.05em;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .deep-dive-type-source {
            font-size: 0.75rem;
            color: var(--gold-dim);
            margin-bottom: 0.5rem;
        }

        .deep-dive-type-desc {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        /* Deep Dive Modal */
        .deep-dive-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid var(--border-subtle);
        }

        .deep-dive-source {
            font-size: 0.75rem;
            color: var(--gold-dim);
            letter-spacing: 0.1em;
        }

        .deep-dive-progress {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .deep-dive-step-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.25rem;
            letter-spacing: 0.05em;
            color: var(--gold-primary);
            margin-bottom: 0.75rem;
        }

        .deep-dive-step-prompt {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
            margin-bottom: 1rem;
        }

        .deep-dive-textarea {
            width: 100%;
            min-height: 150px;
            resize: vertical;
        }

        /* Patterns Grid */
        .patterns-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }

        .pattern-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: var(--bg-elevated);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        .pattern-item-icon {
            width: 32px;
            height: 32px;
            background: var(--bg-surface);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
        }

        .pattern-item-content {
            flex-grow: 1;
        }

        .pattern-item-name {
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .pattern-item-count {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .pattern-item-bar {
            height: 4px;
            background: var(--bg-surface);
            border-radius: 2px;
            margin-top: 0.25rem;
            overflow: hidden;
        }

        .pattern-item-bar-fill {
            height: 100%;
            background: var(--gold-primary);
            border-radius: 2px;
        }

        /* Blind spot items */
        .blind-spot-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            border-radius: 8px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .blind-spot-item:hover {
            background: rgba(239, 68, 68, 0.15);
            border-color: rgba(239, 68, 68, 0.5);
        }

        .blind-spot-icon {
            color: var(--danger);
        }

        .blind-spot-name {
            font-size: 0.9rem;
            color: var(--text-primary);
        }

        .blind-spot-days {
            font-size: 0.75rem;
            color: var(--danger);
            margin-left: auto;
        }

        /* History Filters */
        .history-filters {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .history-filter {
            width: auto;
            min-width: 140px;
        }

        .history-search {
            flex-grow: 1;
        }

        /* History List */
        .history-list {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .history-entry {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.25rem;
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .history-entry:hover {
            border-color: var(--gold-primary);
            background: var(--bg-elevated);
        }

        .history-entry-type {
            width: 40px;
            height: 40px;
            background: var(--bg-elevated);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .history-entry-type svg {
            width: 20px;
            height: 20px;
            color: var(--gold-primary);
        }

        .history-entry-type.deep-dive {
            background: rgba(139, 92, 246, 0.2);
        }

        .history-entry-type.deep-dive svg {
            color: var(--accent-purple);
        }

        .history-entry-content {
            flex-grow: 1;
            min-width: 0;
        }

        .history-entry-title {
            font-size: 0.9rem;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .history-entry-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .history-entry-framework {
            color: var(--gold-dim);
        }

        .history-entry-score {
            margin-left: auto;
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.25rem;
            color: var(--text-muted);
        }

        .history-entry-score.high {
            color: var(--success);
        }

        .history-entry-score.medium {
            color: var(--warning);
        }

        .history-entry-score.low {
            color: var(--danger);
        }

        /* Journal View Modal Content */
        .journal-view-section {
            margin-bottom: 1.5rem;
        }

        .journal-view-section:last-child {
            margin-bottom: 0;
        }

        .journal-view-label {
            font-size: 0.7rem;
            color: var(--gold-dim);
            letter-spacing: 0.1em;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }

        .journal-view-content {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.5;
            padding: 0.75rem 1rem;
            background: var(--bg-elevated);
            border-radius: 8px;
        }

        .journal-view-framework {
            padding: 1rem;
            background: linear-gradient(135deg, rgba(212, 168, 71, 0.1) 0%, rgba(212, 168, 71, 0.05) 100%);
            border-radius: 8px;
            border-left: 3px solid var(--gold-primary);
        }

        .journal-view-framework-name {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            color: var(--gold-primary);
            margin-bottom: 0.25rem;
        }

        .journal-view-framework-source {
            font-size: 0.75rem;
            color: var(--gold-dim);
        }

        /* Responsive Journal */
        @media (max-width: 900px) {
            .deep-dive-selector {
                grid-template-columns: repeat(2, 1fr);
            }

            .patterns-grid {
                grid-template-columns: 1fr;
            }

            .aar-grid {
                grid-template-columns: 1fr;
            }

            .history-filters {
                flex-wrap: wrap;
            }

            .history-filter {
                flex: 1;
                min-width: 120px;
            }

            .history-search {
                width: 100%;
                flex: none;
            }
        }

        /* ============================================
           COMMAND CENTER - Vision, OKRs, Battle Plan
           ============================================ */
        .command-center {
            background: var(--bg-surface);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            margin-bottom: 1.5rem;
            overflow: hidden;
        }

        .command-center-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 1.25rem;
            background: linear-gradient(135deg, rgba(212, 168, 71, 0.08) 0%, transparent 60%);
            border-bottom: 1px solid var(--border-subtle);
        }

        .command-center-title {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.1rem;
            letter-spacing: 0.15em;
            color: var(--gold-primary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .command-center-week {
            font-size: 0.75rem;
            color: var(--text-muted);
            padding: 0.25rem 0.5rem;
            background: var(--bg-elevated);
            border-radius: 4px;
        }

        .vision-statement {
            padding: 1rem 1.25rem;
            background: rgba(212, 168, 71, 0.03);
            border-bottom: 1px solid var(--border-subtle);
        }

        .vision-label {
            font-size: 0.6rem;
            color: var(--gold-dim);
            letter-spacing: 0.15em;
            margin-bottom: 0.35rem;
        }

        .vision-text {
            font-family: 'Crimson Pro', serif;
            font-size: 1rem;
            font-style: italic;
            color: var(--text-primary);
            line-height: 1.4;
        }

        .okr-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1px;
            background: var(--border-subtle);
        }

        .okr-card {
            background: var(--bg-surface);
            padding: 1rem;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .okr-card:hover {
            background: var(--bg-elevated);
        }

        .okr-module-badge {
            font-size: 0.55rem;
            letter-spacing: 0.1em;
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
            margin-bottom: 0.5rem;
            display: inline-block;
        }

        .okr-module-sales { background: rgba(239, 68, 68, 0.15); color: #f87171; }
        .okr-module-money { background: rgba(34, 197, 94, 0.15); color: #4ade80; }
        .okr-module-business { background: rgba(59, 130, 246, 0.15); color: #60a5fa; }
        .okr-module-productivity { background: rgba(168, 85, 247, 0.15); color: #c084fc; }
        .okr-module-mindset { background: rgba(251, 191, 36, 0.15); color: #fcd34d; }

        .okr-objective {
            font-size: 0.8rem;
            color: var(--text-primary);
            font-weight: 500;
            margin-bottom: 0.75rem;
            line-height: 1.3;
        }

        .okr-progress-bar {
            height: 6px;
            background: var(--bg-hover);
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 0.35rem;
        }

        .okr-progress-fill {
            height: 100%;
            border-radius: 3px;
            transition: width 0.5s ease;
        }

        .okr-progress-fill.green { background: var(--success); }
        .okr-progress-fill.yellow { background: var(--warning); }
        .okr-progress-fill.red { background: var(--danger); }

        .okr-progress-text {
            font-size: 0.7rem;
            color: var(--text-muted);
            display: flex;
            justify-content: space-between;
        }

        .battle-plan-section {
            padding: 1rem 1.25rem;
            border-top: 1px solid var(--border-subtle);
        }

        .battle-plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .battle-plan-title {
            font-size: 0.65rem;
            color: var(--text-muted);
            letter-spacing: 0.15em;
        }

        .battle-plan-stats {
            font-size: 0.7rem;
            color: var(--gold-primary);
        }

        .battle-plan-items {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .battle-plan-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.6rem 0.75rem;
            background: var(--bg-elevated);
            border-radius: 6px;
            border-left: 3px solid var(--border-accent);
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .battle-plan-item:hover {
            background: var(--bg-hover);
            border-left-color: var(--gold-primary);
        }

        .battle-plan-item.completed {
            opacity: 0.6;
            border-left-color: var(--success);
        }

        .battle-plan-item.in-progress {
            border-left-color: var(--warning);
        }

        .battle-plan-priority {
            width: 20px;
            height: 20px;
            background: var(--gold-primary);
            color: var(--bg-void);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: 600;
            flex-shrink: 0;
        }

        .battle-plan-content {
            flex: 1;
            min-width: 0;
        }

        .battle-plan-outcome {
            font-size: 0.85rem;
            color: var(--text-primary);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .battle-plan-module {
            font-size: 0.6rem;
            color: var(--text-muted);
            margin-top: 0.15rem;
        }

        .battle-plan-hours {
            font-size: 0.7rem;
            color: var(--text-muted);
            flex-shrink: 0;
        }

        /* Deep Work Tracker */
        .deep-work-tracker {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1.25rem;
            background: rgba(139, 92, 246, 0.05);
            border-top: 1px solid var(--border-subtle);
        }

        .deep-work-label {
            font-size: 0.65rem;
            color: var(--accent-purple);
            letter-spacing: 0.1em;
        }

        .deep-work-progress {
            flex: 1;
            height: 8px;
            background: var(--bg-hover);
            border-radius: 4px;
            overflow: hidden;
        }

        .deep-work-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue));
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .deep-work-count {
            font-size: 0.85rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        /* OKR Detail Modal Styles */
        .okr-detail-header {
            margin-bottom: 1.5rem;
        }

        .okr-detail-objective {
            font-family: 'Bebas Neue', sans-serif;
            font-size: 1.4rem;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .okr-detail-why {
            font-size: 0.9rem;
            color: var(--text-secondary);
            font-style: italic;
        }

        .key-results-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .key-result-item {
            background: var(--bg-elevated);
            border-radius: 8px;
            padding: 1rem;
        }

        .key-result-desc {
            font-size: 0.9rem;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .key-result-progress {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .key-result-bar {
            flex: 1;
            height: 10px;
            background: var(--bg-hover);
            border-radius: 5px;
            overflow: hidden;
        }

        .key-result-fill {
            height: 100%;
            border-radius: 5px;
        }

        .key-result-values {
            font-size: 0.8rem;
            color: var(--text-secondary);
            min-width: 80px;
            text-align: right;
        }

        @media (max-width: 600px) {
            .journal-mode-tab span:not(.journal-mode-tab svg) {
                display: none;
            }

            .deep-dive-selector {
                grid-template-columns: 1fr;
            }
        }

        /* Responsive */
        @media (max-width: 1200px) {
            .grid-3 { grid-template-columns: repeat(2, 1fr); }
            .grid-4 { grid-template-columns: repeat(2, 1fr); }
        }

        /* Desktop-only: 900px+ handled by default sidebar styles */
        /* Mobile handled by 768px breakpoint above */
    </style>
</head>
<body>
    <div class="grid-pattern"></div>

    <!-- Mobile Header -->
    <header class="mobile-header" id="mobileHeader">
        <button class="hamburger" id="hamburgerBtn" aria-label="Toggle navigation">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="18" x2="21" y2="18"/>
            </svg>
        </button>
        <span class="mobile-logo">MASTERMIND</span>
    </header>
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon"></div>
                    MASTERMIND ALLIANCE
                </div>
            </div>

            <nav class="nav-section">
                <div class="nav-label">Main</div>
                <div class="nav-item active" onclick="showPage('dashboard')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
                        <rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/>
                    </svg>
                    <span class="nav-item-text">Dashboard</span>
                </div>
                <div class="nav-item" onclick="showPage('journal')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                    </svg>
                    <span class="nav-item-text">Journal</span>
                </div>
                <div class="nav-item" onclick="showPage('plans')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                    </svg>
                    <span class="nav-item-text">Plans</span>
                </div>
                <div class="nav-item" onclick="showPage('systems')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    <span class="nav-item-text">Systems</span>
                </div>

                <div class="nav-label">Learn</div>
                <div class="nav-item" onclick="showPage('masters')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                    </svg>
                    <span class="nav-item-text">Masters Library</span>
                </div>

                <div class="nav-label">Config</div>
                <div class="nav-item" onclick="showPage('settings')">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="4" y1="21" x2="4" y2="14"/><line x1="4" y1="10" x2="4" y2="3"/><line x1="12" y1="21" x2="12" y2="12"/><line x1="12" y1="8" x2="12" y2="3"/><line x1="20" y1="21" x2="20" y2="16"/><line x1="20" y1="12" x2="20" y2="3"/><line x1="1" y1="14" x2="7" y2="14"/><line x1="9" y1="8" x2="15" y2="8"/><line x1="17" y1="16" x2="23" y2="16"/>
                    </svg>
                    <span class="nav-item-text">Settings</span>
                </div>
            </nav>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title" id="pageTitle">COMMAND CENTER</h1>
                    <p class="page-subtitle" id="pageSubtitle">Your daily mission control</p>
                </div>
                <div class="date-display">
                    <div class="current-date" id="currentDate"></div>
                    <div class="current-time" id="currentTime"></div>
                </div>
            </div>

            <!-- Dashboard Page -->
            <section class="page-section active" id="page-dashboard">
                <!-- Command Center Stats Bar -->
                <div class="grid-4" style="margin-bottom: 1.5rem;">
                    <div class="stat-card">
                        <div class="stat-value" id="statStreak">0</div>
                        <div class="stat-label">DAY STREAK</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statHabits">0%</div>
                        <div class="stat-label">HABITS COMPLETE</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statDeepWork">0h</div>
                        <div class="stat-label">DEEP WORK TODAY</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="statAvgScore">0</div>
                        <div class="stat-label">AVG DAY SCORE</div>
                    </div>
                </div>

                <!-- Main Dashboard Grid: Left (40%) / Right (60%) -->
                <div class="dashboard-main-grid">
                    <!-- LEFT COLUMN: Wisdom, Plan, Mantra -->
                    <div class="dashboard-left">
                        <!-- Today's Wisdom -->
                        <div class="wisdom-hero">
                            <div class="master-badge">
                                <span class="master-name" id="dashMasterName">Loading...</span>
                                <span class="master-expertise" id="dashMasterExpertise"></span>
                            </div>
                            <div class="wisdom-quote" id="dashWisdomQuote">"Loading wisdom..."</div>
                            <div class="wisdom-practice">
                                <div class="practice-label">APPLY TODAY</div>
                                <div class="practice-text" id="dashPractice">Loading...</div>
                            </div>
                        </div>

                        <!-- Today's Plan (from morning check-in) -->
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/>
                                    </svg>
                                    TODAY'S PLAN
                                </div>
                            </div>
                            <div id="todaysPlanContent">
                                <div class="todays-priorities" id="todaysPriorities">
                                    <div style="color: var(--text-muted); font-size: 0.9rem; padding: 1rem 0;">
                                        Complete your morning check-in to set today's priorities
                                    </div>
                                </div>
                                <div class="todays-win" id="todaysWin" style="display: none;">
                                    <div class="win-label">TODAY'S WIN</div>
                                    <div class="win-text" id="todaysWinText"></div>
                                </div>
                            </div>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-top: 1rem;">
                                <button class="btn btn-primary" onclick="openMorningCheckin()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="5"/><path d="M12 1v2"/>
                                    </svg>
                                    Morning
                                </button>
                                <button class="btn" onclick="openEveningReflection()">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M21 12.79A9 9 0 1 1 11.21 3"/>
                                    </svg>
                                    Evening
                                </button>
                            </div>
                        </div>

                        <!-- Daily Mantra -->
                        <div class="insight-card insight-mantra" style="margin-top: 1rem;">
                            <div class="insight-label">
                                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/>
                                </svg>
                                DAILY MANTRA
                            </div>
                            <div class="insight-mantra-text" id="dashMantraText">"Loading mantra..."</div>
                        </div>
                    </div>

                    <!-- RIGHT COLUMN: Full Habits Tracker + Quick Journal -->
                    <div class="dashboard-right">
                        <!-- Full Habits Tracker -->
                        <div class="card habits-tracker-card">
                            <div class="card-header">
                                <div class="card-title">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                    </svg>
                                    HABIT TRACKER
                                </div>
                                <span class="card-badge" id="dashHabitProgress">0/0</span>
                            </div>

                            <!-- Progress Ring -->
                            <div class="habits-progress-section">
                                <div class="progress-ring-container" style="padding: 0.5rem;">
                                    <div class="progress-ring" style="width: 120px; height: 120px;">
                                        <svg width="120" height="120" viewBox="0 0 120 120">
                                            <circle class="progress-ring-bg" cx="60" cy="60" r="50" style="stroke-width: 8;"/>
                                            <circle class="progress-ring-fill" id="habitProgressRing" cx="60" cy="60" r="50" style="stroke-width: 8; stroke-dasharray: 314.159; stroke-dashoffset: 314.159;"/>
                                        </svg>
                                        <div class="progress-ring-text">
                                            <div class="progress-ring-value" id="habitProgressValue" style="font-size: 2rem;">0%</div>
                                            <div class="progress-ring-label">DONE</div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- All Habits List -->
                            <div id="dashHabitList" class="full-habits-list">
                                <!-- All habits rendered here -->
                            </div>

                            <!-- Add Habit Button -->
                            <button class="btn btn-block" onclick="openAddHabitModal()" style="margin-top: 1rem;">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
                                </svg>
                                Add New Habit
                            </button>
                        </div>

                        <!-- Quick Journal -->
                        <div class="card" style="margin-top: 1rem;">
                            <div class="card-header">
                                <div class="card-title">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M12 20h9"/><path d="M16.5 3.5a2.121 2.121 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"/>
                                    </svg>
                                    QUICK JOURNAL
                                </div>
                                <span class="card-badge quick-journal-status" id="quickJournalStatus">Saved</span>
                            </div>
                            <textarea class="form-textarea quick-journal-input" id="quickJournalInput" placeholder="Capture your thoughts, observations, wins, lessons..." rows="4"></textarea>
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 0.75rem;">
                                <button class="btn" onclick="showPage('journal')" style="font-size: 0.8rem;">
                                    View Past Entries
                                </button>
                                <span class="text-muted" style="font-size: 0.75rem;" id="quickJournalTimestamp"></span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Command Center: Vision, OKRs, Weekly Battle Plan -->
                <div class="command-center" style="margin-top: 1.5rem;">
                    <div class="command-center-header">
                        <div class="command-center-title">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polygon points="12 2 22 8.5 22 15.5 12 22 2 15.5 2 8.5 12 2"/>
                                <line x1="12" y1="22" x2="12" y2="15.5"/><polyline points="22 8.5 12 15.5 2 8.5"/>
                            </svg>
                            COMMAND CENTER
                        </div>
                        <span class="command-center-week" id="currentWeekBadge">Week 6</span>
                    </div>

                    <!-- Vision Statement -->
                    <div class="vision-statement">
                        <div class="vision-label">10-YEAR VISION</div>
                        <div class="vision-text" id="visionStatement">Loading vision...</div>
                    </div>

                    <!-- Quarter OKR Progress -->
                    <div class="okr-grid" id="okrGrid">
                        <!-- OKR cards rendered here -->
                    </div>

                    <!-- Weekly Battle Plan -->
                    <div class="battle-plan-section">
                        <div class="battle-plan-header">
                            <div class="battle-plan-title">THIS WEEK'S BATTLE PLAN</div>
                            <div class="battle-plan-stats" id="battlePlanStats">0/0 complete</div>
                        </div>
                        <div class="battle-plan-items" id="battlePlanItems">
                            <!-- Battle plan items rendered here -->
                        </div>
                    </div>

                    <!-- Deep Work Progress -->
                    <div class="deep-work-tracker">
                        <div class="deep-work-label">DEEP WORK</div>
                        <div class="deep-work-progress">
                            <div class="deep-work-fill" id="deepWorkFill" style="width: 0%;"></div>
                        </div>
                        <div class="deep-work-count" id="deepWorkCount">0/20 hrs</div>
                    </div>
                </div>

                <!-- 10 Power Words (Collapsible Accordion) -->
                <div class="collapsible-section" style="margin-top: 1rem;">
                    <div class="collapsible-header" onclick="toggleCollapsible('powerWordsSection')">
                        <div class="card-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                            </svg>
                            10 POWER WORDS
                        </div>
                        <svg class="collapsible-arrow" id="powerWordsArrow" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="6 9 12 15 18 9"/>
                        </svg>
                    </div>
                    <div class="collapsible-content" id="powerWordsSection" style="display: none;">
                        <div class="power-words-accordion" id="powerWordsAccordion">
                            <!-- 10 vocabulary words rendered here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Plans Page -->
            <section class="page-section" id="page-plans">
                <!-- Vision & Mission Header -->
                <div class="card" style="margin-bottom: 1.5rem; background: linear-gradient(135deg, rgba(212, 168, 71, 0.08) 0%, var(--bg-surface) 60%);">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div style="flex: 1;">
                            <div style="font-size: 0.65rem; color: var(--gold-dim); letter-spacing: 0.15em; margin-bottom: 0.5rem;">10-YEAR VISION</div>
                            <div style="font-family: 'Crimson Pro', serif; font-size: 1.2rem; font-style: italic; color: var(--text-primary); line-height: 1.4; margin-bottom: 1.25rem;" id="plansVisionFull">Loading...</div>
                            <div style="font-size: 0.65rem; color: var(--text-muted); letter-spacing: 0.15em; margin-bottom: 0.35rem;">5-YEAR MISSION</div>
                            <div style="font-size: 0.95rem; color: var(--text-secondary);" id="plansMissionFull">Loading...</div>
                        </div>
                        <div style="text-align: right; padding-left: 2rem;">
                            <div style="font-family: 'Bebas Neue', sans-serif; font-size: 2.5rem; color: var(--gold-primary);" id="plansQuarterLabel">Q1</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);" id="plansQuarterTheme">Build Foundation</div>
                        </div>
                    </div>
                </div>

                <!-- OKR Cards -->
                <div style="font-size: 0.65rem; color: var(--text-muted); letter-spacing: 0.15em; margin-bottom: 0.75rem;">QUARTERLY OBJECTIVES</div>
                <div class="grid-3" id="plansOkrGrid" style="margin-bottom: 1.5rem;">
                    <!-- Full OKR cards rendered here -->
                </div>

                <!-- Weekly Battle Plan Full View -->
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/>
                            </svg>
                            WEEKLY BATTLE PLAN
                        </div>
                        <div style="display: flex; align-items: center; gap: 1rem;">
                            <span id="plansWeekLabel" style="font-size: 0.75rem; color: var(--text-muted);">Week 6</span>
                            <span id="plansWeekTheme" style="font-size: 0.8rem; color: var(--gold-primary);"></span>
                        </div>
                    </div>
                    <div id="plansWeeklyItems">
                        <!-- Weekly battle plan items rendered here -->
                    </div>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--border-subtle);">
                        <div style="display: flex; gap: 2rem;">
                            <div>
                                <div style="font-size: 0.6rem; color: var(--text-muted); letter-spacing: 0.1em;">DEEP WORK TARGET</div>
                                <div style="font-size: 1.25rem; color: var(--accent-purple); font-weight: 600;" id="plansDeepWorkTarget">20h</div>
                            </div>
                            <div>
                                <div style="font-size: 0.6rem; color: var(--text-muted); letter-spacing: 0.1em;">ESTIMATED HOURS</div>
                                <div style="font-size: 1.25rem; color: var(--text-primary); font-weight: 600;" id="plansTotalHours">0h</div>
                            </div>
                        </div>
                        <button class="btn btn-primary" onclick="openWeeklyReview()">Weekly Review</button>
                    </div>
                </div>
            </section>

            <!-- Systems Page -->
            <section class="page-section" id="page-systems">
                <div class="grid-2">
                    <div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">
                                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <circle cx="12" cy="12" r="3"/>
                                        <path d="M12 1v6m0 6v10"/>
                                    </svg>
                                    MY SYSTEMS
                                </div>
                                <button class="btn" onclick="openCreateSystemModal()">+ New System</button>
                            </div>
                            <div id="systemsList">
                                <div style="color: var(--text-muted); text-align: center; padding: 2rem;">
                                    No systems yet. Build your first repeatable system!
                                </div>
                            </div>
                        </div>
                    </div>
                    <div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">SYSTEM PERFORMANCE</div>
                            </div>
                            <div id="systemsPerformance">
                                <div style="color: var(--text-muted); text-align: center; padding: 2rem;">
                                    Track your systems to see performance metrics
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Masters Page -->
            <section class="page-section" id="page-masters">
                <div class="grid-3" id="mastersGrid">
                    <!-- Master cards rendered here -->
                </div>
            </section>

            <!-- Proactive Journal Page -->
            <section class="page-section" id="page-journal">
                <!-- Proactive Context Banner -->
                <div class="proactive-banner" id="proactiveBanner" style="display: none;">
                    <div class="proactive-banner-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/>
                        </svg>
                    </div>
                    <div class="proactive-banner-content">
                        <div class="proactive-banner-title" id="proactiveBannerTitle">Framework Recommended</div>
                        <div class="proactive-banner-message" id="proactiveBannerMessage">Based on your recent activity...</div>
                    </div>
                    <button class="btn btn-primary proactive-banner-action" id="proactiveBannerAction">Apply Framework</button>
                    <button class="proactive-banner-dismiss" onclick="dismissProactiveBanner()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>

                <!-- Mode Selector -->
                <div class="journal-mode-selector">
                    <button class="journal-mode-tab active" data-mode="daily" onclick="setJournalMode('daily')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
                        </svg>
                        Daily Ops
                    </button>
                    <button class="journal-mode-tab" data-mode="deepdive" onclick="setJournalMode('deepdive')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/>
                        </svg>
                        Deep Dive
                    </button>
                    <button class="journal-mode-tab" data-mode="patterns" onclick="setJournalMode('patterns')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                        </svg>
                        Patterns
                    </button>
                    <button class="journal-mode-tab" data-mode="history" onclick="setJournalMode('history')">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 3v5h5"/><path d="M3.05 13A9 9 0 1 0 6 5.3L3 8"/>
                        </svg>
                        History
                    </button>
                </div>

                <!-- Daily Ops Panel -->
                <div class="journal-panel active" id="journalPanelDaily">
                    <div class="journal-daily-grid">
                        <!-- Framework Card -->
                        <div class="card framework-card" id="frameworkCard">
                            <div class="framework-card-header">
                                <div class="framework-source" id="frameworkSource">Marcus Aurelius / Seneca</div>
                                <button class="framework-shuffle-btn" onclick="shuffleFramework()" title="Try different framework">
                                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="1 4 1 10 7 10"/><polyline points="23 20 23 14 17 14"/>
                                        <path d="M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 0 1 3.51 15"/>
                                    </svg>
                                </button>
                            </div>
                            <div class="framework-name" id="frameworkName">Stoic Premeditatio Malorum</div>
                            <div class="framework-description" id="frameworkDescription">Mentally rehearse potential obstacles to eliminate surprise and prepare responses.</div>
                            <div class="framework-power" id="frameworkPower">"I am prepared for whatever comes. Nothing will surprise me."</div>
                        </div>

                        <!-- Situation Analysis -->
                        <div class="card journal-section-card">
                            <div class="card-header">
                                <div class="card-title">SITUATION ANALYSIS</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Current Reality (1-2 sentences)</label>
                                <textarea class="form-textarea journal-textarea" id="journalSituation" placeholder="What is the state of things right now?"></textarea>
                            </div>
                        </div>

                        <!-- Strategic Intent -->
                        <div class="card journal-section-card">
                            <div class="card-header">
                                <div class="card-title">STRATEGIC INTENT</div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Specific Outcome Being Engineered</label>
                                <textarea class="form-textarea journal-textarea" id="journalIntent" placeholder="What specific result are you creating today?"></textarea>
                            </div>
                        </div>

                        <!-- Framework Prompts -->
                        <div class="card journal-section-card framework-prompts-card">
                            <div class="card-header">
                                <div class="card-title">FRAMEWORK APPLICATION</div>
                            </div>
                            <div id="frameworkPrompts">
                                <!-- Framework prompts rendered here -->
                            </div>
                        </div>

                        <!-- Execution Notes -->
                        <div class="card journal-section-card">
                            <div class="card-header">
                                <div class="card-title">EXECUTION NOTES</div>
                                <span class="card-subtitle">Capture throughout the day</span>
                            </div>
                            <div class="form-group">
                                <textarea class="form-textarea journal-textarea execution-notes" id="journalExecution" placeholder="Real-time capture: what happened, what you learned, observations..."></textarea>
                            </div>
                        </div>

                        <!-- After-Action Review -->
                        <div class="card journal-section-card aar-card">
                            <div class="card-header">
                                <div class="card-title">AFTER-ACTION REVIEW</div>
                                <span class="card-subtitle">Complete at end of day</span>
                            </div>
                            <div class="aar-grid">
                                <div class="form-group">
                                    <label class="form-label">What Worked</label>
                                    <textarea class="form-textarea journal-textarea" id="journalAarWorked" placeholder="What went well today?"></textarea>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">What Didn't Work</label>
                                    <textarea class="form-textarea journal-textarea" id="journalAarFailed" placeholder="What fell short?"></textarea>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Intent vs Outcome Delta</label>
                                <textarea class="form-textarea journal-textarea" id="journalAarDelta" placeholder="Did you achieve your strategic intent? What was the gap?"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Day Score (1-10)</label>
                                <input type="range" class="form-range" id="journalDayScore" min="1" max="10" value="7">
                                <div class="range-value" id="journalDayScoreValue">7</div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="journal-actions">
                        <button class="btn" onclick="saveJournalDraft()">Save Draft</button>
                        <button class="btn btn-primary" onclick="saveJournalEntry('daily')">Complete Entry</button>
                    </div>
                </div>

                <!-- Deep Dive Panel -->
                <div class="journal-panel" id="journalPanelDeepdive">
                    <div class="deep-dive-selector" id="deepDiveSelector">
                        <!-- Deep dive type cards rendered here -->
                    </div>
                </div>

                <!-- Patterns Panel -->
                <div class="journal-panel" id="journalPanelPatterns">
                    <div class="patterns-grid">
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">RECURRING THEMES</div>
                            </div>
                            <div id="patternThemes">
                                <p class="text-muted">Complete 5+ entries to see patterns</p>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <div class="card-title">BLIND SPOTS</div>
                            </div>
                            <div id="patternBlindSpots">
                                <p class="text-muted">Modules you haven't journaled about</p>
                            </div>
                        </div>
                    </div>
                    <div class="card" style="margin-top: 1.5rem;">
                        <div class="card-header">
                            <div class="card-title">FRAMEWORK USAGE</div>
                        </div>
                        <div id="patternFrameworks">
                            <p class="text-muted">Which frameworks are you using most?</p>
                        </div>
                    </div>
                </div>

                <!-- History Panel -->
                <div class="journal-panel" id="journalPanelHistory">
                    <div class="history-filters">
                        <select class="form-select history-filter" id="historyTypeFilter" onchange="filterJournalHistory()">
                            <option value="all">All Types</option>
                            <option value="daily">Daily Ops</option>
                            <option value="deepdive">Deep Dives</option>
                        </select>
                        <select class="form-select history-filter" id="historyModuleFilter" onchange="filterJournalHistory()">
                            <option value="all">All Modules</option>
                        </select>
                        <input type="text" class="form-input history-search" id="historySearch" placeholder="Search entries..." oninput="debouncedFilterHistory()">
                    </div>
                    <div class="history-list" id="historyList">
                        <p class="text-muted">No journal entries yet. Start your first Daily Ops entry!</p>
                    </div>
                </div>
            </section>

            <!-- Settings Page -->
            <section class="page-section" id="page-settings">
                <div class="grid-2">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">PROFILE</div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Your Name</label>
                            <input type="text" class="form-input" id="settingsName" value="Boss">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Daily Time Available (minutes)</label>
                            <input type="number" class="form-input" id="settingsTime" value="90" min="15" max="240">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Coaching Style</label>
                            <select class="form-select" id="settingsStyle">
                                <option value="direct">Direct & Intense</option>
                                <option value="balanced">Balanced</option>
                                <option value="gentle">Gentle & Supportive</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="saveSettings()">Save Settings</button>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">FOCUS MODULES</div>
                        </div>
                        <div id="focusModulesList">
                            <!-- Focus modules checkboxes -->
                        </div>
                        <button class="btn btn-primary" onclick="saveFocusModules()" style="margin-top: 1rem;">Save Focus</button>
                    </div>
                </div>

                <div class="card" style="margin-top: 1.5rem;">
                    <div class="card-header">
                        <div class="card-title">MODULE LEVELS</div>
                    </div>
                    <div class="grid-4" id="moduleLevelsGrid">
                        <!-- Module level inputs -->
                    </div>
                    <button class="btn btn-primary" onclick="saveModuleLevels()" style="margin-top: 1rem;">Save Levels</button>
                </div>
            </section>
        </main>
    </div>

    <!-- Morning Check-in Modal -->
    <div class="modal-overlay" id="morningModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">MORNING CHECK-IN</h2>
                <button class="modal-close" onclick="closeModal('morningModal')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="step-indicator">
                    <div class="step-dot active" id="amStep1"></div>
                    <div class="step-dot" id="amStep2"></div>
                    <div class="step-dot" id="amStep3"></div>
                </div>

                <!-- Step 1: Sleep & Energy -->
                <div class="checkin-step active" id="amCheckinStep1">
                    <div class="form-group">
                        <label class="form-label">Hours of Sleep</label>
                        <input type="range" class="form-range" id="amSleepHours" min="0" max="12" step="0.5" value="7">
                        <div class="range-value" id="amSleepValue">7 hours</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sleep Quality (1-10)</label>
                        <input type="range" class="form-range" id="amSleepQuality" min="1" max="10" value="7">
                        <div class="range-value" id="amSleepQualityValue">7</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Current Energy Level (1-10)</label>
                        <input type="range" class="form-range" id="amEnergy" min="1" max="10" value="7">
                        <div class="range-value" id="amEnergyValue">7</div>
                    </div>
                </div>

                <!-- Step 2: Priorities -->
                <div class="checkin-step" id="amCheckinStep2">
                    <div class="form-group">
                        <label class="form-label">Top 3 Priorities for Today</label>
                        <div class="priority-input">
                            <span class="priority-number">1</span>
                            <input type="text" class="form-input" id="amPriority1" placeholder="Most important task...">
                        </div>
                        <div class="priority-input">
                            <span class="priority-number">2</span>
                            <input type="text" class="form-input" id="amPriority2" placeholder="Second priority...">
                        </div>
                        <div class="priority-input">
                            <span class="priority-number">3</span>
                            <input type="text" class="form-input" id="amPriority3" placeholder="Third priority...">
                        </div>
                    </div>
                </div>

                <!-- Step 3: Win Definition -->
                <div class="checkin-step" id="amCheckinStep3">
                    <div class="form-group">
                        <label class="form-label">What ONE thing would make today a WIN?</label>
                        <input type="text" class="form-input" id="amWinDefinition" placeholder="If I accomplish this, today is a success...">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Any notes or intentions?</label>
                        <textarea class="form-textarea" id="amNotes" placeholder="Optional..."></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="amPrevBtn" onclick="prevAmStep()" style="display: none;">Previous</button>
                <button class="btn btn-primary" id="amNextBtn" onclick="nextAmStep()">Next</button>
            </div>
        </div>
    </div>

    <!-- Evening Reflection Modal -->
    <div class="modal-overlay" id="eveningModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">EVENING REFLECTION</h2>
                <button class="modal-close" onclick="closeModal('eveningModal')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="step-indicator">
                    <div class="step-dot active" id="pmStep1"></div>
                    <div class="step-dot" id="pmStep2"></div>
                    <div class="step-dot" id="pmStep3"></div>
                    <div class="step-dot" id="pmStep4"></div>
                </div>

                <!-- Step 1: Wins -->
                <div class="checkin-step active" id="pmCheckinStep1">
                    <div class="form-group">
                        <label class="form-label">What were your WINS today?</label>
                        <div class="reflection-list" id="pmWinsList">
                            <div class="reflection-item">
                                <input type="text" class="form-input" placeholder="Something that went well...">
                            </div>
                        </div>
                        <button class="add-item-btn" onclick="addReflectionItem('pmWinsList')">+ Add another win</button>
                    </div>
                </div>

                <!-- Step 2: Challenges & Lessons -->
                <div class="checkin-step" id="pmCheckinStep2">
                    <div class="form-group">
                        <label class="form-label">What CHALLENGES did you face?</label>
                        <div class="reflection-list" id="pmChallengesList">
                            <div class="reflection-item">
                                <input type="text" class="form-input" placeholder="A challenge or obstacle...">
                            </div>
                        </div>
                        <button class="add-item-btn" onclick="addReflectionItem('pmChallengesList')">+ Add another</button>
                    </div>
                    <div class="form-group" style="margin-top: 1.5rem;">
                        <label class="form-label">What did you LEARN?</label>
                        <div class="reflection-list" id="pmLessonsList">
                            <div class="reflection-item">
                                <input type="text" class="form-input" placeholder="A lesson or insight...">
                            </div>
                        </div>
                        <button class="add-item-btn" onclick="addReflectionItem('pmLessonsList')">+ Add another</button>
                    </div>
                </div>

                <!-- Step 3: Metrics -->
                <div class="checkin-step" id="pmCheckinStep3">
                    <div class="form-group">
                        <label class="form-label">Hours of Deep Work</label>
                        <input type="number" class="form-input" id="pmDeepWork" value="0" min="0" max="16" step="0.5">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sales Calls / Outreach</label>
                        <input type="number" class="form-input" id="pmSalesCalls" value="0" min="0">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Improvement for Tomorrow</label>
                        <input type="text" class="form-input" id="pmImprovement" placeholder="One thing to do differently...">
                    </div>
                </div>

                <!-- Step 4: Day Score -->
                <div class="checkin-step" id="pmCheckinStep4">
                    <div class="form-group">
                        <label class="form-label">Rate Your Day Overall (1-10)</label>
                        <input type="range" class="form-range" id="pmDayScore" min="1" max="10" value="7">
                        <div class="range-value" id="pmDayScoreValue">7</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Any final notes?</label>
                        <textarea class="form-textarea" id="pmNotes" placeholder="Optional reflection..."></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="pmPrevBtn" onclick="prevPmStep()" style="display: none;">Previous</button>
                <button class="btn btn-primary" id="pmNextBtn" onclick="nextPmStep()">Next</button>
            </div>
        </div>
    </div>

    <!-- Master Detail Modal -->
    <div class="modal-overlay" id="masterModal">
        <div class="modal" style="max-width: 800px;">
            <div class="modal-header">
                <h2 class="modal-title" id="masterModalName">MASTER NAME</h2>
                <button class="modal-close" onclick="closeModal('masterModal')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="masterModalBody">
                <div class="master-tabs" id="masterTabs">
                    <div class="master-tab active" data-tab="principles" onclick="switchMasterTab('principles')">Principles</div>
                    <div class="master-tab" data-tab="examples" onclick="switchMasterTab('examples')">Examples</div>
                    <div class="master-tab" data-tab="scripts" onclick="switchMasterTab('scripts')">Scripts</div>
                    <div class="master-tab" data-tab="resources" onclick="switchMasterTab('resources')">Resources</div>
                </div>
                <div id="masterTabContent">
                    <!-- Tab content rendered here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Deep Dive Modal -->
    <div class="modal-overlay" id="deepDiveModal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title" id="deepDiveTitle">DECISION FRAMEWORK</h2>
                <button class="modal-close" onclick="closeModal('deepDiveModal')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="deep-dive-meta">
                    <span class="deep-dive-source" id="deepDiveSource">Charlie Munger + Bezos</span>
                    <span class="deep-dive-progress" id="deepDiveProgress">Step 1 of 7</span>
                </div>
                <div class="step-indicator" id="deepDiveStepIndicator">
                    <!-- Step dots rendered dynamically -->
                </div>
                <div class="deep-dive-step" id="deepDiveStepContent">
                    <h3 class="deep-dive-step-title" id="deepDiveStepTitle">Define the Decision</h3>
                    <p class="deep-dive-step-prompt" id="deepDiveStepPrompt">What decision are you facing? Write it as a clear question.</p>
                    <textarea class="form-textarea deep-dive-textarea" id="deepDiveResponse" placeholder="Write your response..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="deepDivePrevBtn" onclick="prevDeepDiveStep()" style="display: none;">Previous</button>
                <button class="btn btn-primary" id="deepDiveNextBtn" onclick="nextDeepDiveStep()">Next</button>
            </div>
        </div>
    </div>

    <!-- Journal Entry View Modal -->
    <div class="modal-overlay" id="journalViewModal">
        <div class="modal" style="max-width: 700px;">
            <div class="modal-header">
                <h2 class="modal-title" id="journalViewTitle">JOURNAL ENTRY</h2>
                <button class="modal-close" onclick="closeModal('journalViewModal')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="journalViewContent">
                <!-- Entry content rendered here -->
            </div>
        </div>
    </div>

    <!-- Add Habit Modal -->
    <div class="modal-overlay" id="addHabitModal">
        <div class="modal" style="max-width: 500px;">
            <div class="modal-header">
                <h2 class="modal-title">ADD NEW HABIT</h2>
                <button class="modal-close" onclick="closeModal('addHabitModal')">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Habit Name</label>
                    <input type="text" class="form-input" id="newHabitName" placeholder="e.g., Meditate for 10 minutes">
                </div>
                <div class="form-group">
                    <label class="form-label">Related Module</label>
                    <select class="form-select" id="newHabitModule">
                        <option value="productivity">Productivity</option>
                        <option value="mindset">Mindset</option>
                        <option value="money">Money</option>
                        <option value="sales">Sales</option>
                        <option value="business">Business</option>
                        <option value="finance">Finance</option>
                        <option value="lifestyle">Lifestyle</option>
                        <option value="health">Health</option>
                        <option value="dating">Dating & Social</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" onclick="closeModal('addHabitModal')">Cancel</button>
                <button class="btn btn-primary" onclick="addNewHabit()">Add Habit</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // ============================================
        // DATA STORE
        // ============================================
        let appData = {
            profile: {
                name: "Boss",
                dailyTime: 90,
                coachingStyle: "direct",
                focusModules: ["money", "sales", "productivity"],
                moduleLevels: {
                    money: 5, sales: 4, finance: 6, productivity: 6,
                    business: 5, mindset: 7, dating: 5, lifestyle: 5, health: 8
                }
            },
            habits: [
                { id: 1, name: "Morning Routine", module: "productivity", streak: 12, completed: false },
                { id: 2, name: "Deep Work Block (90+ min)", module: "productivity", streak: 8, completed: false },
                { id: 3, name: "Sales Outreach (10+ touches)", module: "sales", streak: 5, completed: false },
                { id: 4, name: "Skill Development (30+ min)", module: "money", streak: 15, completed: false },
                { id: 5, name: "Journaling", module: "mindset", streak: 20, completed: false },
                { id: 6, name: "Reading (20+ min)", module: "mindset", streak: 18, completed: false },
                { id: 7, name: "Networking Action", module: "business", streak: 3, completed: false },
                { id: 8, name: "No Phone First Hour", module: "lifestyle", streak: 7, completed: false }
            ],
            stats: {
                dayStreak: 12,
                deepWorkHours: 45,
                habitCompletion: 75,
                avgScore: 7.2
            },
            todayLog: {
                amCheckin: null,
                pmReflection: null
            },
            currentWisdom: null,
            journalEntries: [],
            journalPatterns: {},
            journalStats: {
                totalEntries: 0,
                dailyOpsCount: 0,
                deepDiveCount: 0,
                frameworkUsage: {}
            },
            journalStreak: 0,
            journalDraft: null
        };

        const moduleConfig = {
            money: { name: "Money & Wealth", color: "#d4a847", icon: "$" },
            sales: { name: "Sales & Persuasion", color: "#3b82f6", icon: "S" },
            finance: { name: "Personal Finance", color: "#22c55e", icon: "F" },
            productivity: { name: "Productivity", color: "#8b5cf6", icon: "P" },
            business: { name: "Business & Career", color: "#f59e0b", icon: "B" },
            mindset: { name: "Mindset & Wisdom", color: "#ec4899", icon: "M" },
            dating: { name: "Social & Dating", color: "#06b6d4", icon: "D" },
            lifestyle: { name: "Lifestyle Design", color: "#84cc16", icon: "L" },
            health: { name: "Health & Fitness", color: "#ef4444", icon: "H" }
        };

        const mastersData = {
            money: [
                { name: "Naval Ravikant", expertise: "Wealth creation, leverage, startups", principles: ["Seek wealth, not money or status. Wealth is having assets that earn while you sleep.", "You're not going to get rich renting out your time. You must own equity.", "Arm yourself with specific knowledge, accountability, and leverage.", "Code and media are permissionless leverage. They're the leverage of the new rich."], practices: ["Spend 1 hour learning something that compounds", "Build something that can work without you"] },
                { name: "Alex Hormozi", expertise: "Business scaling, offers, value creation", principles: ["The goal is to make your offer so good people feel stupid saying no.", "Volume negates luck. Do more.", "Skills are the only assets that can't be taken from you.", "The fastest way to get rich is to solve a painful problem for people who can pay."], practices: ["Do 100 outreach touches", "Improve your offer daily"] },
                { name: "Charlie Munger", expertise: "Mental models, decision-making", principles: ["Spend each day trying to be a little wiser than you were when you woke up.", "Invert, always invert. Turn a situation or problem upside down.", "Knowing what you don't know is more useful than being brilliant."], practices: ["Read across disciplines", "Invert problems to find solutions"] }
            ],
            sales: [
                { name: "Jordan Belfort", expertise: "Straight line persuasion, tonality", principles: ["The only thing standing between you and your goal is the story you keep telling yourself.", "Sales is a transfer of emotion. You must believe before they can.", "Tonality is 90% of communication."], practices: ["Practice your pitch with power and conviction", "Handle 10 objections out loud daily"] },
                { name: "Grant Cardone", expertise: "10X action, massive outreach", principles: ["10X your goals and 10X your actions.", "Success is your duty, obligation, and responsibility.", "The fortune is in the follow-up."], practices: ["Make 10X the calls you think you need", "Never lower your target, increase your actions"] },
                { name: "Chris Voss", expertise: "FBI negotiation, tactical empathy", principles: ["Never split the difference.", "Tactical empathy is understanding the feelings and mindset of another.", "No is the start of the negotiation, not the end."], practices: ["Use mirroring in 3 conversations today", "Label someone's emotion out loud"] }
            ],
            mindset: [
                { name: "David Goggins", expertise: "Mental toughness, extreme accountability", principles: ["You are in danger of living a life so comfortable that you will die without ever realizing your potential.", "Most people stop at 40% of their capacity. The brain lies to protect you.", "Callus your mind. Embrace the suck."], practices: ["Do something that sucks every day", "When your mind says stop, do 10 more"] },
                { name: "Jocko Willink", expertise: "Extreme ownership, discipline", principles: ["Discipline equals freedom.", "Extreme ownership: There are no bad teams, only bad leaders.", "Default aggressive. When in doubt, take action."], practices: ["Wake up early. Win the first battle.", "Take ownership of every problem in your life"] },
                { name: "Marcus Aurelius", expertise: "Stoicism, self-discipline", principles: ["You have power over your mind, not outside events.", "The happiness of your life depends upon the quality of your thoughts.", "Waste no more time arguing about what a good man should be. Be one."], practices: ["Morning reflection on what's in your control", "Practice accepting what you cannot change"] },
                { name: "Bruce Lee", expertise: "Martial arts philosophy, adaptability, self-expression", principles: ["Be water, my friend. Empty your mind, be formless, shapeless.", "I fear not the man who has practiced 10,000 kicks once, but the man who has practiced one kick 10,000 times.", "Absorb what is useful, discard what is useless, add what is uniquely your own.", "The key to immortality is first living a life worth remembering.", "Knowing is not enough, we must apply. Willing is not enough, we must do."], practices: ["Practice until the technique becomes part of you", "Question every tradition - keep only what works for YOU", "Train the mind as hard as the body"] },
                { name: "Benjamin Franklin", expertise: "Self-improvement, virtue ethics, practical wisdom", principles: ["An investment in knowledge pays the best interest.", "By failing to prepare, you are preparing to fail.", "Well done is better than well said.", "Energy and persistence conquer all things.", "Never leave that till tomorrow which you can do today."], practices: ["Track 13 virtues weekly", "Ask each morning: What good shall I do today?", "Ask each evening: What good have I done today?"] },
                { name: "Epictetus", expertise: "Stoicism, freedom through acceptance, the dichotomy of control", principles: ["It's not what happens to you, but how you react to it that matters.", "We cannot choose our external circumstances, but we can choose how we respond.", "Wealth consists not in having great possessions, but in having few wants.", "First say to yourself what you would be; then do what you have to do.", "No man is free who is not master of himself."], practices: ["Each morning, remind yourself what is in your control and what is not", "When disturbed, ask: Is this within my power or not?", "Practice voluntary discomfort to build resilience"] },
                { name: "Socrates", expertise: "Self-examination, questioning assumptions, pursuit of wisdom", principles: ["The unexamined life is not worth living.", "I know that I know nothing.", "To find yourself, think for yourself.", "Strong minds discuss ideas, average minds discuss events, weak minds discuss people.", "Be kind, for everyone you meet is fighting a hard battle."], practices: ["Question your deepest assumptions", "Seek to understand before seeking to be understood", "Admit ignorance as the first step to knowledge"] }
            ],
            productivity: [
                { name: "Cal Newport", expertise: "Deep work, digital minimalism", principles: ["Deep work is the ability to focus without distraction on a cognitively demanding task.", "If you don't produce, you won't thrive.", "The ability to perform deep work is becoming increasingly rare and valuable."], practices: ["Schedule 3-4 hours of uninterrupted deep work", "Embrace boredomdon't fill every moment"] },
                { name: "James Clear", expertise: "Atomic habits, behavior change", principles: ["You do not rise to the level of your goals. You fall to the level of your systems.", "Every action is a vote for the type of person you wish to become.", "Habits are the compound interest of self-improvement."], practices: ["Stack new habits onto existing ones", "Track habits visuallynever break the chain"] }
            ],
            business: [
                { name: "Elon Musk", expertise: "First principles, moonshots", principles: ["First principles thinking: Boil things down to fundamental truths.", "Failure is an option here. If things are not failing, you are not innovating enough.", "Work like hell. 80-100 hour weeks."], practices: ["Question every assumption", "Move fast and iterate constantly"] },
                { name: "Jeff Bezos", expertise: "Long-term thinking, customer obsession", principles: ["Focus on customers, not competitors.", "It's always Day 1. Day 2 is stasis, followed by death.", "Make high-velocity decisions."], practices: ["Start with the customer and work backwards", "Think in 5-7 year time horizons"] },
                { name: "Napoleon Hill", expertise: "Success philosophy, the power of thought, achievement principles", principles: ["Whatever the mind can conceive and believe, it can achieve.", "The starting point of all achievement is desire.", "Strength and growth come only through continuous effort and struggle.", "A quitter never wins and a winner never quits.", "Set your mind on a definite goal and observe how quickly the world stands aside to let you pass."], practices: ["Write your definite major purpose and read it daily", "Form a mastermind alliance with people who want you to succeed", "Transmute energy into creative achievement"] },
                { name: "Alexander the Great", expertise: "Conquest, bold action, leading from the front", principles: ["There is nothing impossible to him who will try.", "I am not afraid of an army of lions led by a sheep; I am afraid of an army of sheep led by a lion.", "Remember: upon the conduct of each depends the fate of all.", "A tomb now suffices him for whom the whole world was not sufficient.", "I would rather live a short life of glory than a long one of obscurity."], practices: ["Lead from the front - never ask others to do what you won't", "Move with speed and decisiveness when opportunity appears", "Share hardships with your team"] },
                { name: "King Leonidas", expertise: "Courage, sacrifice, unwavering commitment", principles: ["Come back with your shield, or on it.", "Spartans! Ready your breakfast and eat hearty, for tonight we dine in hell!", "The world will know that free men stood against a tyrant.", "Give them nothing, but take from them everything.", "A Spartan's true strength is the warrior next to him."], practices: ["Prepare for the hardest possible scenario", "Your word is your bond - death before dishonor", "Train relentlessly - excellence is a habit, not an act"] }
            ],
            finance: [
                { name: "Morgan Housel", expertise: "Psychology of money", principles: ["Wealth is what you don't see.", "Saving is the gap between your ego and your income.", "Compounding works best when you give it decades."], practices: ["Automate savings before spending", "Think in decades, not days"] }
            ],
            dating: [
                { name: "Dale Carnegie", expertise: "Winning friends, influence", principles: ["You can make more friends in two months by becoming interested in other people than in two years trying to get people interested in you.", "A person's name is the sweetest sound.", "Make the other person feel importantsincerely."], practices: ["Remember and use people's names", "Ask questions and truly listen"] }
            ],
            lifestyle: [
                { name: "Tim Ferriss", expertise: "Lifestyle design, optimization", principles: ["Focus on being productive instead of busy.", "What we fear doing most is usually what we most need to do.", "Lack of time is lack of priorities."], practices: ["Define the worst caseit's usually not that bad", "Eliminate before optimizing"] }
            ],
            health: [
                { name: "Andrew Huberman", expertise: "Neuroscience, protocols, optimization", principles: ["Morning sunlight exposure is the most powerful tool for optimizing circadian rhythm.", "Non-sleep deep rest (NSDR) can restore focus and energy.", "Cold exposure triggers dopamine release that lasts for hours."], practices: ["Get sunlight within 30-60 minutes of waking", "Practice NSDR or meditation daily"] },
                { name: "Peter Attia", expertise: "Longevity, healthspan, medicine 3.0", principles: ["The goal is to die young as old as possible.", "Zone 2 cardio is the foundation of metabolic health.", "Stability and mobility are non-negotiable as you age."], practices: ["150+ minutes of Zone 2 cardio weekly", "Train for the Centenarian Decathlon"] }
            ]
        };

        // ============================================
        // JOURNAL FRAMEWORKS & HISTORICAL TITANS
        // ============================================

        const journalFrameworks = {
            daily_ops: [
                {
                    id: "stoic_premeditatio",
                    name: "Stoic Premeditatio Malorum",
                    source: "Marcus Aurelius / Seneca",
                    description: "Mentally rehearse potential obstacles to eliminate surprise and prepare responses.",
                    prompts: [
                        "What could go wrong today? List 3 realistic obstacles.",
                        "For each obstacle, what is your prepared response?",
                        "What is completely outside your control that you must accept?",
                        "What negative emotion might arise? How will you regulate it?"
                    ],
                    power_statement: "I am prepared for whatever comes. Nothing will surprise me."
                },
                {
                    id: "ooda_loop",
                    name: "OODA Loop",
                    source: "John Boyd",
                    description: "Observe-Orient-Decide-Act cycle for rapid, adaptive decision-making.",
                    prompts: [
                        "OBSERVE: What is the current reality? What data do I have?",
                        "ORIENT: How does this connect to my goals? What patterns do I see?",
                        "DECIDE: What is my best course of action given this context?",
                        "ACT: What is my immediate next action? Commit to it now."
                    ],
                    power_statement: "I move faster than my environment. I adapt and overcome."
                },
                {
                    id: "munger_inversion",
                    name: "Munger Inversion",
                    source: "Charlie Munger",
                    description: "Invert the problem to find blind spots and failure modes.",
                    prompts: [
                        "What does success look like today? Define it clearly.",
                        "Now invert: How could I guarantee FAILURE today?",
                        "What behaviors/decisions would destroy this goal?",
                        "Which of these failure modes am I most at risk of? How will I prevent it?"
                    ],
                    power_statement: "All I want to know is where I'm going to die, so I never go there."
                },
                {
                    id: "franklin_virtues",
                    name: "Franklin's Virtue Focus",
                    source: "Benjamin Franklin",
                    description: "Select one virtue to emphasize and track throughout the day.",
                    prompts: [
                        "Which virtue needs the most attention today? (Temperance, Silence, Order, Resolution, Frugality, Industry, Sincerity, Justice, Moderation, Cleanliness, Tranquility, Chastity, Humility)",
                        "What specific situation will test this virtue?",
                        "What does perfect execution of this virtue look like?",
                        "How will you measure your adherence tonight?"
                    ],
                    power_statement: "I am not born excellent. I build excellence through daily practice."
                },
                {
                    id: "musashi_mastery",
                    name: "Musashi's Way",
                    source: "Miyamoto Musashi",
                    description: "Single-minded pursuit of mastery with no wasted motion.",
                    prompts: [
                        "What ONE skill am I sharpening today?",
                        "How can I practice this skill 10 times today in different contexts?",
                        "What am I doing that is not essential? Cut it.",
                        "Where am I deceiving myself about my true level?"
                    ],
                    power_statement: "The Way is in training. A thousand days of practice, ten thousand days of refinement."
                }
            ],
            deep_dive: {
                decision: {
                    name: "Decision Framework",
                    source: "Charlie Munger + Bezos",
                    description: "Make high-quality decisions by considering second-order effects and reversibility.",
                    steps: [
                        { title: "Define the Decision", prompt: "What decision are you facing? Write it as a clear question." },
                        { title: "Identify Options", prompt: "What are your 3-5 realistic options? Include 'do nothing' if applicable." },
                        { title: "First-Order Effects", prompt: "For each option, what happens immediately?" },
                        { title: "Second-Order Effects", prompt: "What happens as a RESULT of those first-order effects? Think 6-12 months out." },
                        { title: "Reversibility Check", prompt: "Is this a one-way door (irreversible) or two-way door (reversible)? One-way doors need more analysis." },
                        { title: "Inversion", prompt: "How could each option lead to disaster? Which failure mode is most likely?" },
                        { title: "Decision & Commitment", prompt: "Based on this analysis, what is your decision? What is your first action?" }
                    ]
                },
                stuck: {
                    name: "First Principles Breakdown",
                    source: "Aristotle / Elon Musk",
                    description: "Break down problems to fundamental truths and rebuild from there.",
                    steps: [
                        { title: "State the Problem", prompt: "What are you stuck on? Describe it in one sentence." },
                        { title: "Surface Assumptions", prompt: "What assumptions are you making? List everything you 'know' about this problem." },
                        { title: "Question Each Assumption", prompt: "For each assumption, ask: Is this actually true? Says who? What evidence supports it?" },
                        { title: "Find Bedrock Truths", prompt: "What remains after questioning? What is undeniably true?" },
                        { title: "Rebuild from Truth", prompt: "Starting only from bedrock truths, what solutions become possible?" },
                        { title: "Next Action", prompt: "What is the smallest experiment to test your new approach?" }
                    ]
                },
                negotiate: {
                    name: "Tactical Negotiation Prep",
                    source: "Chris Voss",
                    description: "Prepare for negotiations using FBI hostage negotiation techniques.",
                    steps: [
                        { title: "Define the Objective", prompt: "What specifically do you want from this negotiation? What is your ideal outcome?" },
                        { title: "Map Their World", prompt: "What does the other side want? What pressures are they under? What are their constraints?" },
                        { title: "Identify Black Swans", prompt: "What unknown information could change everything? What questions would reveal it?" },
                        { title: "Prepare Calibrated Questions", prompt: "Write 3 'How' or 'What' questions to make them solve your problems. (e.g., 'How am I supposed to do that?')" },
                        { title: "Plan Your Labels", prompt: "Write 3 tactical empathy labels. ('It seems like...', 'It sounds like...', 'It looks like...')" },
                        { title: "Prepare for 'No'", prompt: "What is your response when they say no? Remember: 'No' is the start of negotiation, not the end." }
                    ]
                },
                habit: {
                    name: "Atomic Habit Installation",
                    source: "James Clear",
                    description: "Design a new habit using the Four Laws framework.",
                    steps: [
                        { title: "Define the Habit", prompt: "What habit do you want to build? Be specific. (Behavior + Time + Location)" },
                        { title: "Make It Obvious (Cue)", prompt: "What existing habit will you stack this on? Use: 'After I [CURRENT HABIT], I will [NEW HABIT].'" },
                        { title: "Make It Attractive (Craving)", prompt: "How will you make this habit appealing? What reward or pairing can you add?" },
                        { title: "Make It Easy (Response)", prompt: "How can you reduce friction? Apply the 2-minute rule: What does the habit look like in 2 minutes or less?" },
                        { title: "Make It Satisfying (Reward)", prompt: "How will you track this? How will you celebrate immediately after completing it?" },
                        { title: "Environment Design", prompt: "How will you change your physical environment to make this habit automatic?" }
                    ]
                },
                perspective: {
                    name: "Stoic Evening Review",
                    source: "Marcus Aurelius / Seneca",
                    description: "Reflect on the day with Stoic wisdom to extract lessons and find peace.",
                    steps: [
                        { title: "What Went Well?", prompt: "What virtue did you display today? Where did you act with excellence?" },
                        { title: "What Disturbed You?", prompt: "What emotion took control today? What triggered it? Was it within your control?" },
                        { title: "Apply the Stoic Test", prompt: "For each disturbance: Did this harm my character? Or only my circumstances? What would Marcus say?" },
                        { title: "Lesson Extraction", prompt: "What will you do differently tomorrow? What specific commitment do you make?" },
                        { title: "Evening Gratitude", prompt: "What 3 things from today will you never get back? Appreciate them now." }
                    ]
                },
                planning: {
                    name: "Strategic Planning Protocol",
                    source: "Jeff Bezos + Premortem",
                    description: "Plan major initiatives using regret minimization and premortem analysis.",
                    steps: [
                        { title: "Define the Initiative", prompt: "What are you planning? What does success look like in 1 year? 5 years?" },
                        { title: "Regret Minimization", prompt: "You are 80 years old, looking back. Will you regret NOT doing this? Will you regret the attempt even if you fail?" },
                        { title: "Premortem: It Failed", prompt: "Imagine it is 1 year from now and this failed spectacularly. What went wrong? List all failure modes." },
                        { title: "Mitigate Top Risks", prompt: "For your top 3 failure modes, what can you do NOW to prevent them?" },
                        { title: "Define Milestones", prompt: "What are the key milestones that prove you are on track? How will you know if you should pivot or persist?" },
                        { title: "First 72 Hours", prompt: "What will you do in the next 72 hours to begin? Commit to specific actions." }
                    ]
                }
            }
        };

        const historicalTitans = [
            {
                name: "Marcus Aurelius",
                expertise: "Stoicism, self-discipline, duty, leadership under pressure",
                principles: [
                    "You have power over your mind, not outside events. Realize this, and you will find strength.",
                    "The happiness of your life depends upon the quality of your thoughts.",
                    "Waste no more time arguing about what a good man should be. Be one.",
                    "Very little is needed to make a happy life; it is all within yourself, in your way of thinking."
                ],
                practices: [
                    "Morning: Remind yourself of what is in your control and what is not",
                    "Evening: Review the day - where did you act with virtue? Where did you fall short?"
                ],
                era: "121-180 AD",
                category: "philosophy"
            },
            {
                name: "Benjamin Franklin",
                expertise: "Self-improvement, virtue ethics, practical wisdom, polymathy",
                principles: [
                    "An investment in knowledge pays the best interest.",
                    "By failing to prepare, you are preparing to fail.",
                    "Energy and persistence conquer all things.",
                    "Well done is better than well said."
                ],
                practices: [
                    "Morning: Ask 'What good shall I do today?'",
                    "Evening: Ask 'What good have I done today?' Track your 13 virtues"
                ],
                era: "1706-1790",
                category: "self_improvement"
            },
            {
                name: "Leonardo da Vinci",
                expertise: "Curiosity, observation, synthesis across disciplines, relentless experimentation",
                principles: [
                    "Learning never exhausts the mind.",
                    "Simplicity is the ultimate sophistication.",
                    "I have been impressed with the urgency of doing. Knowing is not enough; we must apply.",
                    "The noblest pleasure is the joy of understanding."
                ],
                practices: [
                    "Fill pages of observation - draw, write, question everything you see",
                    "Connect ideas from different fields - what can art teach science? What can science teach art?"
                ],
                era: "1452-1519",
                category: "creativity"
            },
            {
                name: "Sun Tzu",
                expertise: "Strategy, competitive positioning, winning without fighting",
                principles: [
                    "The supreme art of war is to subdue the enemy without fighting.",
                    "Appear weak when you are strong, and strong when you are weak.",
                    "Know yourself and know your enemy, and you will never be defeated.",
                    "Opportunities multiply as they are seized."
                ],
                practices: [
                    "Before any conflict, know your position, your opponent, and the terrain",
                    "Look for the path of least resistance - the best victories feel effortless"
                ],
                era: "544-496 BC",
                category: "strategy"
            },
            {
                name: "Seneca",
                expertise: "Stoicism, managing adversity, wealth and virtue, time management",
                principles: [
                    "We suffer more often in imagination than in reality.",
                    "It is not that we have a short time to live, but that we waste a lot of it.",
                    "Luck is what happens when preparation meets opportunity.",
                    "Difficulties strengthen the mind, as labor does the body."
                ],
                practices: [
                    "Practice voluntary discomfort - fast, cold exposure, or deprivation to build resilience",
                    "Guard your time jealously. Say no to what doesn't matter."
                ],
                era: "4 BC - 65 AD",
                category: "philosophy"
            },
            {
                name: "Epictetus",
                expertise: "Stoicism, freedom through acceptance, the dichotomy of control",
                principles: [
                    "It's not what happens to you, but how you react to it that matters.",
                    "We cannot choose our external circumstances, but we can choose how we respond.",
                    "First say to yourself what you would be; then do what you have to do.",
                    "No man is free who is not master of himself."
                ],
                practices: [
                    "Each morning, remind yourself what is in your control and what is not",
                    "When disturbed, ask: Is this within my power or not?"
                ],
                era: "50-135 AD",
                category: "philosophy"
            },
            {
                name: "Miyamoto Musashi",
                expertise: "Mastery, strategy, single-minded dedication, the warrior's way",
                principles: [
                    "There is nothing outside of yourself that can ever enable you to get better, stronger, richer, quicker, or smarter. Everything is within.",
                    "Do nothing which is of no use.",
                    "You must understand that there is more than one path to the top of the mountain.",
                    "The ultimate aim of martial arts is not having to use them."
                ],
                practices: [
                    "Practice your craft every single day without exception",
                    "Remove all that is unnecessary from your life and technique"
                ],
                era: "1584-1645",
                category: "mastery"
            },
            {
                name: "Theodore Roosevelt",
                expertise: "Bold action, resilience, the strenuous life, leadership",
                principles: [
                    "Do what you can, with what you have, where you are.",
                    "It is not the critic who counts; the credit belongs to the man in the arena.",
                    "Believe you can and you're halfway there.",
                    "The only man who never makes mistakes is the man who never does anything."
                ],
                practices: [
                    "Take on one thing today that tests your limits",
                    "Embrace 'the strenuous life' - seek challenge, not comfort"
                ],
                era: "1858-1919",
                category: "leadership"
            },
            {
                name: "Winston Churchill",
                expertise: "Persistence, oratory, leadership in crisis, resilience",
                principles: [
                    "Success is not final, failure is not fatal: it is the courage to continue that counts.",
                    "Never, never, never give up.",
                    "If you're going through hell, keep going.",
                    "The pessimist sees difficulty in every opportunity. The optimist sees opportunity in every difficulty."
                ],
                practices: [
                    "When facing your darkest hour, speak courage into existence",
                    "Study history to understand the present and shape the future"
                ],
                era: "1874-1965",
                category: "leadership"
            },
            {
                name: "Nikola Tesla",
                expertise: "Innovation, visualization, deep work, relentless invention",
                principles: [
                    "The present is theirs; the future, for which I really worked, is mine.",
                    "I do not think there is any thrill that can go through the human heart like that felt by the inventor.",
                    "If you want to find the secrets of the universe, think in terms of energy, frequency and vibration.",
                    "Our virtues and our failings are inseparable."
                ],
                practices: [
                    "Visualize your invention in complete detail before building",
                    "Work in complete isolation on your most important problems"
                ],
                era: "1856-1943",
                category: "innovation"
            },
            {
                name: "Andrew Carnegie",
                expertise: "Wealth building, industry, philanthropy, leverage",
                principles: [
                    "The man who dies rich dies disgraced.",
                    "Teamwork is the ability to work together toward a common vision.",
                    "Do your duty and a little more and the future will take care of itself.",
                    "The first man gets the oyster, the second man gets the shell."
                ],
                practices: [
                    "Surround yourself with people smarter than you",
                    "Invest in capabilities that compound over decades"
                ],
                era: "1835-1919",
                category: "business"
            },
            {
                name: "Niccolo Machiavelli",
                expertise: "Power dynamics, political strategy, realism, human nature",
                principles: [
                    "It is better to be feared than loved, if you cannot be both.",
                    "Everyone sees what you appear to be, few experience what you really are.",
                    "The lion cannot protect himself from traps, and the fox cannot defend himself from wolves.",
                    "Never attempt to win by force what can be won by deception."
                ],
                practices: [
                    "Study the people around you - what do they truly want? What motivates them?",
                    "Prepare for the worst in others while hoping for the best"
                ],
                era: "1469-1527",
                category: "strategy"
            },
            {
                name: "Lao Tzu",
                expertise: "Taoism, effortless action (wu wei), harmony, leadership through non-action",
                principles: [
                    "The journey of a thousand miles begins with a single step.",
                    "When I let go of what I am, I become what I might be.",
                    "A leader is best when people barely know he exists.",
                    "Nature does not hurry, yet everything is accomplished."
                ],
                practices: [
                    "Practice wu wei - act without forcing, lead without dominating",
                    "Observe nature and align your actions with its rhythms"
                ],
                era: "6th century BC",
                category: "philosophy"
            },
            {
                name: "Confucius",
                expertise: "Ethics, social harmony, self-cultivation, virtuous leadership",
                principles: [
                    "It does not matter how slowly you go as long as you do not stop.",
                    "The man who moves a mountain begins by carrying away small stones.",
                    "To see what is right and not do it is a lack of courage.",
                    "He who learns but does not think, is lost. He who thinks but does not learn is in great danger."
                ],
                practices: [
                    "Examine yourself daily - have you been loyal? Have you kept your word?",
                    "Treat others as you would wish to be treated"
                ],
                era: "551-479 BC",
                category: "ethics"
            },
            {
                name: "Aristotle",
                expertise: "Logic, virtue ethics, practical wisdom (phronesis), first principles",
                principles: [
                    "We are what we repeatedly do. Excellence, then, is not an act, but a habit.",
                    "Knowing yourself is the beginning of all wisdom.",
                    "It is the mark of an educated mind to entertain a thought without accepting it.",
                    "The more you know, the more you realize you don't know."
                ],
                practices: [
                    "Build excellence through daily habits, not occasional efforts",
                    "Seek the 'golden mean' - virtue lies between extremes"
                ],
                era: "384-322 BC",
                category: "philosophy"
            }
        ];

        // Add historical module to moduleConfig
        moduleConfig.historical = { name: "Historical Titans", color: "#9d8758", icon: "H" };

        const challenges = {
            money: ["Identify one skill that would 2x your income. Spend 30 minutes learning it today.", "Calculate your true hourly rate. Find one way to increase it.", "Reach out to someone who makes 10x what you make."],
            sales: ["Make 10 cold outreach touches today.", "Write responses to your top 5 objections.", "Practice mirroring in 3 conversations."],
            mindset: ["Do one thing today that scares you.", "Journal for 10 minutes: What am I avoiding?", "Go 24 hours without complaining."],
            productivity: ["Do 90 minutes of deep work with zero interruptions.", "Identify your top 3 tasks before ending today.", "Single-task for your entire morning."],
            finance: ["Calculate your current savings rate.", "Review subscriptions and cancel one.", "Automate one additional savings transfer."],
            business: ["Validate one idea by talking to 3 potential customers.", "Use ICE scoring on 3 ideas.", "Send one cold email to someone you want to learn from."],
            dating: ["Start a conversation with one stranger.", "Give three genuine compliments.", "Practice active listening in your next conversation."],
            lifestyle: ["Remove one item that tempts bad behavior.", "Go 24 hours without social media.", "Declutter one area completely."],
            health: ["Get morning sunlight within 30 minutes of waking.", "Do 30 minutes of Zone 2 cardio.", "Practice a 10-minute NSDR protocol."]
        };

        const powerQuestions = [
            "What would the best version of me do right now?",
            "What am I avoiding that I know I should do?",
            "If I only accomplished one thing today, what should it be?",
            "Am I being productive or just busy?",
            "What's the ONE thing that would make everything else easier?",
            "If today repeated for a year, where would I end up?",
            "What skill, if mastered, would change everything?"
        ];

        const mindsetShifts = [
            { from: "I don't have time", to: "It's not a priority", why: "Own your choices. If it mattered, you'd find time." },
            { from: "I can't do this", to: "I can't do this YET", why: "Growth mindset. Skills are built, not born." },
            { from: "I failed", to: "I learned what doesn't work", why: "Failure is data. Collect it and adjust." },
            { from: "I'm not ready", to: "I'll figure it out as I go", why: "Readiness is a myth. Action creates clarity." },
            { from: "I need motivation", to: "I need discipline", why: "Motivation is fleeting. Discipline is reliable." },
            { from: "It's too hard", to: "It's supposed to be hard", why: "Hard is what makes it valuable." }
        ];

        // Daily Vocabulary (45 terms across 9 modules)
        const dailyVocabulary = {
            money: [
                { term: "Leverage", definition: "Using resources to multiply output beyond direct effort", example: "Creating a course teaches thousands while you sleep" },
                { term: "Specific Knowledge", definition: "Knowledge that cannot be trained for - acquired through curiosity", example: "Naval's blend of tech investing + philosophy" },
                { term: "Asymmetric Upside", definition: "Potential gains far exceed potential losses", example: "Side project: worst case learn, best case replace income" },
                { term: "Compound Interest", definition: "Earning returns on previous returns - exponential growth", example: "10% return doubles money every 7.2 years" },
                { term: "Equity", definition: "Ownership stake that appreciates without direct involvement", example: "Stock options, business ownership, real estate" }
            ],
            sales: [
                { term: "Tonality", definition: "Emotional quality of voice conveying certainty and authority", example: "Same words, different tone = different meaning" },
                { term: "Mirroring", definition: "Repeating last 1-3 words to encourage elaboration", example: "'Implementation?' encourages them to explain" },
                { term: "Tactical Empathy", definition: "Understanding feelings to influence decisions", example: "Labeling fears before they voice them" },
                { term: "Accusation Audit", definition: "Proactively address negatives they might think", example: "'You're probably thinking this is expensive...'" },
                { term: "Pattern Interrupt", definition: "Breaking expected flow to capture attention", example: "Starting a call with unexpected honesty" }
            ],
            mindset: [
                { term: "40% Rule", definition: "When mind says done, you're at 40% capacity", example: "One more rep when you think you can't" },
                { term: "Extreme Ownership", definition: "Taking complete responsibility for everything", example: "'How did I fail to ensure they would?'" },
                { term: "Premeditatio Malorum", definition: "Visualizing difficulties to prepare responses", example: "Morning visualization of challenges" },
                { term: "Amor Fati", definition: "Love of fate - embracing all events as necessary", example: "Not just accepting but embracing setbacks" },
                { term: "Dichotomy of Control", definition: "Separating what you control from what you don't", example: "Control preparation, not the outcome" }
            ],
            productivity: [
                { term: "Deep Work", definition: "Distraction-free concentration on demanding tasks", example: "90-minute blocks with phone in another room" },
                { term: "Time Blocking", definition: "Assigning specific tasks to calendar blocks", example: "9-11 AM: Deep work. No exceptions." },
                { term: "Attention Residue", definition: "Mental fragments from previous tasks reducing focus", example: "Checking email leaves 20+ min residue" },
                { term: "Parkinson's Law", definition: "Work expands to fill available time", example: "2-hour task takes 4 hours with loose deadline" },
                { term: "Eat the Frog", definition: "Do hardest task first when willpower peaks", example: "Tackle biggest project before email" }
            ],
            finance: [
                { term: "Savings Rate", definition: "% of income saved - most important wealth factor", example: "50% savings rate = FI in ~17 years" },
                { term: "Lifestyle Creep", definition: "Increasing spending as income increases", example: "Raise  immediate car upgrade" },
                { term: "Opportunity Cost", definition: "What you give up by choosing one option", example: "$50k car = $500k in 30 years" },
                { term: "Dollar-Cost Averaging", definition: "Fixed amounts at regular intervals", example: "$500/month buys more when prices low" },
                { term: "FIRE", definition: "Financial Independence, Retire Early", example: "Living on 4% of investments annually" }
            ],
            business: [
                { term: "First Principles", definition: "Breaking problems to fundamentals and reasoning up", example: "'What are batteries actually made of?'" },
                { term: "Moat", definition: "Sustainable competitive advantage", example: "Network effects, brand, switching costs" },
                { term: "Product-Market Fit", definition: "Product satisfies strong market demand", example: "Organic growth, users complain when it's down" },
                { term: "ICE Framework", definition: "Impact  Confidence  Ease prioritization", example: "High-impact easy win = do it first" },
                { term: "Flywheel", definition: "Self-reinforcing loop that accelerates growth", example: "More users  more data  better product  more users" }
            ],
            health: [
                { term: "Zone 2 Cardio", definition: "Low-intensity exercise optimizing mitochondria", example: "45-min walk at conversational pace" },
                { term: "NSDR", definition: "Non-Sleep Deep Rest - restores without sleep", example: "20-min yoga nidra for mental clarity" },
                { term: "Circadian Rhythm", definition: "Internal 24-hour clock regulating body functions", example: "Morning sunlight sets the clock" },
                { term: "Sleep Pressure", definition: "Adenosine buildup creating urge to sleep", example: "Caffeine blocks but doesn't clear it" },
                { term: "Centenarian Decathlon", definition: "10 tasks you want to do at 100, train now", example: "Pick up grandchild at 90 = squat heavy at 50" }
            ],
            dating: [
                { term: "Social Proof", definition: "Others' actions signal correct behavior", example: "Being seen with friends signals validation" },
                { term: "Outcome Independence", definition: "Not attached to interaction results", example: "Approach to practice, not 'get the number'" },
                { term: "Frame Control", definition: "Maintaining your reality vs being pulled into others'", example: "Staying amused when tested" },
                { term: "Approach Anxiety", definition: "Fear response before approaching someone", example: "3-second rule: act before anxiety builds" },
                { term: "Push-Pull", definition: "Alternating interest and disinterest", example: "Compliment then playful tease" }
            ],
            lifestyle: [
                { term: "Environment Design", definition: "Shaping space to make good behaviors easy", example: "Phone charger in another room" },
                { term: "Decision Fatigue", definition: "Decision quality deteriorates after many choices", example: "Same outfit daily saves decisions" },
                { term: "Keystone Habit", definition: "One habit that triggers other positive habits", example: "Exercise triggers better eating and sleep" },
                { term: "Friction", definition: "Obstacles between intention and action", example: "Delete apps to add friction to scrolling" },
                { term: "Two-Minute Rule", definition: "Under 2 minutes = do it now", example: "Reply now vs adding to todo list" }
            ]
        };

        // Daily Mantras (30 affirmations)
        const dailyMantras = [
            "Discipline equals freedom. I do what needs to be done.",
            "I take action before I feel ready. Clarity comes from doing.",
            "I am not my excuses. I am my choices.",
            "Hard work is my therapy. Discomfort is my teacher.",
            "I own everything in my world. No excuses. No blame.",
            "If it is to be, it is up to me.",
            "I am responsible for my energy, my focus, and my results.",
            "I am not who I was yesterday. I am who I'm becoming.",
            "Every day I get 1% better. Compound growth is inevitable.",
            "Failure is not opposite of success. It's part of success.",
            "I don't know everything, but I can learn anything.",
            "I am enough. I have enough. I do enough.",
            "I back myself. I bet on myself. I build myself.",
            "My potential is not fixed. I am constantly expanding.",
            "This too shall pass. But I will remain.",
            "I have survived 100% of my worst days.",
            "Obstacles are not in my way. They are my way.",
            "I am not stopped by setbacks. I am refined by them.",
            "I create value. Money follows value.",
            "I invest in myself. I am my greatest asset.",
            "I think in decades. I act in days.",
            "I am where my feet are. Present. Focused. Here.",
            "Distractions are invitations I can decline.",
            "I choose depth over breadth. Quality over quantity.",
            "I control my thoughts. I control my actions. The rest is noise.",
            "Today I will meet difficult people. My peace is internal.",
            "I accept what I cannot change. I change what I cannot accept.",
            "I am the calm in my own storm.",
            "The obstacle is the way.",
            "What stands in the way becomes the way."
        ];

        // Greatest Books (30 transformative books)
        const greatestBooks = [
            { title: "Meditations", author: "Marcus Aurelius", insight: "Your thoughts shape your reality. Master them.", category: "Philosophy" },
            { title: "Man's Search for Meaning", author: "Viktor Frankl", insight: "Those who have a 'why' can bear any 'how'.", category: "Philosophy" },
            { title: "The Obstacle Is the Way", author: "Ryan Holiday", insight: "Turn obstacles into fuel for achievement.", category: "Stoicism" },
            { title: "Think and Grow Rich", author: "Napoleon Hill", insight: "Thoughts are things. What you think, you become.", category: "Success" },
            { title: "As a Man Thinketh", author: "James Allen", insight: "Mind is the master weaver of both inner and outer garment.", category: "Mindset" },
            { title: "The Almanack of Naval Ravikant", author: "Eric Jorgenson", insight: "Seek wealth, not money. Build assets that earn while you sleep.", category: "Wealth" },
            { title: "Rich Dad Poor Dad", author: "Robert Kiyosaki", insight: "Assets put money in your pocket. Liabilities take it out.", category: "Finance" },
            { title: "The 4-Hour Workweek", author: "Tim Ferriss", insight: "The goal is not to be busy but to be effective.", category: "Lifestyle" },
            { title: "Zero to One", author: "Peter Thiel", insight: "Monopoly is the condition of every successful business.", category: "Business" },
            { title: "The Psychology of Money", author: "Morgan Housel", insight: "Wealth is what you don't see - assets not spent.", category: "Finance" },
            { title: "Atomic Habits", author: "James Clear", insight: "You do not rise to your goals. You fall to your systems.", category: "Habits" },
            { title: "Deep Work", author: "Cal Newport", insight: "The ability to perform deep work is becoming rare and valuable.", category: "Productivity" },
            { title: "The 7 Habits of Highly Effective People", author: "Stephen Covey", insight: "Begin with the end in mind.", category: "Effectiveness" },
            { title: "Essentialism", author: "Greg McKeown", insight: "Less but better. The disciplined pursuit of less.", category: "Focus" },
            { title: "Getting Things Done", author: "David Allen", insight: "Your mind is for having ideas, not holding them.", category: "Productivity" },
            { title: "48 Laws of Power", author: "Robert Greene", insight: "Never outshine the master. Win through actions, not argument.", category: "Power" },
            { title: "How to Win Friends and Influence People", author: "Dale Carnegie", insight: "You can make more friends by being interested than interesting.", category: "Influence" },
            { title: "The Art of War", author: "Sun Tzu", insight: "Supreme excellence is breaking resistance without fighting.", category: "Strategy" },
            { title: "Extreme Ownership", author: "Jocko Willink", insight: "There are no bad teams, only bad leaders.", category: "Leadership" },
            { title: "Never Split the Difference", author: "Chris Voss", insight: "He who has learned to disagree without being disagreeable has discovered the secret.", category: "Negotiation" },
            { title: "Why We Sleep", author: "Matthew Walker", insight: "Sleep is the single most effective thing for brain and body.", category: "Health" },
            { title: "Can't Hurt Me", author: "David Goggins", insight: "The 40% rule: when you think you're done, you're at 40%.", category: "Mental Toughness" },
            { title: "The Body Keeps the Score", author: "Bessel van der Kolk", insight: "Trauma lives in the body. Healing requires both mind and body.", category: "Psychology" },
            { title: "Breath", author: "James Nestor", insight: "How we breathe matters as much as what we eat or how we move.", category: "Health" },
            { title: "The Republic", author: "Plato", insight: "Justice in the soul and city are mirrors of each other.", category: "Philosophy" },
            { title: "Letters from a Stoic", author: "Seneca", insight: "We suffer more in imagination than in reality.", category: "Stoicism" },
            { title: "The Prince", author: "Machiavelli", insight: "It is better to be feared than loved, if you cannot be both.", category: "Strategy" },
            { title: "Tao Te Ching", author: "Lao Tzu", insight: "The Tao that can be told is not the eternal Tao.", category: "Philosophy" },
            { title: "The Bhagavad Gita", author: "Vyasa", insight: "You have the right to work, but never to the fruit of work.", category: "Spirituality" },
            { title: "The Autobiography of Benjamin Franklin", author: "Benjamin Franklin", insight: "An investment in knowledge pays the best interest.", category: "Biography" },
            { title: "The Richest Man in Town", author: "Randall Jones", insight: "The common thread among the wealthy is relentless persistence and genuine care for others.", category: "Wealth" },
            { title: "The Millionaire Fastlane", author: "MJ DeMarco", insight: "Wealth is not a road - it's a system. The Fastlane is about controllable unlimited leverage.", category: "Wealth" },
            { title: "How to Attract Money", author: "Joseph Murphy", insight: "Your subconscious mind is a garden - plant wealth thoughts and harvest abundance.", category: "Mindset" },
            { title: "The Ten Roads to Riches", author: "Ken Fisher", insight: "There are multiple paths to wealth - find the one that fits your skills and personality.", category: "Wealth" },
            { title: "The Magic of Thinking Big", author: "David Schwartz", insight: "The size of your success is determined by the size of your belief.", category: "Success" },
            { title: "How to Get Rich", author: "Felix Dennis", insight: "If you want to be rich, you must learn to identify and overcome your fear of failure.", category: "Wealth" },
            { title: "The Seven Spiritual Laws of Success", author: "Deepak Chopra", insight: "Success is the ability to fulfill your desires with effortless ease.", category: "Spirituality" }
        ];

        // Billionaire Traits (15 traits with examples)
        const billionaireTraits = [
            {
                trait: "First Principles Thinking",
                description: "Breaking problems down to fundamental truths and building up from there",
                examples: [
                    { name: "Elon Musk", example: "Instead of buying rockets, asked 'What are rockets made of?' and built SpaceX at 10% the cost" },
                    { name: "Jeff Bezos", example: "Asked 'What won't change in 10 years?' Answer: low prices, fast delivery, selection" }
                ]
            },
            {
                trait: "Extreme Long-Term Thinking",
                description: "Making decisions based on decades, not quarters",
                examples: [
                    { name: "Jeff Bezos", example: "Accepted years of losses to build Amazon's infrastructure moat" },
                    { name: "Warren Buffett", example: "'Our favorite holding period is forever.' Compound interest requires patience" }
                ]
            },
            {
                trait: "Obsessive Focus",
                description: "Going all-in on one thing rather than diversifying attention",
                examples: [
                    { name: "Bill Gates", example: "Didn't take a day off in his 20s building Microsoft" },
                    { name: "Steve Jobs", example: "Cut Apple's products from 350 to 10 to focus on excellence" }
                ]
            },
            {
                trait: "Relentless Work Ethic",
                description: "Working harder and longer than everyone else thinks reasonable",
                examples: [
                    { name: "Elon Musk", example: "120-hour weeks during Tesla and SpaceX crises. Slept on factory floor" },
                    { name: "Mark Cuban", example: "Didn't take a vacation for 7 years building his first business" }
                ]
            },
            {
                trait: "High Risk Tolerance",
                description: "Betting everything when conviction is high",
                examples: [
                    { name: "Richard Branson", example: "Mortgaged his house to start Virgin Atlantic" },
                    { name: "Elon Musk", example: "Put all $180M from PayPal into Tesla, SpaceX, and SolarCity simultaneously" }
                ]
            },
            {
                trait: "Learning Machines",
                description: "Constant, voracious learning across multiple domains",
                examples: [
                    { name: "Warren Buffett", example: "Reads 500 pages daily. 'That's how knowledge builds up, like compound interest'" },
                    { name: "Charlie Munger", example: "Built 'mental models' from every discipline to make better decisions" }
                ]
            },
            {
                trait: "Contrarian Conviction",
                description: "Being right when the consensus is wrong",
                examples: [
                    { name: "Peter Thiel", example: "'What important truth do very few people agree with you on?'" },
                    { name: "Howard Marks", example: "Made billions buying when everyone else was selling in 2008" }
                ]
            },
            {
                trait: "Mission Over Money",
                description: "Pursuing a vision larger than profit",
                examples: [
                    { name: "Elon Musk", example: "Goal: make humanity multi-planetary. Money is means, not end" },
                    { name: "Yvon Chouinard", example: "Gave away $3B Patagonia company to fight climate change" }
                ]
            },
            {
                trait: "Talent Magnetism",
                description: "Attracting and retaining exceptional people",
                examples: [
                    { name: "Steve Jobs", example: "'A players hire A players. B players hire C players.'" },
                    { name: "Reed Hastings", example: "Netflix: 'Adequate performance gets generous severance'" }
                ]
            },
            {
                trait: "Rapid Iteration",
                description: "Moving fast, learning from failures, and adapting quickly",
                examples: [
                    { name: "Mark Zuckerberg", example: "'Move fast and break things' (early Facebook philosophy)" },
                    { name: "Jeff Bezos", example: "'If you double the number of experiments, you double your inventiveness'" }
                ]
            },
            {
                trait: "Capital Efficiency",
                description: "Doing more with less, especially early on",
                examples: [
                    { name: "Sam Walton", example: "Drove an old pickup truck and flew coach even as a billionaire" },
                    { name: "Ingvar Kamprad", example: "IKEA founder took the bus and stayed in budget hotels despite $58B fortune" }
                ]
            },
            {
                trait: "Systems Thinking",
                description: "Building systems and processes that scale without you",
                examples: [
                    { name: "Ray Dalio", example: "Built 'Principles' - systematic decision-making rules for Bridgewater" },
                    { name: "Ray Kroc", example: "McDonald's franchising system created wealth without owning every store" }
                ]
            },
            {
                trait: "Asymmetric Bet Recognition",
                description: "Identifying opportunities where upside vastly exceeds downside",
                examples: [
                    { name: "Masayoshi Son", example: "$20M in Alibaba became $60B - 3000x return" },
                    { name: "Peter Thiel", example: "$500K in Facebook became $1B at IPO" }
                ]
            },
            {
                trait: "Emotional Resilience",
                description: "Staying calm and rational during extreme pressure",
                examples: [
                    { name: "Elon Musk", example: "In 2008: divorce, rocket failures, Tesla near bankruptcy. Kept building" },
                    { name: "Steve Jobs", example: "Got fired from Apple, built Pixar, returned to make Apple the most valuable company" }
                ]
            },
            {
                trait: "Reality Distortion",
                description: "Convincing others (and yourself) that the impossible is possible",
                examples: [
                    { name: "Steve Jobs", example: "Engineers said iPhone timeline was impossible. He made them believe" },
                    { name: "Elon Musk", example: "Convinced top engineers that reusable rockets and mass-market EVs were achievable" }
                ]
            }
        ];

        // Inline fallback level definitions (works without loading JSON)
        const fallbackLevelDefinitions = {
            money: {
                1: { name: "Awareness", description: "Becoming aware that trading time for money has limits", capabilities: ["Understand income vs wealth", "Know your hourly rate"], milestone: "Calculate your true hourly rate" },
                2: { name: "Foundation", description: "Building basic wealth-creation knowledge", capabilities: ["Understand compounding", "Identify high-value skills"], milestone: "Create a skill development plan" },
                3: { name: "Skill Builder", description: "Actively developing income-multiplying skills", capabilities: ["Learning high-leverage skills", "Basic networking"], milestone: "Complete one paid project with new skill" },
                4: { name: "Value Creator", description: "Creating value beyond direct time exchange", capabilities: ["Package skills into offers", "Basic pricing"], milestone: "Generate first income from packaged knowledge" },
                5: { name: "Leverage Seeker", description: "Building leverage through code, media, or capital", capabilities: ["Creating content/code", "Building systems"], milestone: "Create one asset that generates passive income" },
                6: { name: "System Builder", description: "Building repeatable wealth systems", capabilities: ["Multiple income streams", "Delegation"], milestone: "Passive income exceeds 25% of total" },
                7: { name: "Equity Thinker", description: "Thinking in terms of ownership", capabilities: ["Building equity stakes", "Compounding mindset"], milestone: "Own equity in revenue-generating asset" },
                8: { name: "Wealth Architect", description: "Designing wealth systems at scale", capabilities: ["Multiple leverage types", "Capital allocation"], milestone: "Passive income covers living expenses" },
                9: { name: "Freedom Builder", description: "Wealth provides significant freedom", capabilities: ["Work is optional", "Capital compounds"], milestone: "Can take 6+ months off" },
                10: { name: "Wealth Master", description: "Complete financial freedom", capabilities: ["Wealth grows automatically", "Legacy building"], milestone: "Focus shifts to impact" }
            },
            sales: {
                1: { name: "Awareness", description: "Understanding sales as a learnable skill", capabilities: ["Know basic sales concepts"], milestone: "Make your first sales attempt" },
                3: { name: "Practitioner", description: "Regularly practicing sales skills", capabilities: ["Handle basic objections", "Follow up consistently"], milestone: "Close your first deal" },
                5: { name: "Competent", description: "Consistently closing deals", capabilities: ["Overcome most objections", "Build rapport quickly"], milestone: "Hit monthly sales targets" },
                7: { name: "Expert", description: "High conversion rates", capabilities: ["Complex negotiations", "Teach others"], milestone: "Train a new salesperson" },
                10: { name: "Master", description: "Effortless persuasion", capabilities: ["Close difficult deals", "Strategic selling"], milestone: "Build a sales team" }
            },
            finance: {
                1: { name: "Survival", description: "Living paycheck to paycheck", capabilities: ["Basic budgeting"], milestone: "Create first budget" },
                3: { name: "Stability", description: "Emergency fund started", capabilities: ["Track expenses", "Reduce debt"], milestone: "Save first $1000" },
                5: { name: "Growth", description: "Investing consistently", capabilities: ["Understand markets", "Tax optimization"], milestone: "Invest 15% of income" },
                7: { name: "Abundance", description: "Multiple investment streams", capabilities: ["Portfolio management", "Tax strategies"], milestone: "Net worth exceeds annual income" },
                10: { name: "Freedom", description: "Financial independence", capabilities: ["Passive income covers expenses"], milestone: "Work is optional" }
            },
            productivity: {
                1: { name: "Reactive", description: "Day controlled by others", capabilities: ["Basic task lists"], milestone: "Complete a to-do list" },
                3: { name: "Organized", description: "Systems in place", capabilities: ["Calendar blocking", "Prioritization"], milestone: "Consistent morning routine" },
                5: { name: "Focused", description: "Deep work is regular", capabilities: ["2+ hours focused daily", "Eliminate distractions"], milestone: "Complete major project" },
                7: { name: "Optimized", description: "High output consistently", capabilities: ["Energy management", "Automation"], milestone: "Double output vs previous year" },
                10: { name: "Master", description: "Effortless productivity", capabilities: ["Systems run themselves", "Focus at will"], milestone: "Achieve major life goal" }
            },
            business: {
                1: { name: "Explorer", description: "Exploring business ideas", capabilities: ["Identify opportunities"], milestone: "Generate 10 business ideas" },
                3: { name: "Validator", description: "Testing ideas with customers", capabilities: ["Customer interviews", "MVP creation"], milestone: "Get first paying customer" },
                5: { name: "Builder", description: "Building sustainable business", capabilities: ["Product-market fit", "Basic operations"], milestone: "Consistent monthly revenue" },
                7: { name: "Scaler", description: "Growing beyond yourself", capabilities: ["Team building", "Systems"], milestone: "Business runs without you daily" },
                10: { name: "Leader", description: "Industry influence", capabilities: ["Strategic thinking", "Multiple ventures"], milestone: "Successful exit or major scale" }
            },
            mindset: {
                1: { name: "Unaware", description: "Thoughts control you", capabilities: ["Basic self-awareness"], milestone: "Start journaling" },
                3: { name: "Aware", description: "Noticing thought patterns", capabilities: ["Identify limiting beliefs", "Basic reframing"], milestone: "Change one limiting belief" },
                5: { name: "Disciplined", description: "Consistent practices", capabilities: ["Daily discipline", "Emotional regulation"], milestone: "30-day discipline streak" },
                7: { name: "Resilient", description: "Bounce back quickly", capabilities: ["Handle adversity", "Growth mindset"], milestone: "Turn major setback into opportunity" },
                10: { name: "Master", description: "Mind serves you", capabilities: ["Peace under pressure", "Inspire others"], milestone: "Consistent equanimity" }
            },
            dating: {
                1: { name: "Isolated", description: "Limited social engagement", capabilities: ["Basic conversation"], milestone: "Start one conversation with stranger" },
                3: { name: "Social", description: "Comfortable in groups", capabilities: ["Remember names", "Active listening"], milestone: "Make 3 new connections" },
                5: { name: "Connected", description: "Strong social network", capabilities: ["Build rapport easily", "Maintain relationships"], milestone: "Regular social activities" },
                7: { name: "Magnetic", description: "Natural charisma", capabilities: ["Influence without trying", "Deep connections"], milestone: "Build meaningful relationships" },
                10: { name: "Master", description: "Social abundance", capabilities: ["Connect anyone to anyone", "Natural leader"], milestone: "Known as a connector" }
            },
            lifestyle: {
                1: { name: "Default", description: "Living by default", capabilities: ["Basic awareness"], milestone: "Define ideal day" },
                3: { name: "Intentional", description: "Making conscious choices", capabilities: ["Environment design", "Habit basics"], milestone: "Implement one life design change" },
                5: { name: "Designed", description: "Life matches values", capabilities: ["Systems for goals", "Energy management"], milestone: "Ideal week structure" },
                7: { name: "Optimized", description: "High performance lifestyle", capabilities: ["Work-life integration", "Travel freedom"], milestone: "Location independence" },
                10: { name: "Freedom", description: "Complete life design mastery", capabilities: ["Time abundance", "Purpose alignment"], milestone: "Living your ideal life" }
            },
            health: {
                1: { name: "Neglected", description: "Health is an afterthought", capabilities: ["Basic awareness"], milestone: "Get baseline health check" },
                3: { name: "Active", description: "Regular movement", capabilities: ["Exercise habit", "Basic nutrition"], milestone: "Consistent workout routine" },
                5: { name: "Fit", description: "Above average fitness", capabilities: ["Strength training", "Sleep optimization"], milestone: "Hit major fitness milestone" },
                7: { name: "Optimized", description: "Peak performance", capabilities: ["Advanced protocols", "Biohacking basics"], milestone: "All biomarkers optimal" },
                8: { name: "Athlete", description: "High-level fitness maintained", capabilities: ["Zone 2 mastery", "Recovery protocols"], milestone: "Compete or achieve athletic goal" },
                10: { name: "Master", description: "Longevity focused excellence", capabilities: ["Centenarian Decathlon ready", "Healthspan maximized"], milestone: "Biological age younger than chronological" }
            }
        };

        // Inline progressive exercises (works without server)
        const inlineExercises = {
            money: {
                beginner: [
                    { title: "Calculate Your True Hourly Rate", difficulty: 1, time_minutes: 20, instructions: "Add up ALL hours you spend on work (commute, prep, recovery). Divide your annual income by total hours. Compare to what you thought.", success_criteria: "Written calculation with reflection on the gap" },
                    { title: "Identify Your Specific Knowledge", difficulty: 1, time_minutes: 30, instructions: "List 10 things you know that feel obvious to you but others frequently ask about.", success_criteria: "List of 10 items with 3+ that could be monetized" }
                ],
                intermediate: [
                    { title: "Create Your First Digital Asset", difficulty: 2, time_minutes: 120, instructions: "Turn one piece of your specific knowledge into a digital asset: template, checklist, mini-guide.", success_criteria: "One completed digital asset ready to share" },
                    { title: "Build a Value Equation Offer", difficulty: 2, time_minutes: 60, instructions: "Using Hormozi's Value Equation, design an offer. Calculate Dream Outcome, Likelihood, Time Delay, Effort.", success_criteria: "Written offer with all four components optimized" }
                ],
                advanced: [
                    { title: "Design Your Leverage Stack", difficulty: 3, time_minutes: 90, instructions: "Map out how you'll combine Labor, Capital, Code, Media leverage. Create a 12-month plan.", success_criteria: "Written 12-month leverage building plan with milestones" }
                ]
            },
            sales: {
                beginner: [
                    { title: "Write Your Opening Script", difficulty: 1, time_minutes: 30, instructions: "Write a 30-second opening that hooks attention and establishes credibility.", success_criteria: "Memorized opening you can deliver confidently" },
                    { title: "Top 5 Objection Responses", difficulty: 1, time_minutes: 45, instructions: "List the 5 objections you hear most. Write tactical empathy responses for each.", success_criteria: "5 objection responses using labeling and mirroring" }
                ],
                intermediate: [
                    { title: "Record and Review 3 Calls", difficulty: 2, time_minutes: 90, instructions: "Record yourself on 3 sales calls. Review for tonality, pacing, and objection handling.", success_criteria: "Written notes on 3 improvements to make" },
                    { title: "Build a Follow-up Sequence", difficulty: 2, time_minutes: 60, instructions: "Create a 7-touch follow-up sequence with varied channels and value-adds.", success_criteria: "Complete sequence ready to implement" }
                ],
                advanced: [
                    { title: "Role-play Complex Negotiation", difficulty: 3, time_minutes: 60, instructions: "Have someone throw every objection at you. Practice tactical empathy responses.", success_criteria: "Handle 10 objections without breaking frame" }
                ]
            },
            productivity: {
                beginner: [
                    { title: "Design Your Shutdown Ritual", difficulty: 1, time_minutes: 20, instructions: "Create a 5-step end-of-day ritual that closes open loops and prepares tomorrow.", success_criteria: "Written ritual you can complete in 10 minutes" },
                    { title: "Time Block Tomorrow", difficulty: 1, time_minutes: 15, instructions: "Block your entire day tomorrow in 30-90 minute chunks. Include deep work blocks.", success_criteria: "Full day time-blocked with 2+ hours of deep work" }
                ],
                intermediate: [
                    { title: "Habit Stack 3 New Behaviors", difficulty: 2, time_minutes: 30, instructions: "Identify 3 habits you want to build. Stack each onto an existing habit.", success_criteria: "3 habit stacks written: After [CURRENT], I will [NEW]" },
                    { title: "Eliminate 5 Time Wasters", difficulty: 2, time_minutes: 45, instructions: "Track your time for a day. Identify 5 activities that waste time. Eliminate or reduce.", success_criteria: "5 concrete changes implemented" }
                ],
                advanced: [
                    { title: "Build a Personal Operating System", difficulty: 3, time_minutes: 120, instructions: "Document your ideal week structure, daily routines, decision frameworks.", success_criteria: "Complete system documented and implemented for 1 week" }
                ]
            },
            mindset: {
                beginner: [
                    { title: "Daily Stoic Journal", difficulty: 1, time_minutes: 15, instructions: "Morning: What could go wrong today? How will I handle it? Evening: What did I learn?", success_criteria: "7 consecutive days of journaling" },
                    { title: "Reframe 5 Limiting Beliefs", difficulty: 1, time_minutes: 30, instructions: "List 5 beliefs holding you back. Reframe each into an empowering alternative.", success_criteria: "5 reframes you can recite from memory" }
                ],
                intermediate: [
                    { title: "Do Something That Scares You", difficulty: 2, time_minutes: 60, instructions: "Identify something you've been avoiding due to fear. Do it today.", success_criteria: "Action completed with reflection on what you learned" },
                    { title: "24-Hour No Complaint Challenge", difficulty: 2, time_minutes: 1440, instructions: "Go 24 hours without complaining, criticizing, or gossiping.", success_criteria: "Full 24 hours completed with written reflection" }
                ],
                advanced: [
                    { title: "Fear-Setting Exercise", difficulty: 3, time_minutes: 60, instructions: "For a scary decision: Define worst case, prevention, repair, and benefits of action vs inaction.", success_criteria: "Complete Tim Ferriss fear-setting worksheet" }
                ]
            },
            business: {
                beginner: [
                    { title: "Talk to 3 Potential Customers", difficulty: 1, time_minutes: 90, instructions: "Find 3 people who might have the problem you want to solve. Ask about their pain points.", success_criteria: "3 conversations with notes on patterns" },
                    { title: "Write Your PR/FAQ", difficulty: 1, time_minutes: 45, instructions: "Write a press release for your idea as if it's already successful. Then list FAQs.", success_criteria: "1-page PR/FAQ document" }
                ],
                intermediate: [
                    { title: "Build an MVP in a Weekend", difficulty: 2, time_minutes: 480, instructions: "Create the simplest version of your idea that delivers value. Launch it.", success_criteria: "MVP live and shared with 10 potential users" },
                    { title: "First Principles Analysis", difficulty: 2, time_minutes: 60, instructions: "Take a problem in your industry. Break it down to fundamental truths. Rebuild solution.", success_criteria: "Written analysis with at least one novel insight" }
                ],
                advanced: [
                    { title: "Design Your Business Model", difficulty: 3, time_minutes: 120, instructions: "Complete a Business Model Canvas for your idea. Validate each assumption.", success_criteria: "Complete canvas with validation plan for key assumptions" }
                ]
            },
            finance: {
                beginner: [
                    { title: "Calculate Your FI Number", difficulty: 1, time_minutes: 20, instructions: "Annual expenses  25 = your Financial Independence number. How far away are you?", success_criteria: "Written FI number with current gap analysis" },
                    { title: "Subscription Audit", difficulty: 1, time_minutes: 30, instructions: "List every recurring payment. Cancel anything you haven't used in 30 days.", success_criteria: "At least 2 subscriptions cancelled" }
                ],
                intermediate: [
                    { title: "Automate Your Finances", difficulty: 2, time_minutes: 60, instructions: "Set up automatic transfers for savings, investments, and bills on payday.", success_criteria: "All major money movements automated" },
                    { title: "Negotiate One Bill", difficulty: 2, time_minutes: 30, instructions: "Call one service provider and negotiate a lower rate.", success_criteria: "Saved money or documented attempt" }
                ],
                advanced: [
                    { title: "Create a Wealth Building Plan", difficulty: 3, time_minutes: 90, instructions: "Map your path from current net worth to FI number with specific milestones.", success_criteria: "Written 10-year plan with annual checkpoints" }
                ]
            },
            dating: {
                beginner: [
                    { title: "Start 3 Conversations", difficulty: 1, time_minutes: 60, instructions: "Start a conversation with 3 strangers today. Just be curious about them.", success_criteria: "3 conversations of at least 2 minutes each" },
                    { title: "Remember 5 Names", difficulty: 1, time_minutes: 30, instructions: "Learn and remember 5 new people's names today. Use them in conversation.", success_criteria: "5 names you can recall at end of day" }
                ],
                intermediate: [
                    { title: "Practice Active Listening", difficulty: 2, time_minutes: 45, instructions: "In every conversation today, summarize what the person said before responding.", success_criteria: "Used summarizing in 5+ conversations" },
                    { title: "Give 5 Genuine Compliments", difficulty: 2, time_minutes: 30, instructions: "Give 5 specific, genuine compliments to different people.", success_criteria: "5 compliments that made people smile" }
                ],
                advanced: [
                    { title: "Host a Small Gathering", difficulty: 3, time_minutes: 180, instructions: "Organize a dinner or activity with 4-6 people, mixing friend groups.", success_criteria: "Event completed with positive feedback" }
                ]
            },
            lifestyle: {
                beginner: [
                    { title: "Define Your Ideal Day", difficulty: 1, time_minutes: 30, instructions: "Write out your perfect day in detail. Morning to night. What would make it 10/10?", success_criteria: "Detailed ideal day written out" },
                    { title: "Environment Audit", difficulty: 1, time_minutes: 45, instructions: "Walk through your space. Remove 5 things that tempt bad behavior. Add 5 that support good behavior.", success_criteria: "10 environment changes made" }
                ],
                intermediate: [
                    { title: "24-Hour Digital Detox", difficulty: 2, time_minutes: 1440, instructions: "No social media, news, or entertainment for 24 hours.", success_criteria: "Full 24 hours completed with reflection" },
                    { title: "Design Your Ideal Week", difficulty: 2, time_minutes: 60, instructions: "Block out your ideal week: work, health, relationships, learning, rest.", success_criteria: "Weekly template created and scheduled" }
                ],
                advanced: [
                    { title: "30-Day Experiment", difficulty: 3, time_minutes: 43200, instructions: "Design and complete a 30-day experiment to test a lifestyle change.", success_criteria: "30 days completed with results documented" }
                ]
            },
            health: {
                beginner: [
                    { title: "Morning Sunlight Protocol", difficulty: 1, time_minutes: 15, instructions: "Get outside within 30 minutes of waking. 10 min sunlight, no sunglasses.", success_criteria: "7 consecutive days completed" },
                    { title: "Sleep Audit", difficulty: 1, time_minutes: 30, instructions: "Track your sleep for a week. Identify your optimal bedtime and wake time.", success_criteria: "Optimal sleep schedule identified" }
                ],
                intermediate: [
                    { title: "Zone 2 Cardio Session", difficulty: 2, time_minutes: 45, instructions: "Do 45 min of cardio where you can still hold a conversation. Track heart rate.", success_criteria: "Session completed in Zone 2 (60-70% max HR)" },
                    { title: "Cold Exposure", difficulty: 2, time_minutes: 15, instructions: "End your shower with 30 seconds of cold water. Build to 2 minutes over a week.", success_criteria: "2 minutes of cold exposure achieved" }
                ],
                advanced: [
                    { title: "Design Your Centenarian Decathlon", difficulty: 3, time_minutes: 60, instructions: "List 10 physical activities you want to do at age 100. Train for them now.", success_criteria: "10 activities listed with current training plan" }
                ]
            }
        };

        // Inline cross-module connections
        const inlineConnections = {
            money: [
                { connected_module: "sales", insight: "Sales skills are the fastest path to increased income - you can double your rates with better positioning", combined_exercise: "Practice pitching your specific knowledge in a 60-second value statement" },
                { connected_module: "productivity", insight: "Deep work compounds wealth - one focused hour can produce more than 8 distracted hours", combined_exercise: "Block 2 hours for your highest-value skill development" },
                { connected_module: "mindset", insight: "Your beliefs about money determine your ceiling - most wealth limits are self-imposed", combined_exercise: "Write down 5 beliefs about wealth and challenge each one" }
            ],
            sales: [
                { connected_module: "mindset", insight: "Rejection is data, not failure. Your mindset determines your persistence", combined_exercise: "Reframe your last 5 rejections as learning opportunities" },
                { connected_module: "money", insight: "Sales skills transfer to negotiating salary, rates, and business deals", combined_exercise: "Negotiate something today using tactical empathy" }
            ],
            productivity: [
                { connected_module: "mindset", insight: "Discipline creates freedom - the structure enables creativity", combined_exercise: "Build one productive habit using the 2-minute rule" },
                { connected_module: "health", insight: "Energy management enables time management - you can't focus when depleted", combined_exercise: "Optimize sleep for one week and track productivity changes" }
            ],
            mindset: [
                { connected_module: "productivity", insight: "Your identity drives your habits - become the person who does the thing", combined_exercise: "Define who you need to become to achieve your goals" },
                { connected_module: "health", insight: "Physical challenges build mental toughness - the body leads the mind", combined_exercise: "Do one physically uncomfortable thing today" }
            ],
            business: [
                { connected_module: "sales", insight: "Every founder is in sales - you're always selling vision, product, or yourself", combined_exercise: "Practice your company pitch in 30 seconds, 2 minutes, and 10 minutes" },
                { connected_module: "money", insight: "Business is the vehicle for wealth - jobs have income ceilings", combined_exercise: "Identify one way to turn your job skills into a business" }
            ],
            finance: [
                { connected_module: "mindset", insight: "Financial freedom is a mindset before it's a number", combined_exercise: "Define what 'enough' means for you" },
                { connected_module: "lifestyle", insight: "Your spending reflects your values - audit for alignment", combined_exercise: "Compare your spending to your stated priorities" }
            ],
            dating: [
                { connected_module: "mindset", insight: "Confidence comes from competence - social skills are built, not born", combined_exercise: "Practice one conversation skill for a week" },
                { connected_module: "lifestyle", insight: "Your environment shapes your social opportunities", combined_exercise: "Join one community aligned with your interests" }
            ],
            lifestyle: [
                { connected_module: "productivity", insight: "Environment design beats willpower every time", combined_exercise: "Optimize one space for your most important activity" },
                { connected_module: "mindset", insight: "Fear-setting prevents regret - define the downside clearly", combined_exercise: "Do a fear-setting exercise on one lifestyle change you've been avoiding" }
            ],
            health: [
                { connected_module: "productivity", insight: "Sleep is the foundation - everything degrades without it", combined_exercise: "Implement a non-negotiable bedtime for one week" },
                { connected_module: "mindset", insight: "Physical discipline builds mental discipline - start with the body", combined_exercise: "Add one healthy habit using habit stacking" }
            ]
        };

        // ============================================
        // ENHANCED MASTERS DATA (loaded from JSON files)
        // ============================================
        let enhancedMastersData = {};
        let levelDefinitions = {};

        // Load enhanced data from JSON files (PARALLEL - all fetches at once)
        async function loadEnhancedMastersData() {
            const moduleFileMap = {
                money: 'money_masters.json',
                sales: 'sales_masters.json',
                finance: 'finance_masters.json',
                productivity: 'productivity_masters.json',
                business: 'business_masters.json',
                mindset: 'mindset_masters.json',
                social: 'social_masters.json',
                dating: 'social_masters.json',
                lifestyle: 'lifestyle_masters.json',
                health: 'health_masters.json'
            };

            // Fire all fetches in parallel
            const entries = Object.entries(moduleFileMap);
            const results = await Promise.allSettled(
                entries.map(([, file]) => fetch(`knowledge_base/masters/${file}`).then(r => r.ok ? r.json() : null))
            );

            results.forEach((result, i) => {
                if (result.status === 'fulfilled' && result.value) {
                    const mod = entries[i][0];
                    enhancedMastersData[mod] = result.value;
                    if (result.value.level_definitions) {
                        levelDefinitions[mod] = result.value.level_definitions;
                    }
                }
            });
        }

        // Get level name for a module
        function getLevelName(moduleKey, level) {
            // Try loaded data first
            if (levelDefinitions[moduleKey] && levelDefinitions[moduleKey][level]) {
                return levelDefinitions[moduleKey][level].name;
            }
            // Try inline fallback data
            if (fallbackLevelDefinitions[moduleKey] && fallbackLevelDefinitions[moduleKey][level]) {
                return fallbackLevelDefinitions[moduleKey][level].name;
            }
            // Find closest level in fallback
            if (fallbackLevelDefinitions[moduleKey]) {
                const levels = Object.keys(fallbackLevelDefinitions[moduleKey]).map(Number).sort((a, b) => a - b);
                for (let i = levels.length - 1; i >= 0; i--) {
                    if (levels[i] <= level) {
                        return fallbackLevelDefinitions[moduleKey][levels[i]].name;
                    }
                }
            }
            // Generic fallback
            const generic = {
                1: 'Beginner', 2: 'Novice', 3: 'Apprentice', 4: 'Practitioner', 5: 'Competent',
                6: 'Proficient', 7: 'Advanced', 8: 'Expert', 9: 'Master', 10: 'Grandmaster'
            };
            return generic[level] || 'Level ' + level;
        }

        // Get level definition details
        function getLevelDefinition(moduleKey, level) {
            // Try loaded data first
            if (levelDefinitions[moduleKey] && levelDefinitions[moduleKey][level]) {
                return levelDefinitions[moduleKey][level];
            }
            // Try inline fallback data - exact match
            if (fallbackLevelDefinitions[moduleKey] && fallbackLevelDefinitions[moduleKey][level]) {
                return fallbackLevelDefinitions[moduleKey][level];
            }
            // Find closest level in fallback
            if (fallbackLevelDefinitions[moduleKey]) {
                const levels = Object.keys(fallbackLevelDefinitions[moduleKey]).map(Number).sort((a, b) => a - b);
                for (let i = levels.length - 1; i >= 0; i--) {
                    if (levels[i] <= level) {
                        return fallbackLevelDefinitions[moduleKey][levels[i]];
                    }
                }
            }
            return null;
        }

        // Find enhanced master data
        function findEnhancedMaster(name, moduleKey) {
            const moduleData = enhancedMastersData[moduleKey];
            if (moduleData && moduleData.masters) {
                return moduleData.masters.find(m => m.name === name);
            }
            return null;
        }

        // Get module data (level definitions, exercises, connections)
        function getModuleData(moduleKey) {
            // Try enhanced data first, then use inline fallback
            if (enhancedMastersData[moduleKey]) {
                return enhancedMastersData[moduleKey];
            }
            // Build fallback from inline data
            if (inlineExercises[moduleKey] || inlineConnections[moduleKey]) {
                return {
                    progressive_exercises: inlineExercises[moduleKey] || null,
                    cross_module_connections: inlineConnections[moduleKey] || null
                };
            }
            return null;
        }

        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        function getRandomItem(arr) {
            return arr[Math.floor(Math.random() * arr.length)];
        }

        // Debounced save - prevents JSON.stringify hammering on rapid actions
        let _saveTimer = null;
        function saveToStorage() {
            if (_saveTimer) clearTimeout(_saveTimer);
            _saveTimer = setTimeout(() => {
                try {
                    localStorage.setItem('selfMasteryOS', JSON.stringify(appData));
                } catch (e) {
                    console.warn('Storage save failed:', e.message);
                }
            }, 150);
        }

        // Force-save (for critical saves like check-in completion)
        function saveToStorageNow() {
            if (_saveTimer) clearTimeout(_saveTimer);
            try {
                localStorage.setItem('selfMasteryOS', JSON.stringify(appData));
            } catch (e) {
                console.warn('Storage save failed:', e.message);
            }
        }

        function loadFromStorage() {
            try {
                const saved = localStorage.getItem('selfMasteryOS');
                if (saved) {
                    appData = { ...appData, ...JSON.parse(saved) };
                }
            } catch (e) {
                console.warn('Storage load failed:', e.message);
            }
        }

        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <svg class="toast-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    ${type === 'success' ? '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>' : '<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>'}
                </svg>
                <span>${message}</span>
            `;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }

        // ============================================
        // PERFORMANCE UTILITIES
        // ============================================
        function debounce(fn, ms) {
            let t; return function(...a) { clearTimeout(t); t = setTimeout(() => fn.apply(this, a), ms); };
        }

        // DOM element cache to avoid repeated lookups
        const _elCache = new Map();
        function $(id) {
            if (!_elCache.has(id)) _elCache.set(id, document.getElementById(id));
            return _elCache.get(id);
        }
        function clearElCache() { _elCache.clear(); }

        // ============================================
        // MOBILE NAVIGATION
        // ============================================
        function toggleSidebar() {
            const sidebar = $('sidebar');
            const overlay = $('sidebarOverlay');
            const isOpen = sidebar.classList.toggle('open');
            if (isOpen) {
                overlay.style.display = 'block';
                requestAnimationFrame(() => overlay.classList.add('active'));
            } else {
                overlay.classList.remove('active');
                setTimeout(() => { overlay.style.display = 'none'; }, 300);
            }
        }

        function closeSidebar() {
            const sidebar = $('sidebar');
            const overlay = $('sidebarOverlay');
            sidebar.classList.remove('open');
            overlay.classList.remove('active');
            setTimeout(() => { overlay.style.display = 'none'; }, 300);
        }

        // ============================================
        // TIME & DATE (requestAnimationFrame-based, updates once per minute)
        // ============================================
        let _lastMinute = -1;
        function updateDateTime() {
            const now = new Date();
            const currentMinute = now.getMinutes();
            // Only update DOM when minute changes
            if (currentMinute !== _lastMinute) {
                _lastMinute = currentMinute;
                const dateEl = $('currentDate');
                const timeEl = $('currentTime');
                if (dateEl) dateEl.textContent = now.toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                if (timeEl) timeEl.textContent = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            }
        }

        function clockLoop() {
            updateDateTime();
            // Check every 10 seconds instead of every second
            setTimeout(clockLoop, 10000);
        }

        // ============================================
        // NAVIGATION (optimized: caches NodeLists)
        // ============================================
        let _navItems, _pageSections;
        function showPage(pageId) {
            // Cache NodeLists on first call
            if (!_navItems) _navItems = document.querySelectorAll('.nav-item');
            if (!_pageSections) _pageSections = document.querySelectorAll('.page-section');

            // Update nav
            _navItems.forEach(item => item.classList.remove('active'));
            event?.target?.closest('.nav-item')?.classList.add('active');

            // Update page
            _pageSections.forEach(page => page.classList.remove('active'));
            document.getElementById(`page-${pageId}`).classList.add('active');

            // Close sidebar on mobile
            if (window.innerWidth <= 768) closeSidebar();

            // Update title
            const titles = {
                dashboard: ['COMMAND CENTER', 'Your daily mission control'],
                journal: ['JOURNAL', 'Framework-driven strategic journaling'],
                plans: ['PLANS', 'Your goals and milestones'],
                systems: ['SYSTEMS', 'Build repeatable processes'],
                masters: ['MASTERS LIBRARY', 'Learn from the greats'],
                settings: ['SETTINGS', 'Customize your experience']
            };

            const [title, subtitle] = titles[pageId] || ['', ''];
            document.getElementById('pageTitle').textContent = title;
            document.getElementById('pageSubtitle').textContent = subtitle;

            // Load page-specific data
            if (pageId === 'masters') loadMastersPage();
            if (pageId === 'settings') loadSettingsPage();
            if (pageId === 'journal') loadJournalPage();
            if (pageId === 'plans') loadPlansPage();
            if (pageId === 'systems') loadSystemsPage();
        }

        // ============================================
        // MODALS
        // ============================================
        function openModal(titleOrId, content = null) {
            if (content === null) {
                // Legacy behavior: open modal by ID
                document.getElementById(titleOrId).classList.add('active');
            } else {
                // New behavior: dynamic modal with title and content
                openDynamicModal(titleOrId, content);
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        function openDynamicModal(title, content) {
            let modal = document.getElementById('dynamicModal');
            if (!modal) {
                modal = document.createElement('div');
                modal.id = 'dynamicModal';
                modal.className = 'modal-overlay';
                modal.innerHTML = `
                    <div class="modal" style="max-width: 600px;">
                        <div class="modal-header">
                            <h2 id="dynamicModalTitle"></h2>
                            <button class="modal-close" onclick="closeDynamicModal()">&times;</button>
                        </div>
                        <div class="modal-body" id="dynamicModalContent"></div>
                    </div>
                `;
                document.body.appendChild(modal);
            }
            document.getElementById('dynamicModalTitle').textContent = title;
            document.getElementById('dynamicModalContent').innerHTML = content;
            modal.classList.add('active');
        }

        function closeDynamicModal() {
            const modal = document.getElementById('dynamicModal');
            if (modal) modal.classList.remove('active');
        }

        // ============================================
        // WISDOM
        // ============================================
        function generateWisdom() {
            const focusModules = appData.profile.focusModules;
            const randomModule = getRandomItem(focusModules.filter(m => mastersData[m])) || 'mindset';
            const masters = mastersData[randomModule] || mastersData.mindset;
            const master = getRandomItem(masters);
            const teaching = getRandomItem(master.principles);
            const practice = getRandomItem(master.practices);

            const challengeModule = getRandomItem(Object.keys(challenges));
            const challenge = getRandomItem(challenges[challengeModule]);

            const question = getRandomItem(powerQuestions);
            const shift = getRandomItem(mindsetShifts);

            // Daily Vocabulary - pick from focus module or random
            const vocabModule = getRandomItem(focusModules.filter(m => dailyVocabulary[m])) || 'mindset';
            const vocabEntry = getRandomItem(dailyVocabulary[vocabModule] || dailyVocabulary.mindset);

            // Daily Mantra
            const mantra = getRandomItem(dailyMantras);

            // Daily Quote from any master
            const allMasters = Object.values(mastersData).flat();
            const quoteMaster = getRandomItem(allMasters);
            const dailyQuote = {
                text: getRandomItem(quoteMaster.principles),
                author: quoteMaster.name
            };

            // Today's Book
            const book = getRandomItem(greatestBooks);

            // Billionaire Trait
            const trait = getRandomItem(billionaireTraits);

            appData.currentWisdom = {
                master: master.name,
                expertise: master.expertise,
                teaching,
                practice,
                challengeModule,
                challenge,
                question,
                shift,
                vocabulary: { ...vocabEntry, module: vocabModule },
                mantra,
                dailyQuote,
                book,
                trait
            };

            return appData.currentWisdom;
        }

        function refreshWisdom() {
            const wisdom = generateWisdom();
            updateWisdomUI(wisdom);
            showToast('New wisdom loaded!');
        }

        function updateWisdomUI(wisdom) {
            // Dashboard - Main wisdom
            const dashMasterName = document.getElementById('dashMasterName');
            const dashMasterExpertise = document.getElementById('dashMasterExpertise');
            const dashWisdomQuote = document.getElementById('dashWisdomQuote');
            const dashPractice = document.getElementById('dashPractice');

            if (dashMasterName) dashMasterName.textContent = wisdom.master;
            if (dashMasterExpertise) dashMasterExpertise.textContent = wisdom.expertise;
            if (dashWisdomQuote) dashWisdomQuote.textContent = `"${wisdom.teaching}"`;
            if (dashPractice) dashPractice.textContent = wisdom.practice;

            // Dashboard - Daily Mantra
            if (wisdom.mantra) {
                const dashMantraText = document.getElementById('dashMantraText');
                if (dashMantraText) dashMantraText.textContent = `"${wisdom.mantra}"`;
            }
        }

        function saveChallengeResponse(source) {
            const inputEl = document.getElementById('dashChallengeResponse');
            if (!inputEl) return;

            const response = inputEl.value.trim();

            if (!response) {
                showToast('Please write something before saving', 'warning');
                return;
            }

            // Save to today's challenge log
            if (!appData.todayLog.challenges) {
                appData.todayLog.challenges = [];
            }

            const challengeEntry = {
                module: appData.currentWisdom?.challengeModule || 'general',
                challenge: appData.currentWisdom?.challenge || 'Daily challenge',
                response: response,
                timestamp: new Date().toISOString(),
                completed: false
            };

            // Check if we already have this challenge today
            const existingIdx = appData.todayLog.challenges.findIndex(c =>
                c.challenge === challengeEntry.challenge
            );

            if (existingIdx >= 0) {
                appData.todayLog.challenges[existingIdx].response = response;
                appData.todayLog.challenges[existingIdx].timestamp = challengeEntry.timestamp;
            } else {
                appData.todayLog.challenges.push(challengeEntry);
            }

            saveToStorage();
            showToast('Progress saved!');
        }

        function completeChallenge(source) {
            const inputEl = document.getElementById('dashChallengeResponse');
            const response = inputEl ? inputEl.value.trim() : '';

            // Save the response first
            if (response) {
                saveChallengeResponse(source);
            }

            // Mark as completed
            if (appData.todayLog.challenges?.length > 0) {
                const lastChallenge = appData.todayLog.challenges[appData.todayLog.challenges.length - 1];
                lastChallenge.completed = true;
                lastChallenge.completedAt = new Date().toISOString();
            } else {
                // Create a completed challenge entry even without response
                if (!appData.todayLog.challenges) {
                    appData.todayLog.challenges = [];
                }
                appData.todayLog.challenges.push({
                    module: appData.currentWisdom?.challengeModule || 'general',
                    challenge: appData.currentWisdom?.challenge || 'Daily challenge',
                    response: response || '',
                    timestamp: new Date().toISOString(),
                    completed: true,
                    completedAt: new Date().toISOString()
                });
            }

            // Add to challenge history for stats
            if (!appData.challengeHistory) {
                appData.challengeHistory = [];
            }
            appData.challengeHistory.push({
                date: new Date().toISOString().split('T')[0],
                module: appData.currentWisdom?.challengeModule || 'general',
                challenge: appData.currentWisdom?.challenge || 'Daily challenge',
                response: response || '',
                completedAt: new Date().toISOString()
            });

            // Keep only last 30 days of history
            if (appData.challengeHistory.length > 30) {
                appData.challengeHistory = appData.challengeHistory.slice(-30);
            }

            saveToStorage();
            showToast('Challenge completed! Great work. +1 to your streak!');
        }

        function savePowerQuestionResponse() {
            const response = document.getElementById('powerQuestionResponse').value.trim();

            if (!response) {
                showToast('Please write your reflection before saving', 'warning');
                return;
            }

            if (!appData.todayLog.reflections) {
                appData.todayLog.reflections = [];
            }

            appData.todayLog.reflections.push({
                type: 'power_question',
                question: appData.currentWisdom?.question || 'Power question',
                response: response,
                timestamp: new Date().toISOString()
            });

            saveToStorage();
            showToast('Reflection saved!');
        }

        function loadTodayChallengeProgress() {
            // Load any saved challenge responses for today
            if (appData.todayLog.challenges?.length > 0) {
                const lastChallenge = appData.todayLog.challenges[appData.todayLog.challenges.length - 1];
                if (lastChallenge.challenge === appData.currentWisdom?.challenge && lastChallenge.response) {
                    const dashInput = document.getElementById('dashChallengeResponse');
                    if (dashInput) dashInput.value = lastChallenge.response;
                }
            }
        }

        // ============================================
        // GRATITUDE JOURNAL
        // ============================================
        function saveGratitude() {
            const g1 = document.getElementById('gratitude1');
            const g2 = document.getElementById('gratitude2');
            const g3 = document.getElementById('gratitude3');
            if (!g1 || !g2 || !g3) return;

            const gratitudes = [
                g1.value.trim(),
                g2.value.trim(),
                g3.value.trim()
            ].filter(g => g);

            if (gratitudes.length === 0) {
                showToast('Please write at least one thing you\'re grateful for', 'warning');
                return;
            }

            const today = new Date().toISOString().split('T')[0];

            // Initialize gratitude history if needed
            if (!appData.gratitudeHistory) {
                appData.gratitudeHistory = [];
            }

            // Check if we already have an entry for today
            const todayIndex = appData.gratitudeHistory.findIndex(g => g.date === today);

            const entry = {
                date: today,
                gratitudes: gratitudes,
                timestamp: new Date().toISOString()
            };

            if (todayIndex >= 0) {
                appData.gratitudeHistory[todayIndex] = entry;
            } else {
                appData.gratitudeHistory.push(entry);
            }

            // Calculate streak
            updateGratitudeStreak();

            // Keep only last 90 days
            if (appData.gratitudeHistory.length > 90) {
                appData.gratitudeHistory = appData.gratitudeHistory.slice(-90);
            }

            saveToStorage();

            // Show saved confirmation
            const savedDiv = document.getElementById('gratitudeSaved');
            if (savedDiv) {
                savedDiv.innerHTML = `
                    <div class="gratitude-saved">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="20 6 9 17 4 12"/>
                        </svg>
                        Gratitude saved! Keep the positive momentum going.
                    </div>
                `;
                savedDiv.style.display = 'block';
            }

            showToast('Gratitude saved! You\'re building a powerful habit.');
        }

        function loadTodayGratitude() {
            // Gratitude section removed from dashboard - function kept for compatibility
            const today = new Date().toISOString().split('T')[0];

            if (appData.gratitudeHistory) {
                const todayEntry = appData.gratitudeHistory.find(g => g.date === today);
                if (todayEntry) {
                    todayEntry.gratitudes.forEach((g, i) => {
                        const input = document.getElementById(`gratitude${i + 1}`);
                        if (input) input.value = g;
                    });

                    const savedDiv = document.getElementById('gratitudeSaved');
                    if (savedDiv) {
                        savedDiv.innerHTML = `
                            <div class="gratitude-saved">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="20 6 9 17 4 12"/>
                                </svg>
                                Today's gratitude saved
                            </div>
                        `;
                        savedDiv.style.display = 'block';
                    }
                }
            }

            updateGratitudeStreak();
        }

        function updateGratitudeStreak() {
            const streakEl = document.getElementById('gratitudeStreak');
            if (!appData.gratitudeHistory || appData.gratitudeHistory.length === 0) {
                if (streakEl) streakEl.textContent = '0 day streak';
                return;
            }

            // Sort by date descending
            const sorted = [...appData.gratitudeHistory].sort((a, b) =>
                new Date(b.date) - new Date(a.date)
            );

            let streak = 0;
            let checkDate = new Date();
            checkDate.setHours(0, 0, 0, 0);

            for (const entry of sorted) {
                const entryDate = new Date(entry.date);
                entryDate.setHours(0, 0, 0, 0);

                const diffDays = Math.floor((checkDate - entryDate) / (1000 * 60 * 60 * 24));

                if (diffDays === 0 || diffDays === 1) {
                    streak++;
                    checkDate = entryDate;
                    checkDate.setDate(checkDate.getDate() - 1);
                } else {
                    break;
                }
            }

            const streakText = streak === 1 ? '1 day streak' : `${streak} day streak`;
            if (streakEl) streakEl.textContent = streakText;

            // Store streak in appData
            appData.gratitudeStreak = streak;
        }

        function loadGratitudeHistory() {
            const historyList = document.getElementById('gratitudeHistoryList');
            const countBadge = document.getElementById('gratitudeCount');
            const history = appData.gratitudeHistory || [];

            countBadge.textContent = `${history.length} entries`;

            if (history.length === 0) {
                historyList.innerHTML = `
                    <div style="color: var(--text-muted); text-align: center; padding: 2rem;">
                        Write your daily gratitudes to see your history here
                    </div>
                `;
                return;
            }

            // Show most recent first, limit to 10
            historyList.innerHTML = history.slice().reverse().slice(0, 10).map(entry => {
                const date = new Date(entry.date).toLocaleDateString('en-US', {
                    weekday: 'short',
                    month: 'short',
                    day: 'numeric'
                });
                return `
                    <div class="gratitude-history-item">
                        <div class="gratitude-history-date">${date}</div>
                        <ul class="gratitude-history-list">
                            ${entry.gratitudes.map(g => `<li>${g}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }).join('');
        }

        // ============================================
        // HABITS
        // ============================================
        // Habit rendering with event delegation (no per-item onclick)
        function renderHabits(containerId, showAll = false) {
            const container = document.getElementById(containerId);
            const habits = showAll ? appData.habits : appData.habits.slice(0, 6);

            container.innerHTML = habits.map(habit => `
                <div class="habit-item ${habit.completed ? 'completed' : ''}" data-habit-id="${habit.id}">
                    <div class="habit-checkbox">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                            <polyline points="20 6 9 17 4 12"/>
                        </svg>
                    </div>
                    <div class="habit-info">
                        <div class="habit-name">${habit.name}</div>
                        <div class="habit-meta">${moduleConfig[habit.module]?.name || habit.module}</div>
                    </div>
                    <div class="habit-streak">${habit.streak}d</div>
                </div>
            `).join('');

            updateHabitProgress();
        }

        // Event delegation for habits - single listener on container
        function initHabitDelegation() {
            const container = document.getElementById('dashHabitList');
            if (!container) return;
            container.addEventListener('click', (e) => {
                const item = e.target.closest('.habit-item');
                if (!item) return;
                const id = parseInt(item.dataset.habitId);
                if (isNaN(id)) return;
                toggleHabit(id);
            });
        }

        function toggleHabit(id) {
            const habit = appData.habits.find(h => h.id === id);
            if (habit) {
                habit.completed = !habit.completed;
                if (habit.completed) {
                    habit.streak++;
                    showToast(`${habit.name} completed! Streak: ${habit.streak} days`);
                }
                renderHabits('dashHabitList', true);
                saveToStorage();
            }
        }

        function openAddHabitModal() {
            document.getElementById('newHabitName').value = '';
            document.getElementById('newHabitModule').value = 'productivity';
            openModal('addHabitModal');
        }

        function addNewHabit() {
            const name = document.getElementById('newHabitName').value.trim();
            const module = document.getElementById('newHabitModule').value;

            if (!name) {
                showToast('Please enter a habit name', 'warning');
                return;
            }

            const newId = Math.max(...appData.habits.map(h => h.id), 0) + 1;
            appData.habits.push({
                id: newId,
                name: name,
                module: module,
                streak: 0,
                completed: false
            });

            saveToStorage();
            renderHabits('dashHabitList', true);
            closeModal('addHabitModal');
            showToast(`Added habit: ${name}`);
        }

        function updateHabitProgress() {
            const completed = appData.habits.filter(h => h.completed).length;
            const total = appData.habits.length;
            const percentage = Math.round((completed / total) * 100);

            document.getElementById('dashHabitProgress').textContent = `${completed}/${total}`;
            document.getElementById('statHabits').textContent = `${percentage}%`;

            if (document.getElementById('habitProgressRing')) {
                const circumference = 2 * Math.PI * 50;
                const offset = circumference - (percentage / 100) * circumference;
                document.getElementById('habitProgressRing').style.strokeDashoffset = offset;
                document.getElementById('habitProgressValue').textContent = `${percentage}%`;
            }
        }

        // ============================================
        // MODULES
        // ============================================
        function loadModulesPage() {
            const grid = document.getElementById('moduleGrid');
            grid.innerHTML = Object.entries(moduleConfig).map(([key, config]) => {
                const level = appData.profile.moduleLevels[key] || 5;
                const target = appData.profile.focusModules.includes(key) ? level + 2 : level + 1;
                const percentage = (level / 10) * 100;
                const levelName = getLevelName(key, level);

                return `
                    <div class="module-card" onclick="showModuleDetail('${key}')">
                        <div class="module-header">
                            <div class="module-icon" style="background: ${config.color}20; color: ${config.color};">${config.icon}</div>
                            <div>
                                <div class="module-title">${config.name}</div>
                                <div class="module-level">${appData.profile.focusModules.includes(key) ? ' FOCUS' : ''}</div>
                            </div>
                        </div>
                        <div class="level-indicator">
                            <span class="level-name" style="color: ${config.color};">${levelName}</span>
                        </div>
                        <div class="module-bar">
                            <div class="module-bar-fill" style="width: ${percentage}%; background: ${config.color};"></div>
                        </div>
                        <div class="module-score">
                            <span class="module-score-current" style="color: ${config.color};">${level}/10</span>
                            <span class="module-score-target">Target: ${Math.min(target, 10)}</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function showModuleDetail(moduleKey) {
            const moduleData = getModuleData(moduleKey);
            const level = appData.profile.moduleLevels[moduleKey] || 5;
            const levelDef = getLevelDefinition(moduleKey, level);
            const config = moduleConfig[moduleKey];

            // Create module detail modal content
            let content = `
                <div style="color: var(--text-muted); margin-bottom: 1.5rem;">
                    Your current level in ${config.name}
                </div>
            `;

            // Level info - works with fallback data
            if (levelDef) {
                content += `
                    <div class="card" style="margin-bottom: 1.5rem; border-color: ${config.color};">
                        <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                            <div style="font-family: 'Bebas Neue'; font-size: 3rem; color: ${config.color};">${level}</div>
                            <div>
                                <div style="font-family: 'Bebas Neue'; font-size: 1.25rem; color: var(--text-primary);">${levelDef.name}</div>
                                <div style="font-size: 0.85rem; color: var(--text-secondary);">${levelDef.description}</div>
                            </div>
                        </div>
                        ${levelDef.capabilities ? `
                            <div style="margin-bottom: 1rem;">
                                <div style="font-size: 0.7rem; color: var(--text-muted); letter-spacing: 0.1em; margin-bottom: 0.5rem;">CAPABILITIES</div>
                                ${levelDef.capabilities.map(c => `
                                    <div style="font-size: 0.85rem; padding: 0.5rem 0; border-bottom: 1px solid var(--border-subtle); display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="color: var(--success);"></span> ${c}
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                        ${levelDef.milestone ? `
                            <div style="background: rgba(212, 168, 71, 0.1); border: 1px solid rgba(212, 168, 71, 0.2); border-radius: 8px; padding: 0.75rem 1rem;">
                                <div style="font-size: 0.65rem; color: var(--gold-primary); letter-spacing: 0.1em; margin-bottom: 0.25rem;">MILESTONE TO REACH NEXT LEVEL</div>
                                <div style="font-size: 0.9rem; color: var(--text-secondary);">${levelDef.milestone}</div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            // Progressive exercises (from enhanced data if available)
            if (moduleData?.progressive_exercises) {
                content += `
                    <div style="font-family: 'Bebas Neue'; font-size: 1rem; color: var(--gold-primary); margin-bottom: 0.75rem; letter-spacing: 0.1em;">PROGRESSIVE EXERCISES</div>
                    <div class="difficulty-selector" id="difficultySelector">
                        <button class="difficulty-btn beginner active" onclick="switchDifficulty('${moduleKey}', 'beginner')">Beginner</button>
                        <button class="difficulty-btn intermediate" onclick="switchDifficulty('${moduleKey}', 'intermediate')">Intermediate</button>
                        <button class="difficulty-btn advanced" onclick="switchDifficulty('${moduleKey}', 'advanced')">Advanced</button>
                    </div>
                    <div id="exercisesList">${renderExercises(moduleData.progressive_exercises.beginner)}</div>
                `;
            }

            // Cross-module connections (from enhanced data if available)
            if (moduleData?.cross_module_connections?.length) {
                content += `
                    <div style="font-family: 'Bebas Neue'; font-size: 1rem; color: var(--gold-primary); margin: 1.5rem 0 0.75rem 0; letter-spacing: 0.1em;">CONNECTED MODULES</div>
                    ${moduleData.cross_module_connections.map(conn => {
                        const connConfig = moduleConfig[conn.connected_module] || { color: '#888', icon: '?' };
                        return `
                            <div class="connection-card">
                                <div class="connection-header">
                                    <div class="connection-icon" style="background: ${connConfig.color}20; color: ${connConfig.color};">${connConfig.icon}</div>
                                    <div class="connection-module" style="color: ${connConfig.color};">${connConfig.name || conn.connected_module}</div>
                                </div>
                                <div class="connection-insight">${conn.insight}</div>
                                <div class="connection-exercise">${conn.combined_exercise}</div>
                            </div>
                        `;
                    }).join('')}
                `;
            }


            // Show in a modal (reuse master modal)
            document.getElementById('masterModalName').textContent = config.name.toUpperCase();
            document.getElementById('masterModalBody').innerHTML = content;
            openModal('masterModal');
        }

        function renderExercises(exercises) {
            if (!exercises?.length) return '<div style="color: var(--text-muted);">No exercises available</div>';

            return exercises.map(ex => `
                <div class="exercise-card">
                    <div class="exercise-header">
                        <div class="exercise-title">${ex.title}</div>
                        <div class="exercise-meta">
                            <span class="exercise-difficulty d${ex.difficulty}">Level ${ex.difficulty}</span>
                            <span>${ex.time_minutes} min</span>
                        </div>
                    </div>
                    <div class="exercise-instructions">${ex.instructions}</div>
                    <div class="exercise-success">
                        <div class="exercise-success-label">Success Criteria</div>
                        <div class="exercise-success-text">${ex.success_criteria}</div>
                    </div>
                </div>
            `).join('');
        }

        function switchDifficulty(moduleKey, difficulty) {
            // Update button states
            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.toggle('active', btn.classList.contains(difficulty));
            });

            // Render exercises
            const moduleData = getModuleData(moduleKey);
            if (moduleData?.progressive_exercises?.[difficulty]) {
                document.getElementById('exercisesList').innerHTML = renderExercises(moduleData.progressive_exercises[difficulty]);
            }
        }

        // ============================================
        // STATS
        // ============================================
        function loadStatsPage() {
            document.getElementById('statsStreak').textContent = appData.stats.dayStreak;
            document.getElementById('statsDeepWork').textContent = `${appData.stats.deepWorkHours}h`;
            document.getElementById('statsHabits').textContent = `${appData.stats.habitCompletion}%`;
            document.getElementById('statsAvgScore').textContent = appData.stats.avgScore;

            // Module stats
            const moduleList = document.getElementById('statsModuleList');
            moduleList.innerHTML = Object.entries(moduleConfig).map(([key, config]) => {
                const level = appData.profile.moduleLevels[key] || 5;
                return `
                    <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                        <div style="width: 100px; font-size: 0.8rem; color: var(--text-secondary);">${config.name}</div>
                        <div style="flex-grow: 1; height: 8px; background: var(--bg-deep); border-radius: 4px; overflow: hidden;">
                            <div style="width: ${level * 10}%; height: 100%; background: ${config.color}; border-radius: 4px;"></div>
                        </div>
                        <div style="font-family: 'Bebas Neue'; font-size: 1.25rem; color: ${config.color};">${level}</div>
                    </div>
                `;
            }).join('');

            // Streak stats
            const streakList = document.getElementById('statsStreakList');
            const topStreaks = [...appData.habits].sort((a, b) => b.streak - a.streak).slice(0, 5);
            streakList.innerHTML = topStreaks.map(habit => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem; background: var(--bg-elevated); border-radius: 8px; margin-bottom: 0.5rem;">
                    <span style="font-size: 0.85rem;">${habit.name}</span>
                    <span style="color: var(--warning); font-weight: 600;"> ${habit.streak} days</span>
                </div>
            `).join('');

            // Challenge history
            const historyList = document.getElementById('challengeHistoryList');
            const challengeCount = document.getElementById('challengeCount');
            const history = appData.challengeHistory || [];

            challengeCount.textContent = `${history.length} completed`;

            if (history.length === 0) {
                historyList.innerHTML = `
                    <div style="color: var(--text-muted); text-align: center; padding: 2rem;">
                        Complete challenges to see your history here
                    </div>
                `;
            } else {
                // Show most recent first
                historyList.innerHTML = history.slice().reverse().slice(0, 10).map(item => {
                    const date = new Date(item.completedAt).toLocaleDateString('en-US', {
                        month: 'short', day: 'numeric'
                    });
                    const config = moduleConfig[item.module] || { color: '#888', name: item.module };
                    return `
                        <div class="challenge-history-item">
                            <div class="challenge-history-date">
                                <span style="color: ${config.color}; font-weight: 500;">${config.name}</span>
                                <span style="margin-left: 0.5rem;">${date}</span>
                            </div>
                            <div class="challenge-history-challenge">${item.challenge}</div>
                            ${item.response ? `<div class="challenge-history-response">${item.response.substring(0, 150)}${item.response.length > 150 ? '...' : ''}</div>` : ''}
                        </div>
                    `;
                }).join('');
            }

            // Gratitude history
            loadGratitudeHistory();
        }

        // ============================================
        // MASTERS
        // ============================================
        let currentMasterData = null;
        let currentMasterModule = null;

        function loadMastersPage() {
            const grid = document.getElementById('mastersGrid');
            let allMasters = [];

            Object.entries(mastersData).forEach(([module, masters]) => {
                masters.forEach(master => {
                    // Check for enhanced data
                    const enhanced = findEnhancedMaster(master.name, module);
                    const examplesCount = enhanced?.worked_examples?.length || 0;
                    const scriptsCount = enhanced?.scripts_templates?.length || 0;
                    const hasResources = enhanced?.resources && (enhanced.resources.books?.length || enhanced.resources.podcasts?.length);

                    allMasters.push({ ...master, module, examplesCount, scriptsCount, hasResources });
                });
            });

            grid.innerHTML = allMasters.map(master => `
                <div class="master-card" onclick="showMasterDetail('${master.name.replace(/'/g, "\\'")}', '${master.module}')">
                    <div class="master-card-name">${master.name}</div>
                    <div class="master-card-expertise">${master.expertise}</div>
                    <div class="master-card-badges">
                        ${master.examplesCount > 0 ? `<span class="master-card-badge examples">${master.examplesCount} examples</span>` : ''}
                        ${master.scriptsCount > 0 ? `<span class="master-card-badge scripts">${master.scriptsCount} scripts</span>` : ''}
                        ${master.hasResources ? `<span class="master-card-badge resources">resources</span>` : ''}
                    </div>
                    <div class="master-card-principle">"${master.principles[0]}"</div>
                </div>
            `).join('');
        }

        function showMasterDetail(name, module) {
            const masters = mastersData[module];
            const master = masters.find(m => m.name === name);
            const enhanced = findEnhancedMaster(name, module);

            if (!master) return;

            currentMasterData = { basic: master, enhanced };
            currentMasterModule = module;

            document.getElementById('masterModalName').textContent = master.name.toUpperCase();

            // Determine which tabs to show
            const hasExamples = enhanced?.worked_examples?.length > 0;
            const hasScripts = enhanced?.scripts_templates?.length > 0;
            const hasResources = enhanced?.resources && (enhanced.resources.books?.length || enhanced.resources.podcasts?.length);

            // Build tabs HTML
            const tabsHtml = `
                <div class="master-tabs" id="masterTabs">
                    <div class="master-tab active" data-tab="principles" onclick="switchMasterTab('principles')">Principles</div>
                    ${hasExamples ? '<div class="master-tab" data-tab="examples" onclick="switchMasterTab(\'examples\')">Examples</div>' : ''}
                    ${hasScripts ? '<div class="master-tab" data-tab="scripts" onclick="switchMasterTab(\'scripts\')">Scripts</div>' : ''}
                    ${hasResources ? '<div class="master-tab" data-tab="resources" onclick="switchMasterTab(\'resources\')">Resources</div>' : ''}
                </div>
                <div id="masterTabContent"></div>
            `;

            document.getElementById('masterModalBody').innerHTML = tabsHtml;
            switchMasterTab('principles');

            openModal('masterModal');
        }

        function switchMasterTab(tabName) {
            // Update tab active states
            document.querySelectorAll('.master-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.tab === tabName);
            });

            const content = document.getElementById('masterTabContent');
            const { basic, enhanced } = currentMasterData;

            switch(tabName) {
                case 'principles':
                    content.innerHTML = renderPrinciplesTab(basic, enhanced);
                    break;
                case 'examples':
                    content.innerHTML = renderExamplesTab(enhanced);
                    break;
                case 'scripts':
                    content.innerHTML = renderScriptsTab(enhanced);
                    break;
                case 'resources':
                    content.innerHTML = renderResourcesTab(enhanced);
                    break;
            }
        }

        function renderPrinciplesTab(basic, enhanced) {
            const principles = enhanced?.key_principles || basic.principles;
            const practices = enhanced?.daily_practices || basic.practices;

            return `
                <div style="color: var(--text-muted); margin-bottom: 1.5rem;">${basic.expertise}</div>

                <div style="margin-bottom: 1.5rem;">
                    <div style="font-family: 'Bebas Neue'; font-size: 1rem; color: var(--gold-primary); margin-bottom: 0.75rem; letter-spacing: 0.1em;">KEY PRINCIPLES</div>
                    ${principles.map((p, i) => `
                        <div style="font-family: 'Crimson Pro', serif; font-size: 1.1rem; font-style: italic; padding: 1rem; background: var(--bg-elevated); border-radius: 8px; margin-bottom: 0.5rem; border-left: 3px solid var(--gold-primary);">
                            "${p}"
                        </div>
                    `).join('')}
                </div>

                <div>
                    <div style="font-family: 'Bebas Neue'; font-size: 1rem; color: var(--gold-primary); margin-bottom: 0.75rem; letter-spacing: 0.1em;">DAILY PRACTICES</div>
                    ${practices.map(p => `
                        <div style="padding: 0.75rem 1rem; background: var(--bg-elevated); border-radius: 8px; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
                            <span style="color: var(--success);"></span>
                            ${p}
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderExamplesTab(enhanced) {
            if (!enhanced?.worked_examples?.length) {
                return '<div style="color: var(--text-muted); text-align: center; padding: 2rem;">No worked examples available</div>';
            }

            return enhanced.worked_examples.map(example => `
                <div class="example-card">
                    <div class="example-title">${example.title}</div>
                    <div class="example-scenario">${example.scenario}</div>
                    <div class="example-framework">Framework: ${example.framework_applied}</div>
                    <ol class="example-steps">
                        ${example.step_by_step.map(step => `<li>${step}</li>`).join('')}
                    </ol>
                    <div class="example-outcome">
                        <div class="example-outcome-label">Outcome</div>
                        ${example.outcome}
                    </div>
                </div>
            `).join('');
        }

        function renderScriptsTab(enhanced) {
            if (!enhanced?.scripts_templates?.length) {
                return '<div style="color: var(--text-muted); text-align: center; padding: 2rem;">No scripts or templates available</div>';
            }

            return enhanced.scripts_templates.map((script, idx) => `
                <div class="template-card">
                    <div class="template-header">
                        <div class="template-title">${script.title}</div>
                        <button class="copy-btn" onclick="copyTemplate(${idx})">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            Copy
                        </button>
                    </div>
                    <div class="template-context">${script.context}</div>
                    <div class="template-content" id="template-${idx}">${formatTemplateContent(script.template)}</div>
                    ${script.example_filled ? `
                        <div class="template-example">
                            <div class="template-example-label">Example</div>
                            <div class="template-example-text">${script.example_filled}</div>
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function renderResourcesTab(enhanced) {
            if (!enhanced?.resources) {
                return '<div style="color: var(--text-muted); text-align: center; padding: 2rem;">No resources available</div>';
            }

            let html = '';

            if (enhanced.resources.books?.length) {
                html += `<div style="font-family: 'Bebas Neue'; font-size: 1rem; color: var(--gold-primary); margin-bottom: 0.75rem; letter-spacing: 0.1em;">BOOKS</div>`;
                html += enhanced.resources.books.map(book => `
                    <div class="resource-card">
                        <div class="resource-icon"></div>
                        <div class="resource-info">
                            <div class="resource-title">${book.title}</div>
                            <div class="resource-author">by ${book.author}</div>
                            ${book.key_takeaway ? `<div class="resource-takeaway">"${book.key_takeaway}"</div>` : ''}
                        </div>
                    </div>
                `).join('');
            }

            if (enhanced.resources.podcasts?.length) {
                html += `<div style="font-family: 'Bebas Neue'; font-size: 1rem; color: var(--gold-primary); margin: 1.5rem 0 0.75rem 0; letter-spacing: 0.1em;">PODCASTS</div>`;
                html += enhanced.resources.podcasts.map(pod => `
                    <div class="resource-card">
                        <div class="resource-icon"></div>
                        <div class="resource-info">
                            <div class="resource-title">${pod.title}</div>
                            ${pod.episode ? `<div class="resource-author">${pod.episode}</div>` : ''}
                            ${pod.key_takeaway ? `<div class="resource-takeaway">"${pod.key_takeaway}"</div>` : ''}
                        </div>
                    </div>
                `).join('');
            }

            return html || '<div style="color: var(--text-muted); text-align: center; padding: 2rem;">No resources available</div>';
        }

        function formatTemplateContent(template) {
            // Replace blanks like ___ or [blank] with styled spans
            return template
                .replace(/___+/g, '<span class="blank">___________</span>')
                .replace(/\[([^\]]+)\]/g, '<span class="blank">[$1]</span>');
        }

        function copyTemplate(idx) {
            const enhanced = currentMasterData.enhanced;
            if (!enhanced?.scripts_templates?.[idx]) return;

            const template = enhanced.scripts_templates[idx].template;
            navigator.clipboard.writeText(template).then(() => {
                const btn = event.target.closest('.copy-btn');
                btn.classList.add('copied');
                btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="20 6 9 17 4 12"></polyline></svg> Copied!`;
                setTimeout(() => {
                    btn.classList.remove('copied');
                    btn.innerHTML = `<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg> Copy`;
                }, 2000);
            });
        }

        // ============================================
        // SETTINGS
        // ============================================
        function loadSettingsPage() {
            document.getElementById('settingsName').value = appData.profile.name;
            document.getElementById('settingsTime').value = appData.profile.dailyTime;
            document.getElementById('settingsStyle').value = appData.profile.coachingStyle;

            // Focus modules
            const focusList = document.getElementById('focusModulesList');
            focusList.innerHTML = Object.entries(moduleConfig).map(([key, config]) => `
                <label style="display: flex; align-items: center; gap: 0.75rem; padding: 0.75rem; cursor: pointer;">
                    <input type="checkbox" id="focus_${key}" ${appData.profile.focusModules.includes(key) ? 'checked' : ''} style="width: 18px; height: 18px;">
                    <span>${config.name}</span>
                </label>
            `).join('');

            // Module levels
            const levelsGrid = document.getElementById('moduleLevelsGrid');
            levelsGrid.innerHTML = Object.entries(moduleConfig).map(([key, config]) => `
                <div class="form-group">
                    <label class="form-label">${config.name}</label>
                    <input type="number" class="form-input" id="level_${key}" value="${appData.profile.moduleLevels[key] || 5}" min="1" max="10">
                </div>
            `).join('');
        }

        function saveSettings() {
            appData.profile.name = document.getElementById('settingsName').value;
            appData.profile.dailyTime = parseInt(document.getElementById('settingsTime').value);
            appData.profile.coachingStyle = document.getElementById('settingsStyle').value;
            saveToStorage();
            showToast('Settings saved!');
        }

        function saveFocusModules() {
            appData.profile.focusModules = Object.keys(moduleConfig).filter(key =>
                document.getElementById(`focus_${key}`)?.checked
            );
            saveToStorage();
            showToast('Focus modules updated!');
        }

        function saveModuleLevels() {
            Object.keys(moduleConfig).forEach(key => {
                const input = document.getElementById(`level_${key}`);
                if (input) {
                    appData.profile.moduleLevels[key] = parseInt(input.value) || 5;
                }
            });
            saveToStorage();
            showToast('Module levels updated!');
            loadModulesPage();
        }

        // ============================================
        // MORNING CHECK-IN
        // ============================================
        let amStep = 1;

        function openMorningCheckin() {
            amStep = 1;
            updateAmSteps();
            openModal('morningModal');
        }

        function updateAmSteps() {
            for (let i = 1; i <= 3; i++) {
                document.getElementById(`amStep${i}`).className = `step-dot ${i < amStep ? 'completed' : ''} ${i === amStep ? 'active' : ''}`;
                document.getElementById(`amCheckinStep${i}`).className = `checkin-step ${i === amStep ? 'active' : ''}`;
            }
            document.getElementById('amPrevBtn').style.display = amStep > 1 ? 'inline-flex' : 'none';
            document.getElementById('amNextBtn').textContent = amStep === 3 ? 'Complete' : 'Next';
        }

        function nextAmStep() {
            if (amStep < 3) {
                amStep++;
                updateAmSteps();
            } else {
                saveMorningCheckin();
            }
        }

        function prevAmStep() {
            if (amStep > 1) {
                amStep--;
                updateAmSteps();
            }
        }

        function saveMorningCheckin() {
            appData.todayLog.amCheckin = {
                sleepHours: parseFloat(document.getElementById('amSleepHours').value),
                sleepQuality: parseInt(document.getElementById('amSleepQuality').value),
                energy: parseInt(document.getElementById('amEnergy').value),
                priorities: [
                    document.getElementById('amPriority1').value,
                    document.getElementById('amPriority2').value,
                    document.getElementById('amPriority3').value
                ].filter(p => p),
                winDefinition: document.getElementById('amWinDefinition').value,
                notes: document.getElementById('amNotes').value,
                timestamp: new Date().toISOString()
            };

            saveToStorageNow();
            loadTodaysPlan();
            closeModal('morningModal');
            showToast('Morning check-in complete! Let\'s crush it today.');
        }

        // Range input listeners
        document.getElementById('amSleepHours')?.addEventListener('input', (e) => {
            document.getElementById('amSleepValue').textContent = `${e.target.value} hours`;
        });
        document.getElementById('amSleepQuality')?.addEventListener('input', (e) => {
            document.getElementById('amSleepQualityValue').textContent = e.target.value;
        });
        document.getElementById('amEnergy')?.addEventListener('input', (e) => {
            document.getElementById('amEnergyValue').textContent = e.target.value;
        });

        // ============================================
        // EVENING REFLECTION
        // ============================================
        let pmStep = 1;

        function openEveningReflection() {
            pmStep = 1;
            updatePmSteps();
            openModal('eveningModal');
        }

        function updatePmSteps() {
            for (let i = 1; i <= 4; i++) {
                document.getElementById(`pmStep${i}`).className = `step-dot ${i < pmStep ? 'completed' : ''} ${i === pmStep ? 'active' : ''}`;
                document.getElementById(`pmCheckinStep${i}`).className = `checkin-step ${i === pmStep ? 'active' : ''}`;
            }
            document.getElementById('pmPrevBtn').style.display = pmStep > 1 ? 'inline-flex' : 'none';
            document.getElementById('pmNextBtn').textContent = pmStep === 4 ? 'Complete' : 'Next';
        }

        function nextPmStep() {
            if (pmStep < 4) {
                pmStep++;
                updatePmSteps();
            } else {
                saveEveningReflection();
            }
        }

        function prevPmStep() {
            if (pmStep > 1) {
                pmStep--;
                updatePmSteps();
            }
        }

        function saveEveningReflection() {
            const getListValues = (containerId) => {
                return Array.from(document.querySelectorAll(`#${containerId} input`))
                    .map(input => input.value)
                    .filter(v => v);
            };

            appData.todayLog.pmReflection = {
                wins: getListValues('pmWinsList'),
                challenges: getListValues('pmChallengesList'),
                lessons: getListValues('pmLessonsList'),
                deepWork: parseFloat(document.getElementById('pmDeepWork').value),
                salesCalls: parseInt(document.getElementById('pmSalesCalls').value),
                improvement: document.getElementById('pmImprovement').value,
                dayScore: parseInt(document.getElementById('pmDayScore').value),
                notes: document.getElementById('pmNotes').value,
                timestamp: new Date().toISOString()
            };

            // Update stats
            appData.stats.dayStreak++;
            appData.stats.avgScore = ((appData.stats.avgScore * (appData.stats.dayStreak - 1)) + appData.todayLog.pmReflection.dayScore) / appData.stats.dayStreak;

            saveToStorageNow();
            closeModal('eveningModal');
            showToast(`Day complete! Score: ${appData.todayLog.pmReflection.dayScore}/10`);
            updateDashboardStats();
        }

        function addReflectionItem(containerId) {
            const container = document.getElementById(containerId);
            const div = document.createElement('div');
            div.className = 'reflection-item';
            div.innerHTML = `<input type="text" class="form-input" placeholder="Add another...">`;
            container.appendChild(div);
        }

        document.getElementById('pmDayScore')?.addEventListener('input', (e) => {
            document.getElementById('pmDayScoreValue').textContent = e.target.value;
        });

        // ============================================
        // WEEKLY REVIEW
        // ============================================
        function openWeeklyReview() {
            showToast('Weekly review feature coming soon!', 'warning');
        }

        // ============================================
        // DASHBOARD STATS
        // ============================================
        function updateDashboardStats() {
            document.getElementById('statStreak').textContent = appData.stats.dayStreak;
            document.getElementById('statDeepWork').textContent = `${appData.todayLog.pmReflection?.deepWork || 0}h`;
            document.getElementById('statAvgScore').textContent = appData.stats.avgScore.toFixed(1);
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        // ============================================
        // COLLAPSIBLE SECTIONS
        // ============================================
        function toggleCollapsible(sectionId) {
            const content = document.getElementById(sectionId);
            const arrow = document.getElementById(sectionId + 'Arrow');

            if (content.style.display === 'none') {
                content.style.display = 'block';
                arrow?.classList.add('rotated');
            } else {
                content.style.display = 'none';
                arrow?.classList.remove('rotated');
            }
        }

        // ============================================
        // QUICK JOURNAL
        // ============================================
        let quickJournalAutosaveTimer = null;

        function initQuickJournal() {
            const input = document.getElementById('quickJournalInput');
            if (!input) return;

            // Load today's quick journal
            const today = new Date().toISOString().split('T')[0];
            if (appData.quickJournalToday && appData.quickJournalDate === today) {
                input.value = appData.quickJournalToday;
            }

            // Set up autosave
            input.addEventListener('input', () => {
                const status = document.getElementById('quickJournalStatus');
                status.textContent = 'Saving...';
                status.classList.add('saving');
                status.classList.remove('saved');

                clearTimeout(quickJournalAutosaveTimer);
                quickJournalAutosaveTimer = setTimeout(() => {
                    saveQuickJournal();
                }, 2000);
            });

            updateQuickJournalTimestamp();
        }

        function saveQuickJournal() {
            const input = document.getElementById('quickJournalInput');
            const status = document.getElementById('quickJournalStatus');
            const today = new Date().toISOString().split('T')[0];

            appData.quickJournalToday = input.value;
            appData.quickJournalDate = today;
            appData.quickJournalLastSaved = new Date().toISOString();
            saveToStorage();

            status.textContent = 'Saved';
            status.classList.remove('saving');
            status.classList.add('saved');
            updateQuickJournalTimestamp();
        }

        function updateQuickJournalTimestamp() {
            const timestamp = document.getElementById('quickJournalTimestamp');
            if (appData.quickJournalLastSaved) {
                const saved = new Date(appData.quickJournalLastSaved);
                timestamp.textContent = `Last saved: ${saved.toLocaleTimeString()}`;
            }
        }

        // ============================================
        // TODAY'S PLAN
        // ============================================
        function loadTodaysPlan() {
            const prioritiesContainer = document.getElementById('todaysPriorities');
            const winContainer = document.getElementById('todaysWin');
            const winText = document.getElementById('todaysWinText');

            if (appData.todayLog?.amCheckin) {
                const checkin = appData.todayLog.amCheckin;
                const priorities = checkin.priorities || [];

                if (priorities.length > 0) {
                    prioritiesContainer.innerHTML = priorities.map((p, i) => `
                        <div class="priority-item">
                            <span class="priority-number">${i + 1}</span>
                            <span class="priority-text">${p}</span>
                        </div>
                    `).join('');
                }

                if (checkin.winDefinition) {
                    winText.textContent = checkin.winDefinition;
                    winContainer.style.display = 'block';
                }
            }
        }

        // ============================================
        // PLANNING SYSTEM - Vision, OKRs, Weekly Plans
        // ============================================
        let planningData = {
            vision: null,
            okrs: null,
            weeklyPlan: null
        };

        async function loadPlanningData() {
            try {
                // Try to load from server first
                const [visionRes, okrsRes, weeklyRes] = await Promise.all([
                    fetch('/data/vision.json').catch(() => null),
                    fetch('/data/quarterly_okrs.json').catch(() => null),
                    fetch('/data/weekly_plans.json').catch(() => null)
                ]);

                if (visionRes?.ok) planningData.vision = await visionRes.json();
                if (okrsRes?.ok) planningData.okrs = await okrsRes.json();
                if (weeklyRes?.ok) planningData.weeklyPlan = await weeklyRes.json();

                // Fall back to localStorage
                if (!planningData.vision) {
                    const saved = localStorage.getItem('selfMasteryVision');
                    if (saved) planningData.vision = JSON.parse(saved);
                }
                if (!planningData.okrs) {
                    const saved = localStorage.getItem('selfMasteryOKRs');
                    if (saved) planningData.okrs = JSON.parse(saved);
                }
                if (!planningData.weeklyPlan) {
                    const saved = localStorage.getItem('selfMasteryWeeklyPlan');
                    if (saved) planningData.weeklyPlan = JSON.parse(saved);
                }

                // Use defaults if nothing loaded
                if (!planningData.vision) planningData.vision = getDefaultVision();
                if (!planningData.okrs) planningData.okrs = getDefaultOKRs();
                if (!planningData.weeklyPlan) planningData.weeklyPlan = getDefaultWeeklyPlan();

            } catch (e) {
                console.log('Loading planning data from defaults');
                planningData.vision = getDefaultVision();
                planningData.okrs = getDefaultOKRs();
                planningData.weeklyPlan = getDefaultWeeklyPlan();
            }

            renderCommandCenter();
        }

        function getDefaultVision() {
            return {
                ten_year_vision: {
                    identity_statement: "A self-made millionaire with multiple businesses, deep relationships, and complete lifestyle freedom."
                },
                five_year_mission: {
                    primary_objective: "Build a portfolio of 3 businesses generating $500k+ combined annual revenue"
                },
                annual_themes: {
                    "2026": { theme: "Year of Foundation" }
                }
            };
        }

        function getDefaultOKRs() {
            return {
                current_quarter: "2026-Q1",
                quarters: {
                    "2026-Q1": {
                        theme: "Build Foundation",
                        objectives: []
                    }
                }
            };
        }

        function getDefaultWeeklyPlan() {
            const weekNum = getISOWeek(new Date());
            return {
                current_week: `2026-W${String(weekNum).padStart(2, '0')}`,
                weeks: {}
            };
        }

        function getISOWeek(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        function renderCommandCenter() {
            const vision = planningData.vision;
            const okrs = planningData.okrs;
            const weekly = planningData.weeklyPlan;

            // Vision statement
            const visionEl = document.getElementById('visionStatement');
            if (visionEl && vision?.ten_year_vision?.identity_statement) {
                visionEl.textContent = vision.ten_year_vision.identity_statement;
            }

            // Current week badge
            const weekBadge = document.getElementById('currentWeekBadge');
            if (weekBadge && weekly?.current_week) {
                const weekNum = weekly.current_week.split('-W')[1];
                weekBadge.textContent = `Week ${parseInt(weekNum)}`;
            }

            // OKR Grid
            renderOKRGrid();

            // Battle Plan
            renderBattlePlan();

            // Deep Work Progress
            renderDeepWorkProgress();
        }

        function renderOKRGrid() {
            const okrs = planningData.okrs;
            const grid = document.getElementById('okrGrid');
            if (!grid || !okrs?.quarters) return;

            const quarter = okrs.quarters[okrs.current_quarter];
            if (!quarter?.objectives?.length) {
                grid.innerHTML = '<div style="grid-column: 1/-1; padding: 2rem; text-align: center; color: var(--text-muted);">Set your quarterly objectives in the Plans page</div>';
                return;
            }

            grid.innerHTML = quarter.objectives.map(obj => {
                const avgProgress = calculateOKRProgress(obj);
                const colorClass = avgProgress >= 70 ? 'green' : avgProgress >= 40 ? 'yellow' : 'red';
                return `
                    <div class="okr-card" onclick="openOKRDetail('${obj.id}')">
                        <span class="okr-module-badge okr-module-${obj.module}">${obj.module.toUpperCase()}</span>
                        <div class="okr-objective">${obj.objective}</div>
                        <div class="okr-progress-bar">
                            <div class="okr-progress-fill ${colorClass}" style="width: ${avgProgress}%;"></div>
                        </div>
                        <div class="okr-progress-text">
                            <span>${avgProgress}%</span>
                            <span>${obj.key_results?.length || 0} KRs</span>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function calculateOKRProgress(objective) {
            if (!objective.key_results?.length) return 0;
            const total = objective.key_results.reduce((sum, kr) => {
                const progress = kr.target > 0 ? Math.min(100, (kr.current / kr.target) * 100) : 0;
                return sum + progress;
            }, 0);
            return Math.round(total / objective.key_results.length);
        }

        function renderBattlePlan() {
            const weekly = planningData.weeklyPlan;
            const container = document.getElementById('battlePlanItems');
            const stats = document.getElementById('battlePlanStats');
            if (!container) return;

            const week = weekly?.weeks?.[weekly?.current_week];
            if (!week?.battle_plan?.length) {
                container.innerHTML = '<div style="padding: 1rem; text-align: center; color: var(--text-muted);">No battle plan set for this week</div>';
                if (stats) stats.textContent = '0/0 complete';
                return;
            }

            const completed = week.battle_plan.filter(item => item.completed).length;
            if (stats) stats.textContent = `${completed}/${week.battle_plan.length} complete`;

            container.innerHTML = week.battle_plan.map(item => {
                const statusClass = item.completed ? 'completed' : item.status === 'in_progress' ? 'in-progress' : '';
                return `
                    <div class="battle-plan-item ${statusClass}" onclick="toggleBattlePlanItem('${item.id}')">
                        <div class="battle-plan-priority">${item.priority}</div>
                        <div class="battle-plan-content">
                            <div class="battle-plan-outcome">${item.outcome}</div>
                            <div class="battle-plan-module">${item.module.toUpperCase()}</div>
                        </div>
                        <div class="battle-plan-hours">${item.estimated_hours}h</div>
                    </div>
                `;
            }).join('');
        }

        function renderDeepWorkProgress() {
            const weekly = planningData.weeklyPlan;
            const week = weekly?.weeks?.[weekly?.current_week];

            const target = week?.deep_work_target || 20;
            const actual = week?.deep_work_actual || 0;
            const percentage = Math.min(100, (actual / target) * 100);

            const fill = document.getElementById('deepWorkFill');
            const count = document.getElementById('deepWorkCount');

            if (fill) fill.style.width = `${percentage}%`;
            if (count) count.textContent = `${actual}/${target} hrs`;
        }

        function toggleBattlePlanItem(itemId) {
            const weekly = planningData.weeklyPlan;
            const week = weekly?.weeks?.[weekly?.current_week];
            if (!week?.battle_plan) return;

            const item = week.battle_plan.find(i => i.id === itemId);
            if (item) {
                item.completed = !item.completed;
                item.status = item.completed ? 'completed' : 'pending';
                savePlanningData();
                renderBattlePlan();
            }
        }

        function savePlanningData() {
            localStorage.setItem('selfMasteryVision', JSON.stringify(planningData.vision));
            localStorage.setItem('selfMasteryOKRs', JSON.stringify(planningData.okrs));
            localStorage.setItem('selfMasteryWeeklyPlan', JSON.stringify(planningData.weeklyPlan));
        }

        function openOKRDetail(okrId) {
            const okrs = planningData.okrs;
            const quarter = okrs?.quarters?.[okrs?.current_quarter];
            const objective = quarter?.objectives?.find(o => o.id === okrId);
            if (!objective) return;

            const modalContent = `
                <div class="okr-detail-header">
                    <span class="okr-module-badge okr-module-${objective.module}">${objective.module.toUpperCase()}</span>
                    <div class="okr-detail-objective">${objective.objective}</div>
                    <div class="okr-detail-why">${objective.why || ''}</div>
                </div>
                <div class="key-results-list">
                    ${objective.key_results?.map(kr => {
                        const progress = kr.target > 0 ? Math.min(100, (kr.current / kr.target) * 100) : 0;
                        const colorClass = progress >= 70 ? 'green' : progress >= 40 ? 'yellow' : 'red';
                        return `
                            <div class="key-result-item">
                                <div class="key-result-desc">${kr.description}</div>
                                <div class="key-result-progress">
                                    <div class="key-result-bar">
                                        <div class="key-result-fill okr-progress-fill ${colorClass}" style="width: ${progress}%;"></div>
                                    </div>
                                    <div class="key-result-values">${kr.current} / ${kr.target} ${kr.unit || ''}</div>
                                </div>
                            </div>
                        `;
                    }).join('') || '<div style="color: var(--text-muted);">No key results defined</div>'}
                </div>
            `;

            openModal('Objective Details', modalContent);
        }

        function loadPlansPage() {
            renderPlansPageFull();
        }

        function renderPlansPageFull() {
            const vision = planningData.vision;
            const okrs = planningData.okrs;
            const weekly = planningData.weeklyPlan;

            // Vision and Mission
            const visionFull = document.getElementById('plansVisionFull');
            const missionFull = document.getElementById('plansMissionFull');
            if (visionFull && vision?.ten_year_vision?.identity_statement) {
                visionFull.textContent = vision.ten_year_vision.identity_statement;
            }
            if (missionFull && vision?.five_year_mission?.primary_objective) {
                missionFull.textContent = vision.five_year_mission.primary_objective;
            }

            // Quarter label and theme
            const quarterLabel = document.getElementById('plansQuarterLabel');
            const quarterTheme = document.getElementById('plansQuarterTheme');
            if (okrs?.current_quarter) {
                const q = okrs.current_quarter.split('-')[1];
                if (quarterLabel) quarterLabel.textContent = q;
                const quarter = okrs.quarters?.[okrs.current_quarter];
                if (quarterTheme && quarter?.theme) quarterTheme.textContent = quarter.theme;
            }

            // Full OKR grid
            renderPlansOKRGrid();

            // Weekly items
            renderPlansWeeklyItems();
        }

        function renderPlansOKRGrid() {
            const okrs = planningData.okrs;
            const grid = document.getElementById('plansOkrGrid');
            if (!grid || !okrs?.quarters) return;

            const quarter = okrs.quarters[okrs.current_quarter];
            if (!quarter?.objectives?.length) {
                grid.innerHTML = '<div class="card" style="grid-column: 1/-1; padding: 2rem; text-align: center; color: var(--text-muted);">No objectives set. Define your quarterly OKRs to get started.</div>';
                return;
            }

            grid.innerHTML = quarter.objectives.map(obj => {
                const avgProgress = calculateOKRProgress(obj);
                const colorClass = avgProgress >= 70 ? 'green' : avgProgress >= 40 ? 'yellow' : 'red';
                return `
                    <div class="card" style="cursor: pointer;" onclick="openOKRDetail('${obj.id}')">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                            <span class="okr-module-badge okr-module-${obj.module}">${obj.module.toUpperCase()}</span>
                            <span style="font-size: 1.5rem; font-weight: 600; color: ${colorClass === 'green' ? 'var(--success)' : colorClass === 'yellow' ? 'var(--warning)' : 'var(--danger)'};">${avgProgress}%</span>
                        </div>
                        <div style="font-size: 1rem; color: var(--text-primary); font-weight: 500; margin-bottom: 0.75rem; line-height: 1.3;">${obj.objective}</div>
                        <div style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 1rem;">${obj.why || ''}</div>
                        ${obj.key_results?.map(kr => {
                            const krProgress = kr.target > 0 ? Math.min(100, (kr.current / kr.target) * 100) : 0;
                            return `
                                <div style="margin-bottom: 0.5rem;">
                                    <div style="display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-secondary); margin-bottom: 0.25rem;">
                                        <span>${kr.description.substring(0, 30)}${kr.description.length > 30 ? '...' : ''}</span>
                                        <span>${kr.current}/${kr.target}</span>
                                    </div>
                                    <div class="okr-progress-bar">
                                        <div class="okr-progress-fill ${krProgress >= 70 ? 'green' : krProgress >= 40 ? 'yellow' : 'red'}" style="width: ${krProgress}%;"></div>
                                    </div>
                                </div>
                            `;
                        }).join('') || ''}
                    </div>
                `;
            }).join('');
        }

        function renderPlansWeeklyItems() {
            const weekly = planningData.weeklyPlan;
            const container = document.getElementById('plansWeeklyItems');
            const weekLabel = document.getElementById('plansWeekLabel');
            const weekTheme = document.getElementById('plansWeekTheme');
            const deepWorkTarget = document.getElementById('plansDeepWorkTarget');
            const totalHours = document.getElementById('plansTotalHours');

            if (!container) return;

            const week = weekly?.weeks?.[weekly?.current_week];

            if (weekLabel && weekly?.current_week) {
                const weekNum = weekly.current_week.split('-W')[1];
                weekLabel.textContent = `Week ${parseInt(weekNum)}`;
            }
            if (weekTheme && week?.week_theme) {
                weekTheme.textContent = week.week_theme;
            }
            if (deepWorkTarget) {
                deepWorkTarget.textContent = `${week?.deep_work_target || 20}h`;
            }

            if (!week?.battle_plan?.length) {
                container.innerHTML = '<div style="padding: 2rem; text-align: center; color: var(--text-muted);">No battle plan items for this week</div>';
                if (totalHours) totalHours.textContent = '0h';
                return;
            }

            const estTotal = week.battle_plan.reduce((sum, item) => sum + (item.estimated_hours || 0), 0);
            if (totalHours) totalHours.textContent = `${estTotal}h`;

            container.innerHTML = week.battle_plan.map(item => {
                const statusClass = item.completed ? 'completed' : item.status === 'in_progress' ? 'in-progress' : '';
                return `
                    <div class="battle-plan-item ${statusClass}" style="margin-bottom: 0.75rem;" onclick="toggleBattlePlanItem('${item.id}')">
                        <div class="battle-plan-priority">${item.priority}</div>
                        <div class="battle-plan-content" style="flex: 1;">
                            <div class="battle-plan-outcome" style="white-space: normal;">${item.outcome}</div>
                            <div class="battle-plan-module">${item.module.toUpperCase()}  ${item.estimated_hours}h estimated</div>
                            ${item.tasks?.length ? `
                                <div style="margin-top: 0.5rem; padding-left: 0.5rem; border-left: 2px solid var(--border-accent);">
                                    ${item.tasks.map(task => `<div style="font-size: 0.75rem; color: var(--text-muted); margin: 0.25rem 0;"> ${task}</div>`).join('')}
                                </div>
                            ` : ''}
                        </div>
                        <div style="text-align: right;">
                            <div style="font-size: 0.7rem; color: ${item.completed ? 'var(--success)' : item.status === 'in_progress' ? 'var(--warning)' : 'var(--text-muted)'};">
                                ${item.completed ? ' DONE' : item.status === 'in_progress' ? ' IN PROGRESS' : ' PENDING'}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function openWeeklyReview() {
            showToast('Weekly review modal coming soon!');
        }

        // Systems functions
        function loadSystemsPage() {
            renderSystems();
        }

        function renderSystems() {
            const list = document.getElementById('systemsList');
            const performance = document.getElementById('systemsPerformance');

            if (!appData.systems || appData.systems.length === 0) {
                list.innerHTML = '<div style="color: var(--text-muted); text-align: center; padding: 2rem;">No systems yet. Build your first repeatable system!</div>';
                performance.innerHTML = '<div style="color: var(--text-muted); text-align: center; padding: 2rem;">Track your systems to see performance metrics</div>';
                return;
            }

            list.innerHTML = appData.systems.map(s => renderSystemCard(s)).join('');

            const avgSuccess = appData.systems.reduce((acc, s) => acc + (s.successRate || 0), 0) / appData.systems.length;
            performance.innerHTML = `
                <div class="system-stat">
                    <div class="system-stat-value">${appData.systems.length}</div>
                    <div class="system-stat-label">Total Systems</div>
                </div>
                <div class="system-stat">
                    <div class="system-stat-value">${Math.round(avgSuccess)}%</div>
                    <div class="system-stat-label">Avg Success Rate</div>
                </div>
            `;
        }

        function renderSystemCard(system) {
            return `
                <div class="system-card" onclick="openSystemDetail('${system.id}')">
                    <div class="system-name">${system.name}</div>
                    <div class="system-meta">${system.steps?.length || 0} steps</div>
                    <div class="system-success-rate">${system.successRate || 0}% success</div>
                </div>
            `;
        }

        function openCreateSystemModal() {
            showToast('System builder coming soon!');
        }

        function openSystemDetail(systemId) {
            showToast('System details coming soon!');
        }

        // ============================================
        // 10 POWER WORDS
        // ============================================
        function generatePowerWords() {
            const focusModules = appData.profile.focusModules;
            const words = [];
            const usedTerms = new Set();

            // Get 10 unique vocabulary words from focus modules
            while (words.length < 10) {
                const module = getRandomItem(focusModules.filter(m => dailyVocabulary[m])) || 'mindset';
                const vocabList = dailyVocabulary[module] || dailyVocabulary.mindset;
                const word = getRandomItem(vocabList);

                if (!usedTerms.has(word.term)) {
                    usedTerms.add(word.term);
                    words.push({ ...word, module });
                }

                // Prevent infinite loop if not enough words
                if (words.length + usedTerms.size > 50) break;
            }

            return words;
        }

        function renderPowerWords(words) {
            const accordion = document.getElementById('powerWordsAccordion');
            if (!accordion) return;

            accordion.innerHTML = words.map((word, i) => `
                <div class="power-word-item">
                    <div class="power-word-header" onclick="togglePowerWord(${i})">
                        <span class="power-word-term">${word.term}</span>
                        <span class="power-word-module">${word.module.toUpperCase()}</span>
                    </div>
                    <div class="power-word-content" id="powerWord${i}">
                        <div class="power-word-definition">${word.definition}</div>
                        <div class="power-word-example">"${word.example}"</div>
                    </div>
                </div>
            `).join('');
        }

        function togglePowerWord(index) {
            const content = document.getElementById('powerWord' + index);
            content.classList.toggle('expanded');
        }

        async function init() {
            loadFromStorage();

            // Start efficient clock
            updateDateTime();
            clockLoop();

            // Mobile nav setup
            const hamburger = $('hamburgerBtn');
            const overlay = $('sidebarOverlay');
            if (hamburger) hamburger.addEventListener('click', toggleSidebar);
            if (overlay) overlay.addEventListener('click', closeSidebar);

            // Merge historical titans into mastersData
            mastersData.historical = historicalTitans;

            // Load enhanced masters + planning data IN PARALLEL (non-blocking)
            Promise.all([
                loadEnhancedMastersData().catch(() => {}),
                loadPlanningData().catch(() => {})
            ]);

            // Initialize new data structures
            if (!appData.plans) appData.plans = [];
            if (!appData.systems) appData.systems = [];
            if (!appData.quickJournalToday) appData.quickJournalToday = '';
            if (!appData.vocabularyLearned) appData.vocabularyLearned = [];

            // Render critical path first
            const wisdom = generateWisdom();
            updateWisdomUI(wisdom);
            renderHabits('dashHabitList', true);
            initHabitDelegation();
            updateDashboardStats();
            loadTodaysPlan();

            // Defer non-critical rendering
            requestAnimationFrame(() => {
                loadTodayChallengeProgress();
                loadTodayGratitude();
                initQuickJournal();

                const powerWords = generatePowerWords();
                renderPowerWords(powerWords);

                // Set up range input listeners
                ['amSleepHours', 'amSleepQuality', 'amEnergy', 'pmDayScore'].forEach(id => {
                    const el = document.getElementById(id);
                    if (el) el.dispatchEvent(new Event('input'));
                });

                // Initialize journal data if not present
                if (!appData.journalEntries) appData.journalEntries = [];
                if (!appData.journalPatterns) appData.journalPatterns = {};
                if (!appData.journalStats) appData.journalStats = { totalEntries: 0, dailyOpsCount: 0, deepDiveCount: 0, frameworkUsage: {} };
                if (typeof appData.journalStreak !== 'number') appData.journalStreak = 0;
            });
        }

        document.addEventListener('DOMContentLoaded', init);

        // ============================================
        // PROACTIVE JOURNAL SYSTEM
        // ============================================

        let currentJournalMode = 'daily';
        let currentDailyFramework = null;
        let currentDeepDive = null;
        let deepDiveStep = 1;
        let deepDiveResponses = [];

        function loadJournalPage() {
            loadDailyOpsFramework();
            renderDeepDiveSelector();
            loadTodayDraftIfExists();
            loadJournalHistory();
            detectProactiveContext();
            populateHistoryModuleFilter();
            setupJournalDayScoreListener();
        }

        function setJournalMode(mode) {
            currentJournalMode = mode;
            document.querySelectorAll('.journal-mode-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.mode === mode);
            });
            document.querySelectorAll('.journal-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            const panelId = `journalPanel${mode.charAt(0).toUpperCase() + mode.slice(1)}`;
            document.getElementById(panelId)?.classList.add('active');

            if (mode === 'patterns') {
                runPatternAnalysis();
            } else if (mode === 'history') {
                loadJournalHistory();
            }
        }

        function loadDailyOpsFramework() {
            const frameworks = journalFrameworks.daily_ops;
            currentDailyFramework = getRandomItem(frameworks);
            renderDailyOpsFramework();
        }

        function shuffleFramework() {
            const frameworks = journalFrameworks.daily_ops;
            let newFramework;
            do {
                newFramework = getRandomItem(frameworks);
            } while (newFramework.id === currentDailyFramework?.id && frameworks.length > 1);
            currentDailyFramework = newFramework;
            renderDailyOpsFramework();
            showToast('Framework shuffled', 'success');
        }

        function renderDailyOpsFramework() {
            if (!currentDailyFramework) return;

            document.getElementById('frameworkSource').textContent = currentDailyFramework.source;
            document.getElementById('frameworkName').textContent = currentDailyFramework.name;
            document.getElementById('frameworkDescription').textContent = currentDailyFramework.description;
            document.getElementById('frameworkPower').textContent = `"${currentDailyFramework.power_statement}"`;

            const promptsContainer = document.getElementById('frameworkPrompts');
            promptsContainer.innerHTML = currentDailyFramework.prompts.map((prompt, i) => `
                <div class="framework-prompt-item">
                    <div class="framework-prompt-number">PROMPT ${i + 1}</div>
                    <div class="framework-prompt-text">${prompt}</div>
                    <textarea class="framework-prompt-input" id="frameworkPrompt${i}" placeholder="Your response..."></textarea>
                </div>
            `).join('');
        }

        function collectDailyOpsFormData() {
            const prompts = [];
            if (currentDailyFramework) {
                currentDailyFramework.prompts.forEach((_, i) => {
                    const el = document.getElementById(`frameworkPrompt${i}`);
                    prompts.push(el ? el.value : '');
                });
            }

            return {
                type: 'daily',
                date: new Date().toISOString().split('T')[0],
                timestamp: new Date().toISOString(),
                framework: currentDailyFramework ? {
                    id: currentDailyFramework.id,
                    name: currentDailyFramework.name,
                    source: currentDailyFramework.source
                } : null,
                situation: document.getElementById('journalSituation')?.value || '',
                intent: document.getElementById('journalIntent')?.value || '',
                frameworkPromptResponses: prompts,
                execution: document.getElementById('journalExecution')?.value || '',
                aar: {
                    worked: document.getElementById('journalAarWorked')?.value || '',
                    failed: document.getElementById('journalAarFailed')?.value || '',
                    delta: document.getElementById('journalAarDelta')?.value || '',
                    score: parseInt(document.getElementById('journalDayScore')?.value || 7)
                }
            };
        }

        function saveJournalDraft() {
            const draft = collectDailyOpsFormData();
            draft.isDraft = true;
            appData.journalDraft = draft;
            saveToStorage();
            showToast('Draft saved', 'success');
        }

        function saveJournalEntry(type) {
            let entry;
            if (type === 'daily') {
                entry = collectDailyOpsFormData();
                if (!entry.situation && !entry.intent) {
                    showToast('Please fill in at least the situation or intent', 'warning');
                    return;
                }
            }

            entry.id = Date.now().toString();
            entry.isDraft = false;

            autoTagEntry(entry);

            appData.journalEntries.unshift(entry);

            if (appData.journalEntries.length > 180) {
                appData.journalEntries = appData.journalEntries.slice(0, 180);
            }

            appData.journalDraft = null;
            updateJournalStats(entry);
            updateJournalStreak();
            saveToStorage();

            clearDailyOpsForm();
            loadDailyOpsFramework();
            showToast('Entry saved!', 'success');

            if (appData.journalEntries.length % 5 === 0) {
                runPatternAnalysis();
            }
        }

        function clearDailyOpsForm() {
            document.getElementById('journalSituation').value = '';
            document.getElementById('journalIntent').value = '';
            document.getElementById('journalExecution').value = '';
            document.getElementById('journalAarWorked').value = '';
            document.getElementById('journalAarFailed').value = '';
            document.getElementById('journalAarDelta').value = '';
            document.getElementById('journalDayScore').value = 7;
            document.getElementById('journalDayScoreValue').textContent = '7';
            if (currentDailyFramework) {
                currentDailyFramework.prompts.forEach((_, i) => {
                    const el = document.getElementById(`frameworkPrompt${i}`);
                    if (el) el.value = '';
                });
            }
        }

        function loadTodayDraftIfExists() {
            const draft = appData.journalDraft;
            if (!draft) return;

            const today = new Date().toISOString().split('T')[0];
            if (draft.date !== today) {
                appData.journalDraft = null;
                saveToStorage();
                return;
            }

            if (draft.framework?.id) {
                const framework = journalFrameworks.daily_ops.find(f => f.id === draft.framework.id);
                if (framework) {
                    currentDailyFramework = framework;
                    renderDailyOpsFramework();
                }
            }

            document.getElementById('journalSituation').value = draft.situation || '';
            document.getElementById('journalIntent').value = draft.intent || '';
            document.getElementById('journalExecution').value = draft.execution || '';
            document.getElementById('journalAarWorked').value = draft.aar?.worked || '';
            document.getElementById('journalAarFailed').value = draft.aar?.failed || '';
            document.getElementById('journalAarDelta').value = draft.aar?.delta || '';
            document.getElementById('journalDayScore').value = draft.aar?.score || 7;
            document.getElementById('journalDayScoreValue').textContent = draft.aar?.score || '7';

            if (draft.frameworkPromptResponses && draft.frameworkPromptResponses.length > 0) {
                setTimeout(() => {
                    draft.frameworkPromptResponses.forEach((response, i) => {
                        const el = document.getElementById(`frameworkPrompt${i}`);
                        if (el) el.value = response;
                    });
                }, 100);
            }

            showToast('Draft restored', 'success');
        }

        function setupJournalDayScoreListener() {
            const scoreEl = document.getElementById('journalDayScore');
            const valueEl = document.getElementById('journalDayScoreValue');
            if (scoreEl && valueEl) {
                scoreEl.addEventListener('input', (e) => {
                    valueEl.textContent = e.target.value;
                });
            }
        }

        function updateJournalStats(entry) {
            appData.journalStats.totalEntries++;
            if (entry.type === 'daily') {
                appData.journalStats.dailyOpsCount++;
            } else if (entry.type === 'deepdive') {
                appData.journalStats.deepDiveCount++;
            }

            if (entry.framework?.id) {
                const frameworkId = entry.framework.id;
                appData.journalStats.frameworkUsage[frameworkId] = (appData.journalStats.frameworkUsage[frameworkId] || 0) + 1;
            }
        }

        function updateJournalStreak() {
            const today = new Date().toISOString().split('T')[0];
            const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];

            const todayEntries = appData.journalEntries.filter(e => e.date === today);
            const yesterdayEntries = appData.journalEntries.filter(e => e.date === yesterday);

            if (todayEntries.length > 0) {
                if (yesterdayEntries.length > 0 || appData.journalStreak === 0) {
                    if (todayEntries.length === 1) {
                        appData.journalStreak++;
                    }
                } else {
                    appData.journalStreak = 1;
                }
            }
        }

        // ============================================
        // PROACTIVE CONTEXT DETECTION
        // ============================================

        function detectProactiveContext() {
            const banner = document.getElementById('proactiveBanner');
            const titleEl = document.getElementById('proactiveBannerTitle');
            const messageEl = document.getElementById('proactiveBannerMessage');
            const actionBtn = document.getElementById('proactiveBannerAction');

            const hour = new Date().getHours();
            const lastScore = getLastDayScore();
            const avoidedModules = detectAvoidedModules();

            let context = null;

            if (lastScore !== null && lastScore <= 4) {
                context = {
                    title: 'Resilience Protocol',
                    message: `Yesterday scored ${lastScore}/10. Time for a Stoic perspective check.`,
                    action: 'Start Perspective Deep Dive',
                    framework: 'perspective'
                };
            } else if (avoidedModules.length > 0) {
                const avoided = avoidedModules[0];
                context = {
                    title: 'Blind Spot Alert',
                    message: `You haven't journaled about ${moduleConfig[avoided]?.name || avoided} in 7+ days.`,
                    action: 'Explore This Area',
                    module: avoided
                };
            } else if (hour < 10) {
                context = {
                    title: 'Morning Protocol',
                    message: 'Set your strategic intent with the OODA Loop framework.',
                    action: 'Apply Framework',
                    dailyFramework: 'ooda_loop'
                };
            } else if (hour >= 18) {
                context = {
                    title: 'Evening Review',
                    message: 'Complete your After-Action Review before the day ends.',
                    action: 'Focus on AAR',
                    section: 'aar'
                };
            }

            if (context) {
                banner.style.display = 'flex';
                titleEl.textContent = context.title;
                messageEl.textContent = context.message;
                actionBtn.textContent = context.action;
                actionBtn.onclick = () => applyProactiveFramework(context);
            } else {
                banner.style.display = 'none';
            }
        }

        function getLastDayScore() {
            const yesterday = new Date(Date.now() - 86400000).toISOString().split('T')[0];
            const yesterdayEntries = appData.journalEntries.filter(e => e.date === yesterday && e.type === 'daily');
            if (yesterdayEntries.length > 0) {
                return yesterdayEntries[0].aar?.score || null;
            }
            return null;
        }

        function detectAvoidedModules() {
            const modules = Object.keys(moduleConfig).filter(m => m !== 'historical');
            const sevenDaysAgo = new Date(Date.now() - 7 * 86400000).toISOString().split('T')[0];

            const recentEntries = appData.journalEntries.filter(e => e.date >= sevenDaysAgo);
            const mentionedModules = new Set();

            recentEntries.forEach(entry => {
                if (entry.linkedModules) {
                    entry.linkedModules.forEach(m => mentionedModules.add(m));
                }
            });

            return modules.filter(m => !mentionedModules.has(m) && appData.profile.focusModules.includes(m));
        }

        function applyProactiveFramework(context) {
            dismissProactiveBanner();

            if (context.framework) {
                setJournalMode('deepdive');
                setTimeout(() => startDeepDive(context.framework), 100);
            } else if (context.dailyFramework) {
                const framework = journalFrameworks.daily_ops.find(f => f.id === context.dailyFramework);
                if (framework) {
                    currentDailyFramework = framework;
                    renderDailyOpsFramework();
                }
                setJournalMode('daily');
            } else if (context.section === 'aar') {
                setJournalMode('daily');
                setTimeout(() => {
                    document.querySelector('.aar-card')?.scrollIntoView({ behavior: 'smooth' });
                }, 100);
            } else if (context.module) {
                setJournalMode('daily');
                document.getElementById('journalSituation').value = `Exploring ${moduleConfig[context.module]?.name || context.module}: `;
                document.getElementById('journalSituation').focus();
            }
        }

        function dismissProactiveBanner() {
            document.getElementById('proactiveBanner').style.display = 'none';
        }

        // ============================================
        // DEEP DIVE SYSTEM
        // ============================================

        function renderDeepDiveSelector() {
            const container = document.getElementById('deepDiveSelector');
            const deepDives = journalFrameworks.deep_dive;

            const icons = {
                decision: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>',
                stuck: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="4.93" y1="4.93" x2="19.07" y2="19.07"/></svg>',
                negotiate: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>',
                habit: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>',
                perspective: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>',
                planning: '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>'
            };

            container.innerHTML = Object.entries(deepDives).map(([key, dive]) => `
                <div class="deep-dive-type-card" onclick="startDeepDive('${key}')">
                    <div class="deep-dive-type-icon">${icons[key] || ''}</div>
                    <div class="deep-dive-type-name">${dive.name}</div>
                    <div class="deep-dive-type-source">${dive.source}</div>
                    <div class="deep-dive-type-desc">${dive.description}</div>
                </div>
            `).join('');
        }

        function startDeepDive(type) {
            currentDeepDive = journalFrameworks.deep_dive[type];
            if (!currentDeepDive) return;

            currentDeepDive.type = type;
            deepDiveStep = 1;
            deepDiveResponses = new Array(currentDeepDive.steps.length).fill('');

            document.getElementById('deepDiveTitle').textContent = currentDeepDive.name.toUpperCase();
            document.getElementById('deepDiveSource').textContent = currentDeepDive.source;

            renderDeepDiveSteps();
            openModal('deepDiveModal');
        }

        function renderDeepDiveSteps() {
            const step = currentDeepDive.steps[deepDiveStep - 1];
            const totalSteps = currentDeepDive.steps.length;

            document.getElementById('deepDiveProgress').textContent = `Step ${deepDiveStep} of ${totalSteps}`;
            document.getElementById('deepDiveStepTitle').textContent = step.title;
            document.getElementById('deepDiveStepPrompt').textContent = step.prompt;
            document.getElementById('deepDiveResponse').value = deepDiveResponses[deepDiveStep - 1] || '';

            const indicatorContainer = document.getElementById('deepDiveStepIndicator');
            indicatorContainer.innerHTML = currentDeepDive.steps.map((_, i) => {
                const classes = ['step-dot'];
                if (i + 1 === deepDiveStep) classes.push('active');
                if (i + 1 < deepDiveStep) classes.push('completed');
                return `<div class="${classes.join(' ')}"></div>`;
            }).join('');

            const prevBtn = document.getElementById('deepDivePrevBtn');
            const nextBtn = document.getElementById('deepDiveNextBtn');

            prevBtn.style.display = deepDiveStep > 1 ? 'inline-flex' : 'none';
            nextBtn.textContent = deepDiveStep === totalSteps ? 'Complete' : 'Next';
        }

        function nextDeepDiveStep() {
            deepDiveResponses[deepDiveStep - 1] = document.getElementById('deepDiveResponse').value;

            if (deepDiveStep === currentDeepDive.steps.length) {
                saveDeepDiveEntry();
                return;
            }

            deepDiveStep++;
            renderDeepDiveSteps();
        }

        function prevDeepDiveStep() {
            if (deepDiveStep <= 1) return;
            deepDiveResponses[deepDiveStep - 1] = document.getElementById('deepDiveResponse').value;
            deepDiveStep--;
            renderDeepDiveSteps();
        }

        function saveDeepDiveEntry() {
            const entry = {
                id: Date.now().toString(),
                type: 'deepdive',
                date: new Date().toISOString().split('T')[0],
                timestamp: new Date().toISOString(),
                deepDiveType: currentDeepDive.type,
                framework: {
                    id: currentDeepDive.type,
                    name: currentDeepDive.name,
                    source: currentDeepDive.source
                },
                steps: currentDeepDive.steps.map((step, i) => ({
                    title: step.title,
                    prompt: step.prompt,
                    response: deepDiveResponses[i] || ''
                }))
            };

            autoTagEntry(entry);

            appData.journalEntries.unshift(entry);
            if (appData.journalEntries.length > 180) {
                appData.journalEntries = appData.journalEntries.slice(0, 180);
            }

            updateJournalStats(entry);
            updateJournalStreak();
            saveToStorage();

            closeModal('deepDiveModal');
            showToast('Deep Dive completed!', 'success');

            currentDeepDive = null;
            deepDiveStep = 1;
            deepDiveResponses = [];
        }

        // ============================================
        // PATTERN RECOGNITION & HISTORY
        // ============================================

        function autoTagEntry(entry) {
            const themes = {
                procrastination: ['procrastinate', 'avoid', 'delay', 'put off', 'later', 'tomorrow'],
                fear: ['afraid', 'fear', 'scared', 'anxious', 'worry', 'nervous'],
                discipline: ['discipline', 'consistent', 'routine', 'habit', 'daily', 'commit'],
                overwhelm: ['overwhelm', 'too much', 'stressed', 'burnout', 'exhausted', 'tired'],
                growth: ['learn', 'improve', 'grow', 'progress', 'better', 'succeed', 'achieve']
            };

            const allText = [
                entry.situation,
                entry.intent,
                entry.execution,
                entry.aar?.worked,
                entry.aar?.failed,
                entry.aar?.delta,
                ...(entry.frameworkPromptResponses || []),
                ...(entry.steps?.map(s => s.response) || [])
            ].filter(Boolean).join(' ').toLowerCase();

            entry.detectedThemes = [];
            Object.entries(themes).forEach(([theme, keywords]) => {
                if (keywords.some(kw => allText.includes(kw))) {
                    entry.detectedThemes.push(theme);
                }
            });

            entry.linkedModules = detectLinkedModules(allText);
        }

        function detectLinkedModules(text) {
            const moduleKeywords = {
                money: ['money', 'wealth', 'income', 'invest', 'rich', 'financial'],
                sales: ['sales', 'sell', 'close', 'prospect', 'customer', 'deal'],
                finance: ['budget', 'save', 'debt', 'expense', 'bank'],
                productivity: ['productive', 'focus', 'deep work', 'task', 'time', 'efficient'],
                business: ['business', 'startup', 'company', 'entrepreneur', 'revenue'],
                mindset: ['mindset', 'think', 'belief', 'attitude', 'mental', 'stoic'],
                dating: ['social', 'date', 'relationship', 'connect', 'people', 'conversation'],
                lifestyle: ['lifestyle', 'habit', 'routine', 'environment', 'design'],
                health: ['health', 'fitness', 'exercise', 'sleep', 'energy', 'workout']
            };

            const linked = [];
            Object.entries(moduleKeywords).forEach(([module, keywords]) => {
                if (keywords.some(kw => text.includes(kw))) {
                    linked.push(module);
                }
            });

            return linked;
        }

        function runPatternAnalysis() {
            const entries = appData.journalEntries;
            if (entries.length < 5) {
                document.getElementById('patternThemes').innerHTML = '<p class="text-muted">Complete 5+ entries to see patterns</p>';
                document.getElementById('patternBlindSpots').innerHTML = '<p class="text-muted">Complete more entries to detect blind spots</p>';
                document.getElementById('patternFrameworks').innerHTML = '<p class="text-muted">Use more frameworks to see usage patterns</p>';
                return;
            }

            const themeCounts = {};
            entries.forEach(entry => {
                (entry.detectedThemes || []).forEach(theme => {
                    themeCounts[theme] = (themeCounts[theme] || 0) + 1;
                });
            });

            renderPatternThemes(themeCounts);

            const avoidedModules = detectAvoidedModules();
            renderPatternBlindSpots(avoidedModules);

            renderPatternFrameworks();
        }

        function renderPatternThemes(themeCounts) {
            const container = document.getElementById('patternThemes');
            const sorted = Object.entries(themeCounts).sort((a, b) => b[1] - a[1]);
            const maxCount = sorted[0]?.[1] || 1;

            const themeIcons = {
                procrastination: '',
                fear: '',
                discipline: '',
                overwhelm: '',
                growth: ''
            };

            if (sorted.length === 0) {
                container.innerHTML = '<p class="text-muted">No recurring themes detected yet</p>';
                return;
            }

            container.innerHTML = sorted.map(([theme, count]) => `
                <div class="pattern-item">
                    <div class="pattern-item-icon">${themeIcons[theme] || ''}</div>
                    <div class="pattern-item-content">
                        <div class="pattern-item-name">${theme.charAt(0).toUpperCase() + theme.slice(1)}</div>
                        <div class="pattern-item-count">${count} entries</div>
                        <div class="pattern-item-bar">
                            <div class="pattern-item-bar-fill" style="width: ${(count / maxCount) * 100}%"></div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderPatternBlindSpots(avoidedModules) {
            const container = document.getElementById('patternBlindSpots');

            if (avoidedModules.length === 0) {
                container.innerHTML = '<p class="text-muted" style="color: var(--success);">No blind spots detected - you are covering all focus modules!</p>';
                return;
            }

            container.innerHTML = avoidedModules.map(module => `
                <div class="blind-spot-item" onclick="focusOnModule('${module}')">
                    <svg class="blind-spot-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                        <line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>
                    </svg>
                    <span class="blind-spot-name">${moduleConfig[module]?.name || module}</span>
                    <span class="blind-spot-days">7+ days</span>
                </div>
            `).join('');
        }

        function focusOnModule(module) {
            setJournalMode('daily');
            document.getElementById('journalSituation').value = `Exploring ${moduleConfig[module]?.name || module}: `;
            document.getElementById('journalSituation').focus();
        }

        function renderPatternFrameworks() {
            const container = document.getElementById('patternFrameworks');
            const usage = appData.journalStats.frameworkUsage || {};
            const sorted = Object.entries(usage).sort((a, b) => b[1] - a[1]);

            if (sorted.length === 0) {
                container.innerHTML = '<p class="text-muted">Use more frameworks to see usage patterns</p>';
                return;
            }

            const allFrameworks = [
                ...journalFrameworks.daily_ops,
                ...Object.values(journalFrameworks.deep_dive)
            ];

            container.innerHTML = sorted.map(([frameworkId, count]) => {
                const framework = allFrameworks.find(f => f.id === frameworkId || f.type === frameworkId);
                const name = framework?.name || frameworkId;
                return `
                    <div class="pattern-item">
                        <div class="pattern-item-icon"></div>
                        <div class="pattern-item-content">
                            <div class="pattern-item-name">${name}</div>
                            <div class="pattern-item-count">Used ${count} times</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function populateHistoryModuleFilter() {
            const select = document.getElementById('historyModuleFilter');
            select.innerHTML = '<option value="all">All Modules</option>';
            Object.entries(moduleConfig).filter(([key]) => key !== 'historical').forEach(([key, config]) => {
                select.innerHTML += `<option value="${key}">${config.name}</option>`;
            });
        }

        function loadJournalHistory() {
            filterJournalHistory();
        }

        const debouncedFilterHistory = debounce(filterJournalHistory, 250);

        function filterJournalHistory() {
            const typeFilter = document.getElementById('historyTypeFilter')?.value || 'all';
            const moduleFilter = document.getElementById('historyModuleFilter')?.value || 'all';
            const searchText = document.getElementById('historySearch')?.value?.toLowerCase() || '';

            let entries = [...appData.journalEntries];

            if (typeFilter !== 'all') {
                entries = entries.filter(e => e.type === typeFilter);
            }

            if (moduleFilter !== 'all') {
                entries = entries.filter(e => e.linkedModules?.includes(moduleFilter));
            }

            if (searchText) {
                entries = entries.filter(e => {
                    const text = [
                        e.situation,
                        e.intent,
                        e.execution,
                        e.framework?.name,
                        ...(e.steps?.map(s => s.response) || [])
                    ].filter(Boolean).join(' ').toLowerCase();
                    return text.includes(searchText);
                });
            }

            renderJournalHistory(entries);
        }

        function renderJournalHistory(entries) {
            const container = document.getElementById('historyList');

            if (entries.length === 0) {
                container.innerHTML = '<p class="text-muted">No journal entries found. Start your first Daily Ops entry!</p>';
                return;
            }

            container.innerHTML = entries.map(entry => {
                const isDeepDive = entry.type === 'deepdive';
                const title = entry.framework?.name || 'Daily Ops Entry';
                const date = new Date(entry.timestamp).toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
                const preview = entry.situation || entry.intent || entry.steps?.[0]?.response || '';
                const scoreClass = entry.aar?.score >= 7 ? 'high' : entry.aar?.score >= 5 ? 'medium' : 'low';

                return `
                    <div class="history-entry" onclick="viewJournalEntry('${entry.id}')">
                        <div class="history-entry-type ${isDeepDive ? 'deep-dive' : ''}">
                            ${isDeepDive
                                ? '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>'
                                : '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>'
                            }
                        </div>
                        <div class="history-entry-content">
                            <div class="history-entry-title">${title}</div>
                            <div class="history-entry-meta">
                                <span>${date}</span>
                                <span class="history-entry-framework">${entry.framework?.source || ''}</span>
                            </div>
                        </div>
                        ${!isDeepDive && entry.aar?.score
                            ? `<div class="history-entry-score ${scoreClass}">${entry.aar.score}</div>`
                            : ''
                        }
                    </div>
                `;
            }).join('');
        }

        function viewJournalEntry(entryId) {
            const entry = appData.journalEntries.find(e => e.id === entryId);
            if (!entry) return;

            const modal = document.getElementById('journalViewModal');
            const title = document.getElementById('journalViewTitle');
            const content = document.getElementById('journalViewContent');

            const date = new Date(entry.timestamp).toLocaleDateString('en-US', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            title.textContent = date;

            if (entry.type === 'deepdive') {
                content.innerHTML = `
                    <div class="journal-view-section">
                        <div class="journal-view-framework">
                            <div class="journal-view-framework-name">${entry.framework?.name || 'Deep Dive'}</div>
                            <div class="journal-view-framework-source">${entry.framework?.source || ''}</div>
                        </div>
                    </div>
                    ${(entry.steps || []).map(step => `
                        <div class="journal-view-section">
                            <div class="journal-view-label">${step.title}</div>
                            <div class="journal-view-content">${step.response || '<em>No response</em>'}</div>
                        </div>
                    `).join('')}
                `;
            } else {
                content.innerHTML = `
                    <div class="journal-view-section">
                        <div class="journal-view-framework">
                            <div class="journal-view-framework-name">${entry.framework?.name || 'Daily Ops'}</div>
                            <div class="journal-view-framework-source">${entry.framework?.source || ''}</div>
                        </div>
                    </div>
                    ${entry.situation ? `
                        <div class="journal-view-section">
                            <div class="journal-view-label">Situation Analysis</div>
                            <div class="journal-view-content">${entry.situation}</div>
                        </div>
                    ` : ''}
                    ${entry.intent ? `
                        <div class="journal-view-section">
                            <div class="journal-view-label">Strategic Intent</div>
                            <div class="journal-view-content">${entry.intent}</div>
                        </div>
                    ` : ''}
                    ${(entry.frameworkPromptResponses || []).filter(r => r).length > 0 ? `
                        <div class="journal-view-section">
                            <div class="journal-view-label">Framework Responses</div>
                            ${entry.frameworkPromptResponses.filter(r => r).map((r, i) => `
                                <div class="journal-view-content" style="margin-bottom: 0.5rem;">${r}</div>
                            `).join('')}
                        </div>
                    ` : ''}
                    ${entry.execution ? `
                        <div class="journal-view-section">
                            <div class="journal-view-label">Execution Notes</div>
                            <div class="journal-view-content">${entry.execution}</div>
                        </div>
                    ` : ''}
                    ${entry.aar?.worked || entry.aar?.failed || entry.aar?.delta ? `
                        <div class="journal-view-section">
                            <div class="journal-view-label">After-Action Review</div>
                            ${entry.aar.worked ? `<div class="journal-view-content" style="margin-bottom: 0.5rem;"><strong>Worked:</strong> ${entry.aar.worked}</div>` : ''}
                            ${entry.aar.failed ? `<div class="journal-view-content" style="margin-bottom: 0.5rem;"><strong>Didn't work:</strong> ${entry.aar.failed}</div>` : ''}
                            ${entry.aar.delta ? `<div class="journal-view-content" style="margin-bottom: 0.5rem;"><strong>Intent vs Outcome:</strong> ${entry.aar.delta}</div>` : ''}
                            ${entry.aar.score ? `<div class="journal-view-content"><strong>Day Score:</strong> ${entry.aar.score}/10</div>` : ''}
                        </div>
                    ` : ''}
                `;
            }

            openModal('journalViewModal');
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
            if (e.key === 'r') refreshWisdom();
            if (e.key === 'm') openMorningCheckin();
            if (e.key === 'e') openEveningReflection();
            if (e.key === 'j') showPage('journal');
        });
    </script>
</body>
</html>
